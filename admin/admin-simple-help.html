<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aide â€” Console simple</title>
    <link rel="icon" type="image/svg+xml" href="/favicon-e.svg" />
    <meta name="robots" content="noindex, nofollow" />
    <style>
      :root { --border:#e2e8f0; --muted:#64748b; --ink:#0f172a; --teal:#059669; }
      *{box-sizing:border-box}
      body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f8fafc;color:var(--ink)}
      header{position:sticky;top:0;display:flex;align-items:center;gap:8px;padding:10px;border-bottom:1px solid var(--border);background:#fff}
      .title{font-weight:800}
      .spacer{flex:1}
      .btn{border:1px solid var(--border);background:#fff;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
      .btn.primary{background:var(--teal);border-color:var(--teal);color:#fff}
      main{padding:16px;max-width:900px;margin:0 auto}
      .chip{display:inline-block;background:#ecfeff;color:#0e7490;border:1px solid #bae6fd;padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700}
      h2{margin:10px 0}
      h3{margin:10px 0}
      .card{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,.06);padding:14px}
      code{background:#f1f5f9;border:1px solid var(--border);border-radius:6px;padding:0 4px}
      ol{margin:0 0 12px 18px}
      ul{margin:0 0 0 18px}
      footer{padding:12px;color:var(--muted);text-align:center}
      @media (max-width: 700px){ main{padding:12px} }
      /* new utility classes */
      .mb12{margin-bottom:12px}
      .para{margin-top:6px}
      .note{font-size:12px;color:var(--muted);margin:0}
      .focus-btn{margin-left:6px;padding:2px 8px;font-size:11px;border:1px solid var(--border);background:#fff;border-radius:8px;cursor:pointer}
      .focus-btn:hover{background:#f1f5f9}
      .form-grid{display:grid;gap:16px}
      .two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}
      .fld-label{display:block;font-size:12px;font-weight:700;color:var(--muted);margin-bottom:4px}
      .req{color:#dc2626}
      .fld-input{width:100%;border:1px solid var(--border);padding:8px 10px;border-radius:8px;font:inherit}
      .fld-textarea{width:100%;border:1px solid var(--border);padding:8px 10px;border-radius:8px;font:inherit;min-height:100px;resize:vertical}
      .fld-textarea.short{min-height:80px}
      .hint{font-size:11px;color:var(--muted);margin-top:2px}
      .lang-hdr{margin:8px 0 0;padding-top:8px;border-top:1px solid var(--border)}
      .submit-notice{display:none;padding:12px;border-radius:8px;margin-bottom:16px;font-size:14px;font-weight:600}
      .hidden{display:none}
      .mt16{margin-top:16px}
      .actions{display:flex;gap:8px;justify-content:flex-end;padding-top:8px;border-top:1px solid var(--border)}
      .lead{color:var(--muted);font-size:14px;margin:0 0 16px}
      /* highlight style injected in parent may exist; keeping a local variant */
      .ea-highlight-pulse{outline:3px solid #0ea5e9!important;animation:eaPulse 1.2s linear infinite;border-radius:8px}
      @keyframes eaPulse{0%,100%{outline-color:#0ea5e9}50%{outline-color:#fbbf24}}
    </style>
  </head>
  <body>
    <header>
      <div class="title">Aide â€” GÃ©rer les modÃ¨les (mode simple)</div>
      <div class="spacer"></div>
      <button class="btn" onclick="window.close()">Fermer</button>
    </header>
    <main>
      <div class="card mb12">
        <div class="chip">Info</div>
        <div class="para">Tout reste en <strong>brouillon local</strong> (stockÃ© dans votre navigateur) jusquâ€™Ã  ce que vous exportiez. Â« RÃ©initialiser Â» recharge le fichier officiel.</div>
      </div>

      <section class="card mb12">
        <h3>1. Modifier un modÃ¨le existant</h3>
        <ol>
          <li><strong>SÃ©lection</strong> â€” Dans la colonne de gauche, cliquez sur la tuile du modÃ¨le. <button type="button" class="focus-btn" data-target="list">Voir</button></li>
          <li><strong>Identifiant</strong> â€” Le champ <em>ID</em> identifie le modÃ¨le de faÃ§on unique (lettres, chiffres, underscore). <button type="button" class="focus-btn" data-target="tpl-id">ID</button></li>
          <li><strong>CatÃ©gories</strong> â€” Choisissez une catÃ©gorie existante dans les menus dÃ©roulants ou tapez une nouvelle dans les champs texte. Les catÃ©gories apparaissent dans l'app principale pour filtrer les modÃ¨les. <button type="button" class="focus-btn" data-target="tpl-cat-fr-select">CatÃ©gorie</button></li>
          <li><strong>Titre et Description</strong> â€” ComplÃ©tez en franÃ§ais et en anglais. Le titre apparaÃ®t dans la liste des modÃ¨les, la description donne le contexte d'utilisation. <button type="button" class="focus-btn" data-target="tpl-title-fr">Titre FR</button></li>
          <li><strong>Objet et Corps</strong> â€” RÃ©digez l'objet de l'email et son corps dans les deux langues. <button type="button" class="focus-btn" data-target="tpl-body-fr">Corps FR</button></li>
          <li><strong>Variables (placeholders)</strong> â€” InsÃ©rez des variables avec <code>&lt;&lt;NomVariable&gt;&gt;</code> dans l'Objet/Corps. Exemples: <code>&lt;&lt;ClientName&gt;&gt;</code>, <code>&lt;&lt;ProjectNumber&gt;&gt;</code>, <code>&lt;&lt;NewDeadline&gt;&gt;</code>. N'ajoutez PAS de suffixe _FR ou _EN dans le modÃ¨le (le systÃ¨me gÃ¨re Ã§a automatiquement).</li>
          <li><strong>Sync variables</strong> â€” AprÃ¨s avoir modifiÃ© le texte, cliquez Â« Sync variables Â» pour mettre Ã  jour la liste dÃ©tectÃ©e. <button type="button" class="focus-btn" data-target="btn-sync-vars">Sync</button></li>
          <li><strong>Descriptions des variables</strong> â€” En bas de l'Ã©diteur, complÃ©tez les descriptions FR/EN et valeurs par dÃ©faut pour chaque variable dÃ©tectÃ©e. Cela aide les utilisateurs Ã  comprendre quoi remplir.</li>
          <li><strong>Sauvegarde</strong> â€” Les changements sont enregistrÃ©s automatiquement en brouillon local (localStorage). Pour publier dÃ©finitivement, cliquez <strong>Â« Publier sur GitHub Â»</strong> (nÃ©cessite token configurÃ©) ou <strong>Â« TÃ©lÃ©charger JSON Â»</strong> pour sauvegarder localement. <button type="button" class="focus-btn" data-target="btn-gimme-github">Publier sur GitHub</button></li>
        </ol>
      </section>

      <section class="card mb12">
        <h3>2. Supprimer un modÃ¨le</h3>
        <ol>
          <li><strong>SÃ©lection</strong> â€” Cliquez sur le modÃ¨le dans la liste de gauche. <button type="button" class="focus-btn" data-target="list">Voir</button></li>
          <li><strong>Action</strong> â€” Cliquez le bouton Â« Supprimer Â» en haut Ã  droite de l'Ã©diteur. <button type="button" class="focus-btn" data-target="btn-delete">Supprimer</button></li>
          <li>Une confirmation apparaÃ®t - validez pour supprimer dÃ©finitivement du brouillon.</li>
          <li>Le modÃ¨le disparaÃ®t immÃ©diatement de la liste.</li>
          <li><strong>Important:</strong> La suppression ne touche que votre brouillon local. Pour que le modÃ¨le disparaisse aussi de l'app principale, vous devez cliquer <strong>Â« Publier sur GitHub Â»</strong>.</li>
          <li>Si vous supprimez par erreur, cliquez Â« RÃ©initialiser Â» pour restaurer la version officielle (avant vos modifications).</li>
        </ol>
        <p class="note"><strong>Astuce:</strong> Si vous supprimez le dernier modÃ¨le d'une catÃ©gorie, pensez Ã  cliquer Â« Nettoyer catÃ©gories Â» pour retirer la catÃ©gorie vide des menus.</p>
      </section>

      <section class="card mb12">
        <h3>3. Ajouter un nouveau modÃ¨le</h3>
        <ol>
          <li><strong>CrÃ©ation</strong> â€” Dans la colonne de gauche (Â« ModÃ¨les Â»), cliquez Â« Ajouter un modÃ¨le Â». <button type="button" class="focus-btn" data-target="btn-new">Ajouter un modÃ¨le</button></li>
          <li><strong>ID</strong> â€” Saisissez un identifiant simple (lettres, chiffres, underscore). Exemple: <code>welcome_client</code>.</li>
          <li><strong>ComplÃ©tez</strong> les champs FR et EN (Titre, Description, Objet, Corps). <button type="button" class="focus-btn" data-target="tpl-id">ID</button></li>
          <li><strong>Placeholders</strong> â€” InsÃ©rez les variables nÃ©cessaires: <code>&lt;&lt;ClientName&gt;&gt;</code>, <code>&lt;&lt;ProjectNumber&gt;&gt;</code>, etc. Elles sont dÃ©tectÃ©es automatiquement.</li>
          <li><strong>VÃ©rifiez</strong> lâ€™orthographe, accents, cohÃ©rence FR/EN.</li>
          <li><strong>Publiez</strong> via Â« <strong>Publier</strong> Â» â†’ <em>TÃ©lÃ©charger JSON</em> pour transmettre le nouveau modÃ¨le, ou utilisez Â« <strong>Exporter Excel</strong> Â» si vous prÃ©parez plusieurs ajouts.</li>
        </ol>
        <p class="note">Besoin dâ€™aide pour dÃ©crire les variables ? Ajoutez leur nom puis revenez plus tard complÃ©ter les descriptions.</p>
      </section>

      <section class="card mb12">
        <h3>4. Travailler avec Excel (import/export)</h3>
        
        <h4>ğŸ“¤ Exporter vers Excel</h4>
        <ol>
          <li>Cliquez Â« <strong>Exporter Excel</strong> Â» pour tÃ©lÃ©charger tous vos modÃ¨les actuels. <button type="button" class="focus-btn" data-target="btn-export-xlsx">Exporter Excel</button></li>
          <li>Le fichier .xlsx contient un seul onglet Â« Templates Â» avec toutes les colonnes nÃ©cessaires.</li>
          <li>Format des colonnes: <code>ID</code>, <code>CATEGORY_EN</code>, <code>CATEGORY_FR</code>, <code>DESCRIPTION_EN</code>, <code>DESCRIPTION_FR</code>, <code>TITLE_EN</code>, <code>TITLE_FR</code>, <code>TEMPLATE_EN</code>, <code>TEMPLATE_FR</code>, <code>VARIABLES_DESCRIPTION_EN</code>, <code>VARIABLES_DESCRIPTION_FR</code></li>
          <li><strong>Important:</strong> Dans l'Excel exportÃ©, les variables ont des suffixes <code>_EN</code> et <code>_FR</code> (ex: <code>&lt;&lt;ClientName_EN&gt;&gt;</code>). C'est normal pour le format d'Ã©change Excel.</li>
        </ol>

        <h4>ğŸ“¥ Importer depuis Excel</h4>
        <ol>
          <li>Cliquez Â« <strong>Importer</strong> Â» et sÃ©lectionnez votre fichier .xlsx. <button type="button" class="focus-btn" data-target="btn-import">Importer</button></li>
          <li>Le systÃ¨me dÃ©tecte automatiquement s'il s'agit d'un fichier Excel ou JSON.</li>
          <li>Une boÃ®te de dialogue apparaÃ®t: 
            <ul style="margin-top:4px">
              <li><strong>âœ“ OUI (Fusionner)</strong> â€” Ajoute les nouveaux modÃ¨les sans toucher aux existants (recommandÃ©)</li>
              <li><strong>âœ— NON (Remplacer)</strong> â€” Supprime TOUT et remplace par le contenu du fichier (attention!)</li>
            </ul>
          </li>
          <li>AprÃ¨s l'import, vÃ©rifiez les modÃ¨les dans la liste de gauche.</li>
          <li>Les variables sont automatiquement extraites et ajoutÃ©es Ã  la bibliothÃ¨que.</li>
          <li>N'oubliez pas de publier aprÃ¨s vÃ©rification!</li>
        </ol>

        <h4>ğŸ“‹ TÃ©lÃ©charger un modÃ¨le Excel vierge</h4>
        <p>Cliquez Â« <strong>ModÃ¨le XLSX</strong> Â» pour obtenir un fichier exemple avec les bonnes colonnes et un modÃ¨le de dÃ©monstration. <button type="button" class="focus-btn" data-target="btn-dl-template-xlsx">ModÃ¨le XLSX</button></p>

        <p class="note"><strong>Astuce Excel:</strong> Vous pouvez modifier plusieurs modÃ¨les Ã  la fois dans Excel, puis les rÃ©importer en mode Fusionner. C'est pratique pour des corrections en lot ou l'ajout massif de nouveaux modÃ¨les.</p>
      </section>

      <section class="card mb12">
        <h3>5. Publication et sauvegarde</h3>
        
        <h4>ğŸ’¾ Sauvegarde automatique (brouillon local)</h4>
        <p>Tous vos changements sont automatiquement enregistrÃ©s dans le <strong>localStorage</strong> de votre navigateur. C'est un brouillon qui persiste entre les sessions, mais:</p>
        <ul>
          <li>âš ï¸ Il n'est PAS partagÃ© avec d'autres utilisateurs ou appareils</li>
          <li>âš ï¸ Il peut Ãªtre perdu si vous videz le cache du navigateur</li>
          <li>âœ… Il vous permet de travailler progressivement sans perdre vos modifications</li>
        </ul>

        <h4>ğŸ“¤ TÃ©lÃ©charger JSON</h4>
        <p>Cliquez Â« <strong>TÃ©lÃ©charger JSON</strong> Â» pour sauvegarder votre brouillon complet sur votre ordinateur. <button type="button" class="focus-btn" data-target="btn-export-download">TÃ©lÃ©charger JSON</button></p>
        <ul>
          <li>GÃ©nÃ¨re un fichier <code>complete_email_templates.json</code></li>
          <li>Contient tous les modÃ¨les, variables, catÃ©gories et mÃ©tadonnÃ©es</li>
          <li>Peut Ãªtre rÃ©importÃ© plus tard avec Â« Importer Â»</li>
          <li>Utile pour faire une copie de backup</li>
        </ul>

        <h4>ğŸš€ Publier sur GitHub</h4>
        <p>Cliquez Â« <strong>Publier sur GitHub</strong> Â» pour envoyer vos changements directement dans le dÃ©pÃ´t GitHub et mettre Ã  jour l'application principale. <button type="button" class="focus-btn" data-target="btn-gimme-github">Publier sur GitHub</button></p>
        
        <p><strong>Configuration initiale (une seule fois):</strong></p>
        <ol>
          <li>Au premier clic, le systÃ¨me demande un <strong>token GitHub</strong></li>
          <li>CrÃ©ez un token sur <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a> avec permissions <code>repo</code></li>
          <li>Collez le token dans la boÃ®te de dialogue</li>
          <li>Le token est enregistrÃ© dans localStorage (sÃ©curisÃ© localement, jamais partagÃ©)</li>
          <li>Optionnel: vous pouvez aussi spÃ©cifier le dÃ©pÃ´t (format: <code>owner/repo</code>) ou laisser l'auto-dÃ©tection</li>
        </ol>

        <p><strong>AprÃ¨s configuration:</strong></p>
        <ul>
          <li>Un clic publie directement sur la branche <code>main</code> du dÃ©pÃ´t GitHub</li>
          <li>Le fichier <code>complete_email_templates.json</code> est mis Ã  jour</li>
          <li>L'application principale se synchronise automatiquement avec la nouvelle version</li>
          <li>Les autres utilisateurs voient les changements immÃ©diatement</li>
        </ul>

        <p class="note"><strong>Bonne pratique:</strong> Testez vos modÃ¨les localement avant de publier sur GitHub. Une fois publiÃ©, tous les utilisateurs auront accÃ¨s aux nouveaux modÃ¨les!</p>
      </section>

      <section class="card mb12">
        <h3>6. GÃ©rer les catÃ©gories</h3>
        
        <h4>ğŸ¨ Couleurs des catÃ©gories</h4>
        <p>Cliquez Â« <strong>CatÃ©gories</strong> Â» pour ouvrir le gestionnaire de couleurs. <button type="button" class="focus-btn" data-target="btn-category-colors">CatÃ©gories</button></p>
        <ul>
          <li>Chaque catÃ©gorie a une couleur par dÃ©faut qui apparaÃ®t dans l'app principale</li>
          <li>Vous pouvez personnaliser les couleurs pour mieux les diffÃ©rencier</li>
          <li>Un aperÃ§u montre le rendu dans l'application</li>
          <li>Cliquez Â« Enregistrer Â» pour appliquer les changements</li>
        </ul>

        <h4>ğŸ§¹ Nettoyer les catÃ©gories inutilisÃ©es</h4>
        <p>Cliquez Â« <strong>Nettoyer catÃ©gories</strong> Â» pour supprimer les catÃ©gories qui n'ont plus aucun modÃ¨le associÃ©. <button type="button" class="focus-btn" data-target="btn-clean-categories">Nettoyer catÃ©gories</button></p>
        <ul>
          <li>Le systÃ¨me trouve automatiquement les catÃ©gories orphelines</li>
          <li>Une confirmation liste les catÃ©gories qui seront supprimÃ©es</li>
          <li>Les catÃ©gories disparaissent des menus dÃ©roulants et de l'app principale</li>
          <li>N'oubliez pas de publier aprÃ¨s le nettoyage!</li>
        </ul>
      </section>

      <section class="card">
        <h3>â“ Questions frÃ©quentes (FAQ)</h3>
        
        <p><strong>Q: J'ai ajoutÃ© un modÃ¨le hier mais il n'apparaÃ®t pas aujourd'hui. Pourquoi?</strong></p>
        <p>R: Vous avez probablement oubliÃ© de cliquer Â« Publier sur GitHub Â» ou Â« TÃ©lÃ©charger JSON Â». Les changements restent en brouillon local (localStorage) jusqu'Ã  publication. Si vous avez vidÃ© le cache du navigateur ou changÃ© d'appareil, le brouillon est perdu.</p>

        <p><strong>Q: Mes variables n'apparaissent pas dans la liste en bas.</strong></p>
        <p>R: Cliquez le bouton Â« Sync variables Â» aprÃ¨s avoir modifiÃ© le texte. Le systÃ¨me dÃ©tecte automatiquement tous les <code>&lt;&lt;placeholders&gt;&gt;</code> dans l'Objet et le Corps.</p>

        <p><strong>Q: Dois-je mettre _FR et _EN dans mes variables?</strong></p>
        <p>R: <strong>NON!</strong> Dans la console admin, utilisez seulement <code>&lt;&lt;ClientName&gt;&gt;</code>, <code>&lt;&lt;ProjectNumber&gt;&gt;</code>, etc. Les suffixes _FR/_EN sont ajoutÃ©s automatiquement lors de l'export Excel. Ne les ajoutez jamais manuellement dans vos modÃ¨les!</p>

        <p><strong>Q: J'ai un ID en doublon lors de l'import Excel.</strong></p>
        <p>R: Le systÃ¨me ajoute automatiquement un suffixe numÃ©rique (ex: <code>welcome_email_1</code>) pour Ã©viter les conflits. Renommez l'ID aprÃ¨s import si nÃ©cessaire.</p>

        <p><strong>Q: Comment supprimer une catÃ©gorie qui apparaÃ®t encore dans le menu?</strong></p>
        <p>R: Supprimez d'abord tous les modÃ¨les de cette catÃ©gorie, puis cliquez Â« Nettoyer catÃ©gories Â». Ensuite, publiez sur GitHub pour que le changement soit visible dans l'app principale.</p>

        <p><strong>Q: Que fait le bouton "RÃ©initialiser"?</strong></p>
        <p>R: Il efface votre brouillon local (localStorage) et recharge la version officielle depuis le fichier JSON. <strong>Attention:</strong> Tous vos changements non publiÃ©s seront perdus! Utilisez-le seulement si vous voulez recommencer Ã  zÃ©ro.</p>

        <p><strong>Q: Puis-je travailler Ã  plusieurs sur les modÃ¨les?</strong></p>
        <p>R: Oui, mais attention aux conflits! Chaque personne travaille sur son propre brouillon local. Lorsque quelqu'un publie sur GitHub, les autres doivent cliquer Â« RÃ©initialiser Â» pour rÃ©cupÃ©rer la derniÃ¨re version. Coordonnez-vous pour Ã©viter d'Ã©craser les changements des autres!</p>

        <p><strong>Q: Mon token GitHub ne fonctionne pas.</strong></p>
        <p>R: VÃ©rifiez que votre token a bien les permissions <code>repo</code> (accÃ¨s complet au dÃ©pÃ´t). Les tokens expirent aussi aprÃ¨s un certain temps - crÃ©ez-en un nouveau si nÃ©cessaire sur <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a>.</p>

        <p><strong>Q: Combien de temps sont conservÃ©s les changements en brouillon local?</strong></p>
        <p>R: IndÃ©finiment, tant que vous ne videz pas le cache du navigateur. Mais pour la sÃ©curitÃ©, exportez rÃ©guliÃ¨rement un JSON de backup ou publiez sur GitHub.</p>
      </section>


    </main>
    <footer>AstuceÂ : vous pouvez garder cette fenÃªtre ouverte pendant que vous travaillez.</footer>
    <script>
      // Focus the window, hint for accessibility
      window.focus?.();

      // Highlight guidance linking to parent admin window
      function highlightTarget(id){
        const parent = window.opener?.document;
        if(!parent) return;
        const el = parent.getElementById(id);
        if(!el) return;
        // Inject style if missing
        if(!parent.getElementById('ea-highlight-style')){
          const st = parent.createElement('style');
          st.id='ea-highlight-style';
          st.textContent='.ea-highlight-pulse{outline:3px solid #0ea5e9!important;animation:eaPulse 1.2s linear infinite;border-radius:8px}@keyframes eaPulse{0%,100%{outline-color:#0ea5e9}50%{outline-color:#fbbf24}}';
          parent.head.appendChild(st);
        }
        el.scrollIntoView({behavior:'smooth',block:'center'});
        el.classList.add('ea-highlight-pulse');
        el.focus?.();
        setTimeout(()=>el.classList.remove('ea-highlight-pulse'),3000);
      }
      document.querySelectorAll('.focus-btn').forEach(btn=>{
        btn.addEventListener('click',()=>highlightTarget(btn.dataset.target));
      });
    </script>
  </body>
  </html>
