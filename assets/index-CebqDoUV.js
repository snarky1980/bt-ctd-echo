import{c as ms,r as a,j as e,S as ps,a as Sn,R as zr,C as pr,B as fs,I as hs,U as gs,b as bs,L as xs,d as vs,H as ys,P as ws,A as js,e as Ns,f as Cs,g as Es,T as _s,h as ft,i as dr,k as Ht,Z as Bt,l as mr,m as Pn,G as Sr,n as kn,V as Ss,o as Ps,p as Rn,q as ks,s as Tn,t as sn,E as Pr,u as Rs,v as on,w as Ts,M as Ls,x as kr,y as an,z as qs,D as Ln,F as As,J as qn,K as Fs,N as An,O as Ms,Q as Fn,W as Ds,X as Mn,Y as Dn,_ as zs,$ as Os,a0 as Is,a1 as zn,a2 as Vs,a3 as Or,a4 as Bs,a5 as $s,a6 as ln,a7 as Rt,a8 as cn,a9 as un,aa as Hs,ab as Us,ac as Ws,ad as Rr,ae as lr,af as Ks,ag as Ys,ah as Xs,ai as Gs,aj as Qs,ak as Js,al as Zs,am as eo,an as to}from"./vendor-CwNIUOIz.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const f of n)if(f.type==="childList")for(const w of f.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&d(w)}).observe(document,{childList:!0,subtree:!0});function s(n){const f={};return n.integrity&&(f.integrity=n.integrity),n.referrerPolicy&&(f.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?f.credentials="include":n.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function d(n){if(n.ep)return;n.ep=!0;const f=s(n);fetch(n.href,f)}})();const De=r=>{if(!r)return"";const i=String(r??"").trim();return i?i.toLowerCase().replace(/_(fr|en)$/i,"").replace(/[^a-z0-9]+/g,""):""},Ir=(r,i)=>!r||!i?!1:De(r)===De(i),Tr=["FR","EN"],ro=(r="")=>{if(!r)return"";const i=String(r).trim();return i?i.replace(/[<>]/g,"").replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/[-\s]+/g,"_").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,"").toLowerCase():""},no=(r={},i="")=>{if(!r||typeof r!="object")return[];const s=De(i);if(!s)return[];const d=[];for(const n of Object.keys(r))De(n)===s&&d.push(n);return d},_r=(r="",i="")=>{if(!r)return"";const s=String(r).replace(/_+$/g,""),d=String(i||"").toUpperCase();return d?`${s}_${d}`:s},et=(r,i,s={})=>{const d={};if(!r)return d;const n=i==null?"":String(i),f=s!=null&&s.preferredLanguage?String(s.preferredLanguage).toUpperCase():null,w=s!=null&&s.variables&&typeof s.variables=="object"?s.variables:{};De(r);const U=String(r).match(/_(FR|EN)$/i),v=U?U[1].toUpperCase():null,O=v?String(r).slice(0,-1*(v.length+1)):String(r),u=ro(O),I=c=>{if(!c)return;const W=String(c).trim();W&&(Object.prototype.hasOwnProperty.call(d,W)||(d[W]=n))};return I(String(r)),no(w,r).forEach(I),v?(I(O),u&&(I(u),I(_r(u,v)))):(u&&I(u),(f&&Tr.includes(f)?[f]:Tr).forEach(W=>{I(_r(O,W)),u&&I(_r(u,W))})),d},qt=(r={},i="",s="fr")=>{var W,R,se,re;if(!r||typeof r!="object"||!i)return"";const d=String(i),n=r[d];if(n!=null)return String(n);const f=d.toLowerCase();if(f!==d){const ce=r[f];if(ce!=null)return String(ce)}const w=De(d);if(!w)return"";const U=((R=(W=d.match(/_(fr|en)$/i))==null?void 0:W[1])==null?void 0:R.toLowerCase())||null,v=(s||"fr").toLowerCase();let O=null,u=null,I=null;const c=[];for(const[ce,D]of Object.entries(r)){if(D==null)continue;const P=De(ce);if(P===w&&c.push({key:ce,value:String(D).substring(0,20),normalizedKey:P}),P!==w)continue;const oe=((re=(se=ce.match(/_(fr|en)$/i))==null?void 0:se[1])==null?void 0:re.toLowerCase())||null,be=String(D);if(U){if(oe===U)return be;!oe&&!u&&(u=be);continue}if(!oe){u||(u=be);continue}oe===v&&!O&&(O=be),I||(I=be)}return O||u||I||""},so={version:"1.0",totalTemplates:30,languages:["fr","en"],categories:["clarifications_and_client_instructions","deadlines_and_delivery","documents_and_formatting","follow_ups_and_cancellations","quotes_and_approvals","security_and_copyright","unsatisfactory"],categoryLabels:{quotes_and_approvals:{fr:"Devis et approbations",en:"Quotes and approvals"},follow_ups_and_cancellations:{fr:"Suivis et annulations",en:"Follow-ups and cancellations"},documents_and_formatting:{en:"Documents and formatting",fr:"Documents et formats"},deadlines_and_delivery:{en:"Deadlines and delivery",fr:"Délais et livraisons"},clarifications_and_client_instructions:{en:"Clarifications and client instructions",fr:"Précisions et instructions client"},security_and_copyright:{en:"Security and copyright",fr:"Sécurité et droits d’auteur"},unsatisfactory:{fr:"Fournisseurs externes - Qualité insatisfaisante",en:"External Providers - unsatisfactory quality"}},updatedAt:"2025-11-20T23:20:58.405Z",categoryColors:{s:"#c7ffd2"}},oo=JSON.parse(`[{"id":"ctd001","category":"quotes_and_approvals","category_fr":"Devis et approbations","category_en":"Quotes and approvals","title":{"fr":"Projet <<ProjectNumber_FR>> – Devis à approbation requise","en":"Project <<ProjectNumber_EN>>- requesting approval on quote"},"description":{"fr":"Devis avant le lancement d'un projet - approbation requise","en":"Devis avant le lancement d'un projet - approbation requise"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Devis à approbation requise","en":"Project <<ProjectNumber_EN>>- requesting approval on quote"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>. \\r\\n\\r\\nSa réalisation est évaluée à environ <<NbDays_FR>> jour(s) de travail. L’estimation des coûts s’élève à <<Cost_FR>>$. Le montant estimé pourrait varier de plus ou moins 10 %, selon l’évaluation finale du volume et de la complexité des documents.\\r\\n \\r\\nDes frais d’urgence de 50 % s’appliqueront si le projet doit être livré dans un délai de moins de <<NbDays_FR>> jour(s) ouvrable(s) ou de moins de 24 heures. Le coût révisé serait alors de <<UrgentCost_FR>> $.\\r\\n\\r\\nNous vous confirmons que ce projet sera traité uniquement après réception de votre approbation. Afin d’assurer un résultat fidèle et professionnel, et compte tenu de la disponibilité des ressources, la date de livraison pourrait être ajustée une fois l’approbation reçue.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>. \\r\\n\\r\\nBased on our assessment, it will take approximately <<NbDays_EN>> working day(s) to complete. The estimated cost is $<<Cost_EN>>. The amount may vary by up to 10%, depending on our final assessment of the size and complexity of the documents.\\r\\n\\r\\nA 50% rush premium will apply if the project needs to be delivered in under <<NbDays_EN>> working day(s) or within 24 hours, and the revised cost would be $<<UrgentCost_EN>>.\\r\\n\\r\\nPlease note that we will begin work on this project only after receiving your approval. To ensure accurate and professional results, and depending on the availability of resources, the delivery date may be adjusted once we receive your approval.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number","nb_days","cost","urgent_cost"]},{"id":"ctd002","category":"quotes_and_approvals","category_fr":"Devis et approbations","category_en":"Quotes and approvals","title":{"fr":"Projet <<ProjectNumber_FR>> – Devis et confirmation","en":"Project <<ProjectNumber_EN>> – quote and confirmation"},"description":{"fr":"Devis avant le lancement d'un projet - approbation non requise","en":"Quotes – no approval required"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Devis et confirmation","en":"Project <<ProjectNumber_EN>> – quote and confirmation"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.  Sa réalisation est estimée à environ <<NbDays_FR>> jour(s) de travail. Conformément à vos instructions, nous procédons dès maintenant au traitement de votre projet et assurerons la livraison dans le délai prévu.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.  Based on our assessment, it will take approximately <<NbDays_EN>> working day(s) to complete. As per your instructions, we have immediately begun working on the project and will deliver it by the expected deadline.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number","nb_days"]},{"id":"ctd003","category":"follow_ups_and_cancellations","category_fr":"Suivis et annulations","category_en":"Follow-ups and cancellations","title":{"fr":"Projet <<ProjectNumber_FR>> – Suivi d’approbation","en":"Project <<ProjectNumber_EN>> – follow-up for approval"},"description":{"fr":"Devis - suivi d'approbation","en":"Project on hold – follow-up for approval"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Suivi d’approbation","en":"Project <<ProjectNumber_EN>> – follow-up for approval"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous aimerions faire un suivi au sujet du projet <<ProjectNumber_FR>>. Nous attendons toujours une confirmation du devis envoyé le <<Date_FR>>.\\r\\n\\r\\nOr, les projets en attente ne peuvent être conservés au-delà d’une certaine période. Si aucune réponse n’est reçue d’ici <<DeadlineTime_FR>> le <<DeadlineDate_FR>>, le projet sera annulé.\\r\\n\\r\\nVous pourrez toutefois soumettre un nouveau projet lorsque vous souhaiterez aller de l’avant.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe would like to follow up on Project <<ProjectNumber_EN>>. We are currently waiting for you to confirm the quote sent on <<Date_EN>>.\\r\\n\\r\\nPlease note that we can put projects on hold only for a limited time. If we do not receive a response by <<DeadlineTime_EN>> on <<DeadlineDate_EN>>, the project will be cancelled.\\r\\n\\r\\nYou may however submit a new request whenever you would like to move forward.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number","date","deadline_time","deadline_date"]},{"id":"ctd004","category":"quotes_and_approvals","category_fr":"Devis et approbations","category_en":"Quotes and approvals","title":{"fr":"Devis – en attente de document","en":"Quote – awaiting document"},"description":{"fr":"Estimation des coûts - aucun document envoyé","en":"Quotes – no document received"},"subject":{"fr":"Devis – en attente de document","en":"Quote – awaiting document"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception de votre courriel. Il nous est difficile de fournir une estimation sans avoir accès au document à traiter. \\r\\n\\r\\nÀ titre indicatif, un document d’environ <<PageCount_FR>> pages nécessiterait environ <<NbDays_FR>> jour(s) de travail. Les frais estimés sont de l’ordre de <<EstimatedCost_FR>> $.\\r\\n\\r\\nSi des frais d’urgence s’appliquent — notamment si le projet doit être livré dans un délai de moins de <<NbDays_FR>> jour(s) ouvrable(s) ou de moins de 24 heures —, le coût pourrait s’élever à <<UrgentCost_FR>> $.\\r\\n\\r\\nPour obtenir une estimation plus précise, veuillez soumettre vos documents à traduire dans GClingua. \\r\\n\\r\\nPour toute question ou information complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received your email. It is difficult for us to provide an estimate without access to the document to be translated. \\r\\n\\r\\nAs a general guideline, a document of approximately <<PageCount_EN>> pages would require around <<NbDays_EN>> working day(s) to complete, and the estimated cost would be $<<EstimatedCost_EN>>.\\r\\n\\r\\nIf a rush premium applies, particularly if the project needs to be delivered in under <<NbDays_EN>> working day(s) or within 24 hours, the cost could increase to $<<UrgentCost_EN>>.\\r\\n\\r\\nPlease upload your documents to be translated into GClingua to receive a more precise estimate.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["page_count","nb_days","estimated_cost","urgent_cost"]},{"id":"ctd005","category":"documents_and_formatting","category_fr":"Documents et formats","category_en":"Documents and formatting","title":{"fr":"Projet <<ProjectNumber_FR>> – Document PDF : document modifiable requis","en":"Request <<ProjectNumber_EN>> – requesting an editable version of a PDF document"},"description":{"fr":"Demande de document modifiable original pour traitement d'un PDF","en":"PDF document – requesting an editable version"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Document PDF : document modifiable requis","en":"Request <<ProjectNumber_EN>> – requesting an editable version of a PDF document"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet « ProjectNumber_FR ».\\r\\n \\r\\nLe document transmis est en format PDF, qui ne peut être utilisé tel quel par nos traducteurs. Afin d’assurer un traitement adéquat, nous aurions besoin du document source modifiable original (Word, Excel, etc.). La transformation automatique d’un fichier PDF ne suffit pas; il est nécessaire de procéder à un nettoyage et à une préparation technique pour préserver sa mise en forme et éviter les éventuels problèmes pendant la traduction.\\r\\n\\r\\nVoici les options possibles :\\r\\n1.\\tVous pouvez nous transmettre le document original modifiable;\\r\\n2.\\tNous pouvons traduire le contenu du PDF, mais la mise en page pourrait ne pas être fidèle à celle du document original;\\r\\n3.\\tNotre équipe d’éditique peut convertir et préparer le document avant la traduction. Ce service administratif est facturé à <<DPRate_FR>> $/heure. Le temps estimé pour ce travail est d’environ <<DPHours_FR>> heures.\\r\\n \\r\\nNous vous serions reconnaissants de bien vouloir nous indiquer l’option retenue afin que nous puissions procéder au traitement de votre projet.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n \\r\\nThe document you provided is a PDF, which cannot be used as is by our translators. To ensure that it is translated properly, we need the original editable source file (in Word, Excel, etc.). It is not enough to automatically convert a PDF, as the file must be cleaned and technically prepared to preserve its formatting and avoid potential issues during translation.\\r\\n\\r\\nPlease consider the following options:\\r\\n1.\\tYou may send us the original editable document.\\r\\n2.\\tWe can translate the content from the PDF, but the formatting may not match that of the original.\\r\\n3.\\tOur desktop publishing team can convert and prepare the document before translation. This administrative service is billed at $<<DPRate_EN>> per hour, with an estimated time of approximately <<DPHours_EN>> hours.\\r\\n \\r\\nPlease let us know which option you would prefer so we can process your project.\\r\\n\\r\\nBest regards,"},"variables":["project_number","dprate","dphours"]},{"id":"ctd006","category":"deadlines_and_delivery","category_fr":"Délais et livraisons","category_en":"Deadlines and delivery","title":{"fr":"Projet <<ProjectNumber_FR>> – Frais d’urgence","en":"Project <<ProjectNumber_EN>> – rush premium"},"description":{"fr":"Application de prime d'urgence","en":"Urgent tasks – notice of additional fees"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Frais d’urgence","en":"Project <<ProjectNumber_EN>> – rush premium"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet « ProjectNumber_FR ».\\r\\n\\r\\nComme le délai prévu pour traiter ce projet est de moins de <<NbDays_FR>> jour(s) ouvrable(s) (ou de moins de 24 heures), des frais d’urgence de 50 % s’appliqueront.\\r\\n\\r\\nPour éviter l’application de ces frais, nous vous suggérons de reporter si possible la date de livraison à <<NewDate_FR>>.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous confirmer votre préférence d’ici <<DeadlineTime_FR>> aujourd’hui.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nSince the expected deadline to process this project is under <<NbDays_EN>> working day(s) (or within 24 hours), a 50% rush premium will apply.\\r\\n\\r\\nTo avoid these fees, we suggest postponing the delivery date to <<NewDate_EN>>, if possible.\\r\\n\\r\\nCould you please confirm your preference by <<DeadlineTime_EN>> today?\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number","nb_days","new_date","deadline_time"]},{"id":"ctd007","category":"deadlines_and_delivery","category_fr":"Délais et livraisons","category_en":"Deadlines and delivery","title":{"fr":"Projet <<ProjectNumber_FR>> – Report de date de livraison","en":"Project <<ProjectNumber_EN>> - delivery date extension"},"description":{"fr":"Demande de report de la date de livraison","en":"Requesting a delivery date extension"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Report de date de livraison","en":"Project <<ProjectNumber_EN>> - delivery date extension"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet « ProjectNumber_FR ».\\r\\n\\r\\nCertaines circonstances nous amènent à devoir ajuster le délai initial de livraison.\\r\\n\\r\\n[Choisir une variante à conserver au besoin]\\r\\n\\r\\nVARIANTE A – Volume\\r\\nLe document est particulièrement volumineux et son traitement demande plus de temps que prévu.\\r\\n\\r\\nVARIANTE B – Complexité\\r\\nLe niveau de complexité linguistique ou technique est plus élevé que prévu, ce qui demande un travail particulièrement approfondi.\\r\\n\\r\\nVARIANTE C – Contenu\\r\\nLa nature du contenu requiert une révision minutieuse afin de garantir la qualité du résultat.\\r\\n\\r\\nVARIANTE D – Ressources\\r\\nLe traducteur assigné au projet est temporairement indisponible, ce qui nécessite un réajustement du calendrier.\\r\\n\\r\\nVARIANTE E – Technique\\r\\nDes problèmes techniques ralentissent le traitement, ce qui exige un délai supplémentaire.\\r\\n\\r\\nConséquemment, un délai supplémentaire serait nécessaire. Nous vous proposons de reporter la date de livraison au <<NewDeadline_FR>> pour assurer un résultat répondant à nos normes en matière d’uniformité et de qualité. Pourriez-vous nous confirmer si ce nouveau délai vous convient?\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nDue to various circumstances, we need to adjust the original delivery date.\\r\\n[Please select the appropriate version as needed.]\\r\\n\\r\\nVERSION A – Size\\r\\nThe document is particularly large and requires more time to process than expected.\\r\\n\\r\\nVERSION B – Complexity\\r\\nThe linguistic or technical complexity is higher than anticipated and requires a significant amount of in-depth work.\\r\\n\\r\\nVERSION C – Content\\r\\nBecause of the nature of the content, it needs to be thoroughly revised to ensure the quality of the result.\\r\\n\\r\\nVARIANTE D – Resources\\r\\nThe translator assigned to the project is temporarily unavailable, and we need to adjust the time frame.\\r\\n\\r\\nVARIANTE E – Technical\\r\\nThere are delays in the processing due to technical issues, and more time is needed.\\r\\n\\r\\nAs a result, we need to extend the deadline and suggest postponing the delivery date to <<NewDeadline_EN>> to ensure that the final product meets our standards for consistency and quality. Could you please confirm if the new deadline works for you?\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number","new_deadline"]},{"id":"ctd008","category":"follow_ups_and_cancellations","category_fr":"Suivis et annulations","category_en":"Follow-ups and cancellations","title":{"fr":"Projet <<ProjectNumber_FR>> – Annulation","en":"Project <<ProjectNumber_EN>> – cancellation"},"description":{"fr":"Confirmation d'annulation d'un projet","en":"Cancelled projects"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Annulation","en":"Project <<ProjectNumber_EN>> – cancellation"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous avons bien pris note de l’annulation de votre projet <<ProjectNumber_FR>> dans le système.\\r\\n\\r\\n[Choisir une variante à conserver]\\r\\n\\r\\nVARIANTE A – Aucun travail amorcé\\r\\nLe projet n’avait pas encore été pris en charge au moment de l’annulation. Aucun frais ne vous sera donc facturé.\\r\\n\\r\\nVARIANTE B – Projet en cours\\r\\nLa traduction avait déjà été amorcée au moment où nous avons reçu votre demande d’annulation. Dans ce cas, des frais seront appliqués en fonction du travail réalisé. Une ébauche partielle vous sera transmise à titre de référence. Veuillez toutefois noter qu’il ne s’agit pas d’une version finale, qu’elle n’a pas fait l’objet d’une révision approfondie et que sa qualité ne peut être garantie à ce stade.\\r\\n\\r\\nVARIANTE C – Travail très avancé\\r\\nLe projet était déjà à un stade avancé de traitement. Si vous le souhaitez, nous pouvons poursuivre le travail afin de vous remettre une version finale de qualité. Cette option vous permettrait de bénéficier d’un produit complet et révisé. Dans le cas contraire, nous pourrons vous transmettre uniquement le contenu réalisé à ce jour, sans garantir la qualité, puisque le travail n’est pas finalisé. Des frais seront appliqués en fonction du travail réalisé.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous préciser ce qui a motivé l’annulation, qu’il s’agisse, par exemple, de contraintes de budget, de délai ou d’autres considérations.\\r\\nQuelle que soit la raison, votre retour nous serait précieux, car nous accordons une grande importance à la satisfaction de nos clients et cherchons constamment à améliorer nos services.\\r\\n\\r\\nNous vous remercions d’avance pour le temps que vous consacrerez à cette rétroaction et demeurons à votre disposition pour toute question ou tout renseignement complémentaire.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have noted that Project <<ProjectNumber_EN>> has been cancelled in the system.\\r\\n\\r\\n[Please select a version to use.]\\r\\n\\r\\nVERSION A – no work was done\\r\\nNo work had begun on the project when it was cancelled, and you will not be charged any fees.\\r\\n\\r\\nVERSION B – project was in progress\\r\\nTranslation had already begun when we received your request tto cancel. In this case, you will be charged a fee based on the work completed. A partial draft will be sent to you for reference. However, please note that it is not a final version, nor has it been thoroughly reviewed, and its quality cannot be guaranteed at this stage.\\r\\n\\r\\nVERSION C – project was in the advanced stages\\r\\nThe work on the project was in the advanced stages. Depending on your preference, we can continue the work so that you receive a high-quality final version, giving you a complete and revised translation. Alternatively, we can send you only the content completed to date but cannot guarantee its quality, as the work is unfinished. Fees will be applied based on the work completed.\\r\\n\\r\\nWe would appreciate it if you could let us know the reasons for the cancellation, whether it was due to budget constraints, the deadline or other considerations.\\r\\nWhatever the reason, your feedback is valuable to us, as we are committed to client satisfaction and continuously improving our services.\\r\\n\\r\\nWe thank you in advance for taking the time to provide feedback. Please contact us if you have any questions or need more information.\\r\\n\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd009","category":"deadlines_and_delivery","category_fr":"Délais et livraisons","category_en":"Deadlines and delivery","title":{"fr":"Projet <<ProjectNumber_FR>> – Nouvelle date de livraison","en":"Project <<ProjectNumber_EN>> – new delivery date"},"description":{"fr":"Avis au client de report ou de nouvelle date de livraison","en":"Delivery postponed – delays"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Nouvelle date de livraison","en":"Project <<ProjectNumber_EN>> – new delivery date"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n\\r\\nMalgré tous nos efforts, il ne nous sera pas possible de respecter la date de livraison initialement prévue. Un délai supplémentaire est nécessaire afin d’assurer un résultat qui répond aux normes de qualité du Bureau. \\r\\n\\r\\nNous vous proposons donc de reporter la livraison au <<NewDeadline_FR>>. Merci de nous confirmer si ce nouvel échéancier vous convient. À défaut de réponse, nous l’adopterons afin d’éviter tout retard supplémentaire.\\r\\n\\r\\nNous regrettons les inconvénients que ce report pourrait occasionner et vous remercions de votre compréhension.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nDespite our best efforts, we will not be able to meet the original delivery date. Additional time is required to ensure that the result meets the Translation Bureau’s quality standards. \\r\\n\\r\\nWe are proposing to change the delivery date to <<NewDeadline_EN>>. Please confirm if this new date works for you. If we do not hear back from you, we will use a new delivery date to avoid any further delays.\\r\\n\\r\\nWe apologize for any inconvenience this may cause and thank you for your understanding.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number","new_deadline"]},{"id":"ctd010","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Projet <<ProjectNumber_FR>> – Instructions concernant les images","en":"Project <<ProjectNumber_EN>> - instructions regarding images"},"description":{"fr":"Demande de version modifiable d’un document PDF","en":"Non-editable images – requesting clarification"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Instructions concernant les images","en":"Project <<ProjectNumber_EN>> - instructions regarding images"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n\\r\\nLe document transmis contient des images non modifiables. Souhaitez-vous que leur contenu soit traduit? Dans l’affirmative, disposez-vous des versions modifiables? À défaut, nous pourrons insérer la traduction dans une légende distincte.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous transmettre vos instructions dès que possible. Nous traiterons entretemps les parties modifiables du document.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nThe document you sent contains non-editable images. Would you like the content of these images to be translated? If so, do you have editable versions available? If not, we can include a translation in a separate caption.\\r\\n\\r\\nCould you please send us your instructions as soon as possible? In the meantime, the editable parts of the document will be translated.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd011","category":"documents_and_formatting","category_fr":"Documents et formats","category_en":"Documents and formatting","title":{"fr":"Projet <<ProjectNumber_FR>> – Saisies d’écran requises","en":"Project <<ProjectNumber_EN>> – request for screenshots"},"description":{"fr":"Demande d'informations supplémentaires pour traitements de captures d'écrans","en":"Requesting screenshots"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Saisies d’écran requises","en":"Project <<ProjectNumber_EN>> – request for screenshots"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>> .\\r\\n\\r\\nAfin de garantir une terminologie exacte, notamment en ce qui a trait aux éléments d’interface (menus, commandes, messages, etc.), nous vous serions reconnaissants de nous transmettre les captures d’écran du logiciel en <<TargetLanguage_FR>>.\\r\\nÀ défaut de nous fournir ces éléments, vous avez deux options : \\r\\n\\r\\n1) nous proposerons une traduction libre, ce qui pourrait entraîner certains écarts avec les libellés réellement utilisés dans l’interface visé; \\r\\n2) nous ne traduirons pas ces éléments.\\r\\n\\r\\nNous suspendrons le traitement du projet en attendant de recevoir vos instructions ou les documents requis.\\r\\n\\r\\nNous vous remercions de votre collaboration et demeurons à votre disposition pour toute question ou tout renseignement complémentaire.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nTo ensure that we use the correct terminology, especially for interface elements such as menus, commands and messages, could you please send us screenshots of the software in <<TargetLanguage_EN>>?\\r\\nTwo options are available if you cannot provide screenshots. \\r\\n\\r\\n1. We will provide an unofficial translation, which may differ from the actual wording used in the interface for the target language.\\r\\n2. We will not provide a translation of these elements.\\r\\n\\r\\nWe will pause work on the project until we receive your instructions or the required materials.\\r\\n\\r\\nWe thank you for your cooperation. Please contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number","target_language"]},{"id":"ctd012","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Projet <<ProjectNumber_FR>> – Notes du présentateur","en":"Project <<ProjectNumber_EN>> – speaker notes"},"description":{"fr":"Présentations PowerPoint - traduction des notes du présentateur","en":"PowerPoint presentations – translating notes"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Notes du présentateur","en":"Project <<ProjectNumber_EN>> – speaker notes"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n\\r\\nVeuillez nous indiquer si vous souhaitez que nous traduisions  uniquement le contenu des diapositives, ou si les notes du présentateur doivent être incluses.\\r\\n \\r\\nNous vous serions reconnaissants de bien vouloir nous confirmer vos instructions afin que nous puissions procéder au traitement de votre projet.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nCould you confirm if you would like us to translate only the content in the PowerPoint slides, or if you would like to have the speaker notes translated as well?\\r\\n \\r\\nWe would appreciate it if you could let us know so that we can process your project.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd013","category":"security_and_copyright","category_fr":"Sécurité et droits d’auteur","category_en":"Security and copyright","title":{"fr":"Projet <<ProjectNumber_FR>> – Documents protégés par droits d’auteur","en":"Project <<ProjectNumber_EN>> – copyright-protected documents"},"description":{"fr":"Demande de confirmation d'obtention des droits d'auteur","en":"Copyright"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Documents protégés par droits d’auteur","en":"Project <<ProjectNumber_EN>> – copyright-protected documents"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n\\r\\nConformément aux pratiques du Bureau de la traduction, nous ne pouvons traduire une publication protégée par un droit d’auteur sans autorisation écrite de l’auteur ou de l’éditeur. Il incombe aux clients qui soumettent la demande de traduction d’obtenir cette autorisation.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous confirmer que vous disposez de cette autorisation, afin que nous puissions procéder au traitement de votre projet.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nIn accordance with the Translation Bureau’s practices, we cannot translate a publication that is protected by copyright without written authorization from the author or publisher. It is the responsibility of the client who is submitting the translation request to obtain this authorization.\\r\\n\\r\\nCould you please confirm whether you have this authorization so that we can process your project?\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd014","category":"documents_and_formatting","category_fr":"Documents et formats","category_en":"Documents and formatting","title":{"fr":"Projet <<ProjectNumber_FR>> – Documents de référence","en":"Project <<ProjectNumber_EN>> – reference documents"},"description":{"fr":"Demande de documents de références ou versions précédéntes","en":"Requesting reference documents"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Documents de référence","en":"Project <<ProjectNumber_EN>> – reference documents"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>. \\r\\n\\r\\nAfin de faciliter le travail de traduction et d’en assurer la qualité et l’uniformité, nous vous invitons à nous transmettre, s’il y a lieu, des documents de référence ou des versions antérieures en français et en anglais. Il est important que ces documents soient disponibles dans les deux langues et qu’ils correspondent entre eux, afin d’assurer une cohérence optimale dans le traitement de votre projet.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous transmettre ces documents dès que possible, afin que nous puissions procéder efficacement au traitement de votre projet.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>. \\r\\n\\r\\nTo help our translation work and ensure quality and consistency, we ask that you send us any reference documents or previous versions in English and French, if available. It is important that these documents are bilingual and that their content matches each other to ensure optimal consistency throughout your project.\\r\\n\\r\\nCould you please send us these documents as soon as possible so that we can process your project efficiently?\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd015","category":"security_and_copyright","category_fr":"Sécurité et droits d’auteur","category_en":"Security and copyright","title":{"fr":"Projet <<ProjectNumber_FR>> – Transmission sécurisée requise","en":"Project <<ProjectNumber_EN>> – secure transmission required"},"description":{"fr":"Demande de précisions sur la classification d'un document","en":"Protected documents – secure transmission"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Transmission sécurisée requise","en":"Project <<ProjectNumber_EN>> – secure transmission required"},"body":{"fr":"Bonjour, \\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n\\r\\nNotre plateforme GClingua traite exclusivement les fichiers dont le niveau de confidentialité n’excède pas PROTÉGÉ B. Le document que vous avez soumis semble dépasser la classification établie et a été retiré du système par mesure de sécurité. \\r\\n\\r\\nSi vous croyez qu’il s’agit d’une erreur, veuillez apporter les corrections nécessaires, télécharger le document à nouveau et nous aviser par courriel.\\r\\n\\r\\nNous vous prions de bien vouloir utiliser la procédure de transmission sécurisée ci-jointe pour nous le faire parvenir de manière conforme.\\r\\n\\r\\nNous vous remercions de votre collaboration et demeurons à votre disposition pour toute question ou tout renseignement complémentaire.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nThe GClingua platform supports files classified up to PROTECTED B only. The document you submitted appears to exceed this classification and has been removed from the system for security reasons. \\r\\n\\r\\nIf you believe that there was an error, please make the necessary adjustments, upload the document again and notify us by email.\\r\\n\\r\\nTo ensure compliance, please follow the attached secure transmission procedure to send us the document.\\r\\n\\r\\nWe thank you for your cooperation. Please contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd016","category":"deadlines_and_delivery","category_fr":"Délais et livraisons","category_en":"Deadlines and delivery","title":{"fr":"Projet <<ProjectNumber_FR>> – Ajustement de la date de livraison","en":"Project <<ProjectNumber_EN>> – delivery date adjustment"},"description":{"fr":"Report de délai ou nouvelle date de livraison en raison d'un congé férié","en":"Adjusting the delivery date – statutory holiday"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Ajustement de la date de livraison","en":"Project <<ProjectNumber_EN>> – delivery date adjustment"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet « ProjectNumber_FR ».\\r\\n\\r\\nLa date de livraison demandée, soit le <<OriginalDate_FR>>, coïncide avec un jour férié. Celle-ci a donc été reportée au jour ouvrable suivant, soit le <<NewDate_FR>>.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous confirmer que cet ajustement vous convient.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nThe requested delivery date, <<OriginalDate_EN>>, falls on a statutory holiday and has been moved to the next working day, <<NewDate_EN>>.\\r\\n\\r\\nCould you please confirm whether this adjustment works for you?\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number","original_date","new_date"]},{"id":"ctd017","category":"deadlines_and_delivery","category_fr":"Délais et livraisons","category_en":"Deadlines and delivery","title":{"fr":"Projet <<ProjectNumber_FR>> – Retard de prise FR charge","en":"Project <<ProjectNumber_EN>> – delay in processing"},"description":{"fr":"Avis de retard dans la prise en charge d'une demande","en":"Confirming receipt of project and apologizing for delay in processing"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Retard de prise FR charge","en":"Project <<ProjectNumber_EN>> – delay in processing"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n \\r\\nNous vous prions de nous excuser pour le délai de prise en charge. En raison d’un volume élevé de projets, nous n’avons pas pu entamer le traitement avant aujourd’hui.\\r\\n\\r\\nNous procédons actuellement à la vérification de la disponibilité des ressources nécessaires et vous confirmons qu’aucun frais d’urgence ne sera appliqué.\\r\\n \\r\\nNous vous remercions de votre compréhension et demeurons à votre disposition pour toute question ou tout renseignement complémentaire.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n \\r\\nWe apologize for the delay in processing your project. Due to a high volume of projects, we were unable to start working on it until today.\\r\\n\\r\\nWe are currently checking the availability of the necessary resources and can confirm that no rush premium will apply.\\r\\n\\r\\nWe thank you for your understanding. Please contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd018","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Projet <<ProjectNumber_FR>> – Demande de révision","en":"Project <<ProjectNumber_EN>> – request for revision"},"description":{"fr":"Conseil pour traduction client de mauvaise qualité","en":"Requesting comparative/client revision"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Demande de révision","en":"Project <<ProjectNumber_EN>> – request for revision"},"body":{"fr":"Bonjour, \\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n \\r\\nAprès une première analyse de la traduction fournie, nous avons remarqué plusieurs lacunes. Nous pensons qu’elle nécessiterait plus qu’une simple révision. Par souci de qualité, nous recommandons donc une retraduction complète à partir du texte source, afin d’assurer un résultat fidèle, fluide et professionnel.\\r\\n\\r\\nPourriez-vous nous confirmer si vous souhaitez aller de l’avant avec ce service?\\r\\n\\r\\nBien cordialement,","en":"Hello, \\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>. \\r\\n\\r\\nAfter an initial review of the translation provided, we have identified several issues and believe that the translation requires more than a basic revision. For quality purposes, we recommend a full retranslation of the source text to ensure a faithful, fluent and professional result.\\r\\n\\r\\nCould you please confirm whether you would like to proceed with this service?\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd019","category":"quotes_and_approvals","category_fr":"Devis et approbations","category_en":"Quotes and approvals","title":{"fr":"Devis pour transcription – Projet <<ProjectNumber_FR>>","en":"Project <<ProjectNumber_EN>> – quote for transcription"},"description":{"fr":"Devis pour transcription","en":"Requesting a quote for transcription"},"subject":{"fr":"Devis pour transcription – Projet <<ProjectNumber_FR>>","en":"Project <<ProjectNumber_EN>> – quote for transcription"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n\\r\\nLe coût estimé pour ce projet se situe entre <<MinAmount_FR>> $ et <<MaxAmount_FR>> $, en fonction de la durée et de la qualité de l’enregistrement.\\r\\nVous devrez prévoir un délai d’environ <<NbDays_FR>> jour(s) ouvrable(s) pour la livraison.\\r\\n\\r\\nAfin de bien orienter votre projet, nous vous invitons à nous transmettre tous les détails qui pourraient nous être utiles (ex. : format de livraison souhaité, exigences particulières, contexte d’utilisation, etc.).\\r\\nNous vous serions aussi reconnaissants de préciser si vous souhaitez que nous traduisions ensuite la transcription.\\r\\n\\r\\nNous attendons votre approbation et vos précisions avant d’aller de l’avant.\\r\\n\\r\\nN’hésitez pas à nous contacter pour toute question.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nThe estimated cost for this project is between $<<MinAmount_EN>> and $<<MaxAmount_EN>>, depending on the length and quality of the recording. \\r\\nYou can expect it to be delivered in approximately <<NbDays_EN>> working day(s).\\r\\n\\r\\nTo better understand your project, please share any relevant details (e.g., preferred delivery format, specific requirements, intended use, etc.).\\r\\nCould you also please tell us if you would like us to translate the transcript once it is completed?\\r\\n\\r\\nWe will wait for your approval and clarification before proceeding.\\r\\n\\r\\nPlease feel free to contact us if you have any questions.\\r\\n\\r\\nBest regards,"},"variables":["project_number","min_amount","max_amount","nb_days"]},{"id":"ctd020","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Projet <<ProjectNumber_FR>> – Documents imbriqués","en":"Project <<ProjectNumber_EN>> – embedded documents"},"description":{"fr":"Demande de précisions pour documents imbriqués","en":"Embedded documents"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Documents imbriqués","en":"Project <<ProjectNumber_EN>> – embedded documents"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n\\r\\nAprès analyse du document soumis, nous avons constaté qu’il contient un ou plusieurs documents imbriqués (ex. : tableaux, documents Excel ou Powerpoint).\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous confirmer si ces documents intégrés doivent également être traduits.\\r\\n\\r\\nLe cas échéant, nous vous invitons à nous les transmettre séparément en pièces jointes, de préférence dans leur format d’origine.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nAfter reviewing the submitted document, we noticed that it contains one or more embedded documents (e.g., tables, Excel or PowerPoint files).\\r\\n\\r\\nCould you please confirm whether these embedded documents should also be translated?\\r\\nIf so, please send them as separate attachments, preferably in their original format.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["min_amount","project_number"]},{"id":"ctd021","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Projet <<ProjectNumber_FR>> – Confirmation du documFRt ou de la combinaison de langues","en":"Project <<ProjectNumber_EN>> – document or language combination confirmation"},"description":{"fr":"Confirmation de combinaison de langues","en":"Confirming a document or language combination"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Confirmation du documFRt ou de la combinaison de langues","en":"Project <<ProjectNumber_EN>> – document or language combination confirmation"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>> et souhaitons confirmer une information auprès de vous.\\r\\n\\r\\nVotre demande indique une traduction du <<SourceLanguage_FR>> vers le <<TargetLanguage_FR>>. Toutefois, le document soumis est rédigé en <<DetectedLanguage_FR>>.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous confirmer s’il s’agit d’un document soumis par erreur ou d’une combinaison linguistique erronée sélectionnée lors de la création du projet.\\r\\n\\r\\nNous attendons votre confirmation avant de pouvoir aller de l’avant.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>> and would like to confirm one detail with you.\\r\\n\\r\\nYour request indicates a translation from <<SourceLanguage_EN>> to <<TargetLanguage_EN>>; however, the submitted document appears to be written in <<DetectedLanguage_EN>>.\\r\\n\\r\\nCould you please confirm whether the wrong document was submitted or the wrong language combination was selected when creating the project?\\r\\n\\r\\nWe will wait for your confirmation before proceeding.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number","source_language","target_language","detected_language"]},{"id":"ctd022","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Projets <<ProjectNumber1_FR>>, <<ProjectNumber2_FR>> et <<ProjectNumber3_FR>> – Demande de priorisation","en":"Projects <<ProjectNumber1_EN>>, <<ProjectNumber2_EN>> and <<ProjectNumber3_EN>>  – prioritization request"},"description":{"fr":"Priorisation de projets en cours de traitement","en":"Prioritization request – current projects"},"subject":{"fr":"Projets <<ProjectNumber1_FR>>, <<ProjectNumber2_FR>> et <<ProjectNumber3_FR>> – Demande de priorisation","en":"Projects <<ProjectNumber1_EN>>, <<ProjectNumber2_EN>> and <<ProjectNumber3_EN>>  – prioritization request"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous avons bien reçu plusieurs projets de votre part qui sont présentement en cours d’analyse. Afin de planifier efficacement le travail, nous vous invitons à nous indiquer l’ordre de priorité pour les projets suivants :\\r\\n•\\t<<ProjectNumber1_FR>>\\r\\n•\\t<<ProjectNumber2_FR>>\\r\\n•\\t<<ProjectNumber3_FR>>\\r\\n•\\t(…)\\r\\n\\r\\nCela nous permettra, lorsque possible, d’assigner les mêmes ressources linguistiques à vos projets et ainsi d’assurer une uniformité dans le style et la terminologie.\\r\\n\\r\\nNous vous remercions à l’avance pour votre collaboration et demeurons à votre disposition pour toute question ou tout renseignement complémentaire.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received several projects from you, which are currently being reviewed. To help us prepare the work efficiently, please indicate the order of priority for the following projects:\\r\\n•\\t<<ProjectNumber1_EN>>\\r\\n•\\t<<ProjectNumber2_EN>>\\r\\n•\\t<<ProjectNumber3_EN>>\\r\\n•\\t(...)\\r\\n\\r\\nThis will allow us, whenever possible, to assign the same language resources to your projects, ensuring consistency in style and terminology.\\r\\n\\r\\nWe thank you in advance for your cooperation. Please contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number1","project_number2","project_number3"]},{"id":"ctd023","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Projet <<ProjectNumber_FR>> - Service en langage clair et simple","en":"Project <<ProjectNumber_EN>> – plain language services"},"description":{"fr":"Précisions pour services en language clair et simples","en":"Plain language services"},"subject":{"fr":"Projet <<ProjectNumber_FR>> - Service en langage clair et simple","en":"Project <<ProjectNumber_EN>> – plain language services"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n\\r\\nVous avez indiqué nécessiter un traitement en langage clair et simple.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir préciser à quel public le document est destiné (ex. : population générale, clientèle spécifique, employés internes, etc.).\\r\\n\\r\\nCette information nous permettra de cibler le ton et la formulation de manière à répondre aux besoins des destinataires du texte.\\r\\n\\r\\nNous attendons votre réponse avant d’aller de l’avant.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have received Project <<ProjectNumber_EN>>.\\r\\n\\r\\nYou have requested plain language editing.\\r\\n\\r\\nCould you please tell us who the intended audience is (e.g., general public, specific clients, internal staff, etc.)?\\r\\n\\r\\nThis information will help us tailor the tone and wording of text to the needs of the audience.\\r\\n\\r\\nWe will wait for your response before proceeding.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd024","category":"follow_ups_and_cancellations","category_fr":"Suivis et annulations","category_en":"Follow-ups and cancellations","title":{"fr":"Projet <<ProjectNumber_FR>> – Retour d’information sur l’annulation","en":"Project <<ProjectNumber_EN>> – feedback on cancellation"},"description":{"fr":"Demande de retour d'information suite à une annulation","en":"Cancellation – feedback"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Retour d’information sur l’annulation","en":"Project <<ProjectNumber_EN>> – feedback on cancellation"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous avons constaté l’annulation de votre projet <<ProjectNumber_FR>> et souhaiterions comprendre ce qui a motivé cette décision.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous préciser ce qui a motivé l’annulation, qu’il s’agisse, par exemple, de contraintes de budget, de délai ou d’autres considérations.\\r\\n\\r\\nQuelle que soit la raison, votre retour nous serait précieux, car nous accordons une grande importance à la satisfaction de nos clients et cherchons constamment à améliorer nos services.\\r\\n\\r\\nNous vous remercions d’avance pour le temps que vous consacrerez à cette rétroaction et demeurons à votre disposition pour toute question ou tout renseignement complémentaire.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe have noted the cancellation of Project <<ProjectNumber_EN>> and would like to understand the reasons behind this decision.\\r\\n\\r\\nIf possible, could you tell us what led to the cancellation, whether it was due to budget constraints, the deadline or other considerations?\\r\\n\\r\\nWhatever the reason, your feedback is valuable to us, as we are committed to client satisfaction and continuously improving our services.\\r\\n\\r\\nWe thank you in advance for taking the time to provide feedback. Please contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd025","category":"deadlines_and_delivery","category_fr":"Délais et livraisons","category_en":"Deadlines and delivery","title":{"fr":"Projet <<ProjectNumber_FR>> – Interruption de service temporaire","en":"Project <<ProjectNumber_EN>> – temporary service interruption"},"description":{"fr":"Avis d'interruption de service de service temporaire et de retard de livraison","en":"System outages and tool failures"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Interruption de service temporaire","en":"Project <<ProjectNumber_EN>> – temporary service interruption"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous souhaitons vous informer qu’une panne technique affecte actuellement nos systèmes internes, ce qui entraîne un ralentissement de nos opérations, y compris le traitement de votre projet <<ProjectNumber_FR>>.\\r\\n\\r\\nNos équipes techniques sont mobilisées pour rétablir la situation dans les plus brefs délais. Cependant, d'ici là, nous éprouvons un ralentissement de nos opérations.\\r\\n\\r\\nPour cette raison, l'échéancier de votre projet devra vraisemblablement être ajusté. Nous nous excusons pour les inconvénients; soyez assuré que nous le livrerons dès que possible.\\r\\n\\r\\nNous vous remercions de votre compréhension et de votre patience pendant cette interruption temporaire.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe would like to inform you that a technical issue is currently affecting our internal systems, which is causing delays in our operations, including the processing of Project <<ProjectNumber_EN>>.\\r\\n\\r\\nOur technical teams are actively working to resolve the issue as quickly as possible. However, in the meantime, our operations will proceed slower than normal.\\r\\n\\r\\nAs a result, the time frame for your project may need to be adjusted. We apologize for the inconvenience and assure you that we will deliver your project as soon as possible.\\r\\n\\r\\nThank you for your understanding and support during this temporary interruption.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd026","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Projet <<ProjectNumber_EN>> – Précision requise sur le type de révision souhaité","en":"Project <<ProjectNumber_EN>> – clarification required on type of revision"},"description":{"fr":"Demande de précisions pour type de révision ou relecture","en":"Clarifying requested services – comparative revision or unilingual editing"},"subject":{"fr":"Projet <<ProjectNumber_EN>> – Précision requise sur le type de révision souhaité","en":"Project <<ProjectNumber_EN>> – clarification required on type of revision"},"body":{"fr":"Bonjour,\\r\\n\\r\\nAfin d’orienter adéquatement le traitement de votre projet <<ProjectNumber_FR>>, nous aimerions confirmer le type de révision que vous souhaitez. Nous offrons deux services distincts :\\r\\n\\r\\nRévision comparative\\r\\nLe texte traduit est comparé au texte source pour en vérifier l’exactitude, l’exhaustivité et la fidélité. Ce type de révision permet de corriger les erreurs de sens et d’assurer une bonne formulation dans la langue cible.\\r\\n\\r\\nRévision unilingue\\r\\nLe texte est révisé uniquement dans la langue d’origine, sans référence au texte dans une autre langue. L’accent est mis sur la clarté, la fluidité, la grammaire, la ponctuation et la cohérence du texte.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir préciser vos besoins, ou de nous indiquer l’objectif principal de votre demande, afin que nous puissions vous orienter vers l’option la plus appropriée. \\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nTo ensure that Project <<ProjectNumber_EN>> is processed appropriately, we would like to confirm the type of revision you are requesting. We offer two distinct services:\\r\\n\\r\\nComparative revision\\r\\nThe translated text is compared to the source text to check for accuracy, completeness and fidelity. This type of revision corrects errors in meaning and ensures proper wording in the target language.\\r\\n\\r\\nUnilingual editing\\r\\nThe text is revised in the target language only, without reference to the text in another language. The focus is on the text’s clarity, flow, grammar, punctuation and coherence.\\r\\n\\r\\nCould you clarify which service you would prefer or tell us the main objective of your project so that we can recommend the most suitable option?\\r\\n \\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd027","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Projet <<ProjectNumber_FR>> – Précision requise sur le type de service souhaité","en":"Project <<ProjectNumber_EN>> – clarification required on type of service"},"description":{"fr":"Demande de précision pour le type de service (révision ou traduction de modifications)","en":"Clarifying requested services – translation of modified documents or comparative revision"},"subject":{"fr":"Projet <<ProjectNumber_FR>> – Précision requise sur le type de service souhaité","en":"Project <<ProjectNumber_EN>> – clarification required on type of service"},"body":{"fr":"Bonjour,\\r\\n\\r\\nNous accusons réception du projet <<ProjectNumber_FR>>.\\r\\n\\r\\nAfin d’orienter adéquatement le traitement de votre demande, voici quelques précisions sur les services disponibles :\\r\\n\\r\\nTraduction de modifications\\r\\nCe service consiste à traduire uniquement les parties du texte qui ont été modifiées par rapport à une version antérieure du document. Il convient lorsque les changements sont limités et bien identifiés. Lorsque les modifications sont nombreuses, dispersées ou complexes, l’effort requis peut s’approcher de celui d’une retraduction complète. Dans ce cas, la facturation est basée sur le temps réel nécessaire pour effectuer le travail. Selon l’ampleur des changements, une nouvelle traduction peut parfois s’avérer plus efficace et rentable.\\r\\n\\r\\nRévision comparative\\r\\nLa révision comparative consiste à comparer une traduction au texte original afin d’en valider la fidélité, la cohérence et la qualité linguistique. Le réviseur travaille sur le texte traduit déjà livré, en le modifiant au besoin pour améliorer la formulation, corriger les fautes, harmoniser le style et s’assurer qu’il reflète adéquatement le sens du texte original. Il ne s’agit pas d’une retraduction, mais d’un travail de révision et d’optimisation du contenu existant.\\r\\n\\r\\nNous vous serions reconnaissants de bien vouloir nous préciser vos préférences, ou de nous transmettre la version finale du document si cela n’est pas déjà fait, afin que nous puissions vous recommander l’option la plus appropriée.\\r\\n\\r\\nPour toute question ou tout renseignement complémentaire, n’hésitez pas à communiquer avec nous.\\r\\n\\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nWe acknowledge receipt of the project <<ProjectNumber_EN>>.\\r\\n\\r\\nTo provide you with the best possible guidance regarding your request, please consider the following details on our available services:\\r\\n\\r\\nTranslation of modified documents\\r\\nThis service involves translating only the parts of the text that have been modified from a previous version of the document. It is suitable when the changes are limited and clearly indicated. When the changes are numerous, scattered or complex, the effort required may be equivalent to that of a full retranslation. In such cases, billing is based on the actual time needed to complete the work. Depending on the extent of the changes, a new translation may sometimes be more efficient and cost-effective.\\r\\n\\r\\nComparative revision\\r\\nThis service involves comparing a translation to the original text in order to check its fidelity, consistency and linguistic quality. The reviser works on the translation received, making changes as necessary to improve the wording, correct errors, standardize the style, and ensure that the meaning accurately reflects the original text. This involves revising and optimizing the existing content rather than retranslating it.\\r\\n\\r\\nWe would appreciate it if you could confirm your preference, or send us the final version of the document if you have not already, so that we can recommend the most appropriate option.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nBest regards,"},"variables":["project_number"]},{"id":"ctd028","category":"clarifications_and_client_instructions","category_fr":"Précisions et instructions client","category_en":"Clarifications and client instructions","title":{"fr":"Présentation des services et tarifs","en":"Overview of services and rates"},"description":{"fr":"Renseignements généraux sur les services et tarifs","en":"Services and rates"},"subject":{"fr":"Présentation des services et tarifs","en":"Overview of services and rates"},"body":{"fr":"Bonjour,\\r\\n\\r\\nMerci de l’intérêt que vous portez à nos services.\\r\\n\\r\\nPour vous aider à mieux comprendre nos services et la structure de nos prix, vous trouverez ci-joint les versions française et anglaise du tableau résumant chacun de nos services ainsi que les tarifs correspondants.\\r\\n\\r\\nN’hésitez pas à nous écrire si vous avez des questions ou si vous souhaitez des précisions supplémentaires.\\r\\n\\r\\nVoici également les coordonnées de nos gestionnaires de portefeuilles clients:\\r\\nNeysa McLeod: neysa.mcleod@tpsgc-pwgsc.gc.ca\\r\\nMélanie Danis: melanie.danis@tpsgc-pwgsc.gc.ca\\r\\n \\r\\nBien cordialement,","en":"Hello,\\r\\n\\r\\nThank you for your interest in our services.\\r\\n\\r\\nTo help you better understand our services and pricing structure, please find attached the English and French versions of a table summarizing each of our services and the corresponding rates.\\r\\n\\r\\nPlease feel free to contact us if you have any questions or need more information.\\r\\n\\r\\nPlease find the contact information of our client portfolio managers below:\\r\\nNeysa McLeod: neysa.mcleod@tpsgc-pwgsc.gc.ca\\r\\nMélanie Danis: melanie.danis@tpsgc-pwgsc.gc.ca \\r\\n\\r\\nBest regards,"},"variables":[]},{"id":"ctd029","category":"security_and_copyright","category_fr":"Sécurité et droits d’auteur","category_en":"Security and copyright","title":{"fr":"Avis de bris de sécurité - mesures à prendre","en":"Security breach notification - actions to be taken"},"description":{"fr":"Instructions to external provider following a security breach","en":"Instructions au fournisseur externe suite à un bris de sécurité"},"subject":{"fr":"Avis de bris de sécurité - mesures à prendre","en":"Security breach notification - actions to be taken"},"body":{"fr":"Bonjour,\\r\\n\\r\\nJe vous écris pour vous informer qu’une erreur a eu lieu concernant l’envoi de documents protégés. Cette situation doit être rectifiée immédiatement afin de garantir la sécurité et la confidentialité des informations.\\r\\n\\r\\nVoici les actions que vous devez prendre sans délai :\\r\\n\\r\\nVérification du téléchargement des documents\\r\\nVeuillez confirmer si vous avez téléchargé les documents que nous vous avons envoyés. Cette étape est essentielle afin de déterminer si les documents ont été enregistrés sur vos systèmes. Si vous avez téléchargé ces documents, il est impératif que vous procédiez à la suppression immédiate de toutes les copies.\\r\\n\\r\\nSuppression de toutes les copies des documents\\r\\nSi les documents ont été téléchargés, merci de les supprimer dans leur intégralité de tous vos dispositifs et supports de stockage, y compris, mais sans s'y limiter :\\r\\nSur votre serveur\\r\\nSur votre ordinateur local\\r\\nDans tous les systèmes ou bases de données où les documents ont pu être copiés ou stockés\\r\\nSur tout autre dispositif ou réseau pouvant avoir conservé une copie des documents (disques durs externes, systèmes de sauvegarde, etc.)\\r\\n\\r\\nCette suppression doit être effectuée de manière complète, en vous assurant qu'aucune copie résiduelle ne subsiste sur vos systèmes.\\r\\n\\r\\nVérification des mémoires non protégées\\r\\nAssurez-vous également que ces documents n’ont pas été transférés dans des zones de stockage non protégées, telles que des dossiers non sécurisés, des applications tierces, ou des dispositifs de stockage amovibles. Si tel est le cas, veuillez procéder à la suppression de ces copies sans délai.\\r\\n\\r\\nConfirmation de la suppression\\r\\nUne fois toutes les copies supprimées, merci de nous confirmer par retour de courriel que cette action a été réalisée avec succès. Il est essentiel que nous recevions une confirmation de votre part afin de clore cette situation.\\r\\n\\r\\nEnfin, nous vous demandons de nous signaler toute difficulté que vous pourriez rencontrer lors de la mise en œuvre de ces actions, ou si vous avez besoin d'assistance technique.\\r\\n\\r\\nNous comprenons que cette situation puisse engendrer des désagréments et nous vous remercions pour votre collaboration rapide et efficace pour assurer la sécurité des informations. Nous restons à votre disposition pour toute question ou précision supplémentaire.\\r\\n\\r\\nCordialement,","en":"Hello,\\r\\n\\r\\nI am writing to inform you that an error has occurred regarding the transmission of protected documents. This situation must be rectified immediately to ensure the security and confidentiality of the information.\\r\\n\\r\\nHere are the actions you need to take without delay:\\r\\n\\r\\nVerification of document download\\r\\nPlease confirm whether you have downloaded the documents we sent you. This step is essential to determine if the documents have been saved on your systems. If you have downloaded these documents, it is imperative that you proceed with the immediate deletion of all copies.\\r\\n\\r\\nDeletion of all copies of the documents\\r\\nIf the documents have been downloaded, please delete them entirely from all your devices and storage media, including, but not limited to:\\r\\nOn your server\\r\\nOn your local computer\\r\\nIn all systems or databases where the documents may have been copied or stored\\r\\nOn any other device or network that may have retained a copy of the documents (external hard drives, backup systems, etc.)\\r\\n\\r\\nThis deletion must be carried out thoroughly, ensuring that no residual copies remain on your systems.\\r\\n\\r\\nVerification of unprotected storage\\r\\nAlso ensure that these documents have not been transferred to unprotected storage areas, such as unsecured folders, third-party applications, or removable storage devices. If this is the case, please proceed with the deletion of these copies without delay.\\r\\n\\r\\nConfirmation of deletion\\r\\nOnce all copies have been deleted, please confirm by replying to this email that this action has been successfully completed. It is crucial that we receive a confirmation from you to close this matter.\\r\\n\\r\\nFinally, we ask that you report any difficulty you may encounter while carrying out these actions, or if you need any technical assistance.\\r\\n\\r\\nWe understand that this situation may cause inconvenience, and we thank you for your prompt and efficient cooperation to ensure the security of the information. We remain available for any questions or additional clarifications.\\r\\n\\r\\nBest regards,"},"variables":[]},{"id":"insat_qualite_nouvelleAMA","category":"unsatisfactory","title":{"fr":"Avis pour qualité insatisfaisante - nouvelle AMA","en":"Notice for unsatisfactory quality - New AMA"},"description":{"fr":"Avis pour qualité insatisfaisante - nouvelle AMA","en":"Notice for unsatisfactory quality - New AMA"},"subject":{"fr":"","en":""},"body":{"fr":"Hello,\\n\\nUnder Article A6 of the Statement of Work for contract No. <<contract_number_EN>>, you are obliged to provide translation work that meets the quality and timeliness standards for official languages translation. \\n\\nCanada hereby advises you that translation request No. <<project_number_EN>> was deemed to be unsatisfactory. As stated in clause <<article_number1_EN>>, Notice of Unsatisfactory Performance, of your contract, notices of unsatisfactory performance affect the quality indicator and may result in termination of the contract for default and suspension of the supply arrangement in whole or in part.\\n\\nPlease note that Canada will deduct a fee of $<<penalty_EN>> (excluding taxes) from your invoice in order to compensate Canada for the additional costs relating to the production of a deliverable translation (see clause <<article_number2_EN>>of your contract for more information.\\n\\nIf you disagree with this email and wish to challenge the notice of unsatisfactory performance, please send your comments in writing, as described in clause <<article_number3_EN>>, Challenge Mechanism Following a Notice of Unsatisfactory Performance, of your contract, for reconsideration.\\n\\nPlease note that this unsatisfactory evaluation will be placed on your file.\\n\\nThank you.","en":"Bonjour,\\n\\nEn vertu de l’article A6 de l’énoncé des travaux du contrat no <<contract_number_FR>>, vous êtes tenu de fournir les travaux de traduction conformément aux normes de qualité et respect des délais pour la traduction en langues officielles.\\n\\nPar la présente, le Canada vous informe que le texte no <<project_number_FR>> a été jugé insatisfaisant. Comme stipulé à l’article <<article_number1_FR>> Avis de prestations insatisfaisantes du contrat, les avis de prestations insatisfaisantes ont une incidence sur l’indice de qualité et peuvent entraîner la résiliation d’un contrat pour manquement et la suspension de l’AMA du fournisseur, en partie ou en entier.  \\n\\nVeuillez prendre note que le Canada déduira des frais de <<penalty_FR>> $ (taxes non comprises) de votre facture afin de le dédommager du coût additionnel lié à la production d’une traduction livrable (voir article <<article_number2_FR>> du contrat pour plus d’information). \\n\\nSi vous n’êtes pas d’accord avec le présent courriel, et que vous désirez contester l’avis de prestation insatisfaisante, veuillez faire parvenir vos observations par écrit selon les modalités décrites à l’article <<article_number3_FR>> Mécanisme de contestation suite à un avis de prestation insatisfaisante de votre contrat, pour fins de réexamen. \\n\\nVeuillez prendre note que cette évaluation insatisfaisante sera versée à votre dossier.  \\n\\nMerci."},"variables":["article_number1","article_number2","article_number3","contract_number","penalty","project_number"],"category_fr":"Fournisseurs externes - Qualité insatisfaisante","category_en":"External Providers - unsatisfactory quality"}]`),ao={project_number:{description:{en:"Project number",fr:"Numéro de projet"},example:{en:"123-4567-001",fr:"123-4567-001"},format:"text"},nb_days:{description:{en:"Estimated number of working days",fr:"Nombre estimé de jours ouvrables"},example:{en:"3",fr:"3"},format:"number"},cost:{description:{en:"Estimated cost in dollars",fr:"Coût estimé en dollars"},example:{en:"1500",fr:"1500"},format:"number"},urgent_cost:{description:{en:"Estimated cost with rush premium",fr:"Coût estimé avec prime d’urgence"},example:{en:"1200",fr:"1200"},format:"number"},date:{description:{en:"Date when the quote was sent",fr:"Date d’envoi du devis"},example:{en:"2025-01-15",fr:"15 janvier 2025"},format:"date"},deadline_time:{description:{en:"Time limit to confirm the preferred option",fr:"Heure limite pour confirmer l’option retenue"},example:{en:"5 p.m.",fr:"17 h"},format:"text"},deadline_date:{description:{en:"Final date to receive a response",fr:"Date limite pour recevoir une réponse"},example:{en:"2025-01-22",fr:"22 janvier 2025"},format:"date"},page_count:{description:{en:"Approximate number of pages",fr:"Nombre approximatif de pages"},example:{en:"10",fr:"10"},format:"number"},estimated_cost:{description:{en:"Estimated cost in dollars",fr:"Coût estimé en dollars"},example:{en:"800",fr:"800"},format:"number"},dprate:{description:{en:"Desktop publishing hourly rate",fr:"Taux horaire d’éditique"},example:{en:"75",fr:"75"},format:"number"},dphours:{description:{en:"Estimated desktop publishing hours",fr:"Nombre estimé d’heures d’éditique"},example:{en:"2",fr:"2"},format:"number"},new_date:{description:{en:"Adjusted delivery date",fr:"Nouvelle date de livraison"},example:{en:"2025-07-02",fr:"2 juillet 2025"},format:"date"},new_deadline:{description:{en:"Proposed new delivery date",fr:"Nouvelle date de livraison proposée"},example:{en:"2025-02-20",fr:"20 février 2025"},format:"date"},target_language:{description:{en:"Target language indicated in the request",fr:"Langue cible indiquée dans la demande"},example:{en:"French",fr:"français"},format:"text"},original_date:{description:{en:"Original requested delivery date",fr:"Date de livraison demandée initialement"},example:{en:"2025-07-01",fr:"1er juillet 2025"},format:"date"},min_amount:{description:{en:"Minimum estimated cost in dollars",fr:"Coût estimé minimal en dollars"},example:{en:"300",fr:"300"},format:"number"},max_amount:{description:{en:"Maximum estimated cost in dollars",fr:"Coût estimé maximal en dollars"},example:{en:"900",fr:"900"},format:"number"},source_language:{description:{en:"Source language indicated in the request",fr:"Langue source indiquée dans la demande"},example:{en:"English",fr:"anglais"},format:"text"},detected_language:{description:{en:"Language detected in the submitted document",fr:"Langue détectée dans le document soumis"},example:{en:"French",fr:"français"},format:"text"},project_number1:{description:{en:"First project number to prioritize",fr:"Numéro du premier projet à prioriser"},example:{en:"123-4567-001",fr:"123-4567-001"},format:"text"},project_number2:{description:{en:"Second project number to prioritize",fr:"Numéro du deuxième projet à prioriser"},example:{en:"123-4567-002",fr:"123-4567-002"},format:"text"},project_number3:{description:{en:"Third project number to prioritize",fr:"Numéro du troisième projet à prioriser"},example:{en:"123-4567-003",fr:"123-4567-003"},format:"text"},clientname:{description:{fr:"Nom du client",en:"Client name"},format:"text",example:{fr:"Madeleine",en:"Louise"}},id:{description:{fr:"Identification FR",en:"Identification EN"},format:"text",example:{fr:"Dete FR",en:"Date EN"}},da:{description:{fr:"",en:""},format:"text",example:{fr:"",en:""}},datelimite:{description:{fr:"date limite FR",en:"date limite EN"},format:"text",example:{fr:"hello",en:"allo"}},article_number1:{description:{fr:"Article - avis de prestations insatisfaisantes",en:"Clause - Notice of Unsatisfactory Performance"},format:"text",example:{fr:"20.1",en:"20.1"}},article_number2:{description:{fr:"Article - dommages et interêts",en:"Clause - Damages and Interests"},format:"text",example:{fr:"21",en:"21"}},article_number3:{description:{fr:"Article - Mécanisme de contestation",en:"Clause - Challenge Mechanism"},format:"text",example:{fr:"20.3",en:"20.3"}},contract_number:{description:{fr:"Numéro de contrat",en:"Contract number"},format:"text",example:{fr:"20000XXXX",en:"20000XXXX"}},penalty:{description:{fr:"Pénalité",en:"Penalty"},format:"text",example:{fr:"XXX",en:"XXX"}}},io={metadata:so,templates:oo,variables:ao},Vr="ea_state_v1",lo=()=>{try{const r=localStorage.getItem(Vr);if(r===null)return cr();const i=JSON.parse(r);return{...cr(),...i}}catch(r){return console.warn("Error loading state from localStorage:",r),cr()}},co=r=>{try{const i=JSON.stringify(r);localStorage.setItem(Vr,i)}catch(i){console.warn("Error saving state to localStorage:",i)}},cr=()=>({interfaceLanguage:"fr",templateLanguage:"fr",searchQuery:"",selectedCategory:"all",variables:{},favorites:[],favoritesOnly:!1}),uo=()=>{try{localStorage.removeItem(Vr)}catch(r){console.warn("Error clearing state from localStorage:",r)}},Qe="#1c2f4a",dn={quotes_and_approvals:{bg:"#ede9fe",border:"#c4b5fd",text:Qe},follow_ups_and_cancellations:{bg:"#ffe4e6",border:"#fecdd3",text:Qe},documents_and_formatting:{bg:"#e0f2fe",border:"#bae6fd",text:Qe},deadlines_and_delivery:{bg:"#ffedd5",border:"#fdba74",text:Qe},clarifications_and_client_instructions:{bg:"#fef3c7",border:"#fde68a",text:Qe},security_and_copyright:{bg:"#fee2e2",border:"#fecaca",text:Qe},quality_assurance:{bg:"#dcfce7",border:"#bbf7d0",text:Qe},terminology_and_glossaries:{bg:"#cffafe",border:"#a5f3fc",text:Qe},revisions_and_feedback:{bg:"#fae8ff",border:"#f0abfc",text:Qe},team_coordination:{bg:"#e0e7ff",border:"#c7d2fe",text:Qe},technical_issues:{bg:"#ccfbf1",border:"#99f6e4",text:Qe},general_inquiries:{bg:"#f1f5f9",border:"#cbd5e1",text:Qe},default:{bg:"#e6f0ff",border:"#c7dbff",text:Qe}},mn=(r="",i={})=>{if(i[r]){const s=i[r];return{bg:s+"20",border:s+"80",text:s}}return dn[r]||dn.default},mo=`
  /* Translation Bureau Brand Colors - EXACT MATCH from original design */
  :root {
    /* ECHO brand additions */
    
    --tb-teal: #aca868;         /* Deeper muted gold */
    --tb-teal-light: #aca868;   /* Muted gold - lighter */
    --tb-teal-dark: #a69235;    /* Dark muted gold */
    --tb-sage: #b5af70;         /* Deeper muted gold */
    --tb-sage-light: #b5af70;   /* Muted gold - lighter */
    --tb-mint: #fefbe8;         /* Very light gold - background */
    --tb-cream: #fefefe;        /* Clean white */
  }

  /* Modern typography base */
  * {
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  /* Enhanced variable highlighting styles */
  .variable-highlight {
    background-color: #fef3c7;
    color: #d97706;
    padding: 3px 6px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 15px;
    border: 1px solid #f59e0b;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    letter-spacing: 0.005em;
  }

  /* Subtle, non-blocking underline cues for variable regions in the editor overlay */
  mark.var-highlight {
    background: transparent !important;
    color: transparent !important; /* keep caret/text from being doubled visually */
    border-bottom: 2px dotted rgba(0, 0, 0, 0.5); /* default cue color */
    padding: 0 0 0.05em 0; /* minimal padding for consistent underline */
  }
  mark.var-highlight.filled {
    border-bottom-color: rgba(44, 61, 80, 0.9); /* stronger navy when filled */
  }
  mark.var-highlight.empty {
    border-bottom-color: rgba(156, 163, 175, 0.8); /* gray when empty */
  }
  
  /* Persistent, elegant scrollbar for easy mouse dragging */
  [data-slot="scroll-area-scrollbar"] {
    opacity: 1 !important;
    visibility: visible !important;
    display: flex !important;
    width: 20px !important;
    padding: 4px !important;
    background: linear-gradient(to right, rgba(255,255,255,0.4), rgba(241, 245, 249, 0.9)) !important;
    border-left: 1px solid rgba(203, 180, 74, 0.15) !important;
    pointer-events: auto !important;
    transition: background 0.2s ease !important;
  }
  
  [data-slot="scroll-area-scrollbar"]:hover {
    background: linear-gradient(to right, rgba(255,255,255,0.5), rgba(241, 245, 249, 1)) !important;
  }
  
  /* Smooth but responsive scrolling */
  [data-radix-scroll-area-viewport] {
    scroll-behavior: auto;
    overscroll-behavior: contain;
  }
  
  [data-slot="scroll-area-thumb"] {
    background: linear-gradient(135deg, #aca868 0%, #b5af70 50%, #cbb44a 100%) !important;
    opacity: 1 !important;
    border-radius: 10px !important;
    width: 12px !important;
    min-height: 50px !important;
    box-shadow: 0 2px 6px rgba(138, 133, 53, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
    transition: all 0.15s ease-out !important;
    border: 1px solid rgba(138, 133, 53, 0.2) !important;
    will-change: transform, box-shadow !important;
  }
  
  [data-slot="scroll-area-thumb"]:active {
    background: linear-gradient(135deg, #8a8535 0%, #9a8f45 50%, #a69235 100%) !important;
    box-shadow: 0 1px 3px rgba(138, 133, 53, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
    transform: scaleX(1.05) !important;
    transition: all 0.05s ease-out !important;
  }
  
  [data-slot="scroll-area-scrollbar"]:hover [data-slot="scroll-area-thumb"] {
    background: linear-gradient(135deg, #b5af70 0%, #cbb44a 50%, #d4c05e 100%) !important;
    box-shadow: 0 3px 8px rgba(138, 133, 53, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.4) !important;
    transform: scaleX(1.12) !important;
    border-color: rgba(138, 133, 53, 0.3) !important;
  }
  
  /* Remove visual artifacts in inputs */
  input[type="text"], input[type="number"], input {
    list-style: none !important;
    list-style-type: none !important;
    background-image: none !important;
  }
  
  input::before, input::after {
    content: none !important;
    display: none !important;
  }
  
  /* Remove dots/bullets artifacts */
  input::-webkit-list-button {
    display: none !important;
  }
  
  input::-webkit-calendar-picker-indicator {
    display: none !important;
  }
  
  /* Modern editor typography */
  .editor-container {
    position: relative;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
  }
  
  .editor-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    padding: 16px;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    font-size: 16px;
    font-weight: 400;
    line-height: 1.7;
    letter-spacing: 0.01em;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow: hidden;
    color: transparent;
    z-index: 1;
  }
  
  /* Variable highlighting using <mark> tags in contentEditable */
  mark.var-highlight {
    display: inline;
    padding: 2px 6px;
    border-radius: 6px;
    font-weight: 600;
    background: rgba(203, 180, 74, 0.5); /* warm yellow/amber */
    color: #8a7530; /* navy text */
    border: 1px solid rgba(184, 162, 60, 0.5);
    font-style: normal;
  }
  mark.var-highlight.filled {
    background: rgba(203, 180, 74, 0.7);
    border-color: rgba(184, 162, 60, 0.8);
    font-weight: 700;
  }
  mark.var-highlight.empty {
    background: rgba(203, 180, 74, 0.35);
    border-color: rgba(184, 162, 60, 0.45);
    color: #8a7530;
    font-style: italic;
  }
  /* Focus assist: when a variable input is focused, outline matching marks */
  mark.var-highlight.focused {
    outline: 3px solid rgba(29, 78, 216, 0.9);
    border: 1px solid rgba(29, 78, 216, 0.8);
    box-shadow: 0 0 0 5px rgba(29, 78, 216, 0.25), 0 0 16px rgba(29, 78, 216, 0.35), inset 0 0 0 1px rgba(219, 234, 254, 0.8);
    background: rgba(219, 234, 254, 0.95);
    color: #1e3a8a;
    font-weight: 600;
    transition: outline-color 160ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;
    animation: pulse-focus 1.5s ease-in-out infinite;
  }
  mark.var-highlight.hovered {
    outline: 2px solid rgba(96, 165, 250, 0.6);
    border: 1px solid rgba(59, 130, 246, 0.5);
    box-shadow: 0 0 0 3px rgba(191, 219, 254, 0.4);
    background: rgba(219, 234, 254, 0.5);
    color: #1e40af;
    transition: outline-color 160ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;
  }

  @keyframes pulse-focus {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.92;
    }
  }
  
  .editor-textarea {
    position: relative;
    z-index: 2;
    background: transparent !important;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    font-weight: 400;
    letter-spacing: 0.01em;
  }
  
  /* Input field typography improvements */
  input, textarea {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif !important;
    font-weight: 400;
    letter-spacing: 0.01em;
  }
  
  /* Resizable popup styles */
  .resizable-popup {
    resize: both;
    overflow: auto;
    position: relative;
  }
  
  .resizable-popup::-webkit-resizer {
    display: none; /* Hide default resizer completely */
  }
  
  /* Custom resize handle */
  .custom-resize-handle {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 20px;
    height: 20px;
    cursor: nw-resize;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.6;
    transition: opacity 0.2s;
    pointer-events: none; /* Let browser handle resize */
  }
  
  .resizable-popup:hover .custom-resize-handle {
    opacity: 1;
  }

  /* Search hit highlight */
  mark.search-hit {
    background: #fff3bf;
    border-radius: 3px;
    padding: 0 2px;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04);
  }
`,Ot={devis:["devis","estimation","soumission","quote","estimate","quotation"],estimation:["estimation","devis","quote","estimate"],soumission:["soumission","devis","quote"],facture:["facture","facturation","invoice","billing"],paiement:["paiement","payment","payer","pay"],client:["client","cliente","clients","customer","customers","user","utilisateur","usager"],projet:["projet","projets","project","projects","gestion","management"],gestion:["gestion","management","project management"],technique:["technique","techniques","technical","tech","support"],probleme:["problème","probleme","incident","bug","issue","problem","outage","panne"],urgent:["urgent","urgence","priority","prioritaire","rush"],delai:["délai","delai","delais","délai(s)","deadline","due date","turnaround"],tarif:["tarif","tarifs","prix","price","pricing","rate","rates"],rabais:["rabais","remise","escompte","discount"],traduction:["traduction","translation","translate"],terminologie:["terminologie","terminology","termes","glossary"],revision:["révision","revision","review","proofreading"],service:["service","services","offre","offer"]},xt=(r="")=>r.normalize("NFD").replace(new RegExp("\\p{Diacritic}+","gu"),"").toLowerCase();function pn(r){if(!r)return"";const i=xt(r).split(/\s+/).filter(Boolean),s=new Set;for(const d of i)if(s.add(d),Ot[d]&&Ot[d].forEach(f=>s.add(xt(f))),!Object.keys(Ot).find(f=>f===d))for(const f of Object.keys(Ot))(f.startsWith(d)||d.startsWith(f))&&Ot[f].forEach(w=>s.add(xt(w)));return Array.from(s).join(" ")}const or={fr:{title:"echo",subtitle:"Studio de modèles intelligents",selectTemplate:"Sélectionnez un modèle",templatesCount:"modèles disponibles",searchPlaceholder:"Rechercher un modèle...",allCategories:"Toutes les catégories",categories:{clarifications_and_client_instructions:"Précisions et instructions client",deadlines_and_delivery:"Délais et livraisons",documents_and_formatting:"Documents et formats",follow_ups_and_cancellations:"Suivi et annulations",quotes_and_approvals:"Devis et approbations",security_and_copyright:"Sécurité et droits d'auteur"},templateLanguage:"Langue du modèle",interfaceLanguage:"Langue de l'interface",variables:"Variables",editEmail:"Éditez votre modèle",subject:"Objet",body:"Corps du message",reset:"Réinitialiser",copy:"Copier",copySubject:"Copier Objet",copyBody:"Copier Corps",copyAll:"Copier Tout",copied:"Copié !",copyLink:"Copier le lien",copyLinkTitle:"Copier le lien direct vers ce modèle",openInOutlookClassic:"Ouvrir dans Outlook classique",openInOutlookClassicTitle:"Composer avec Outlook classique",openInOutlookWeb:"Ouvrir dans Outlook Web",openInOutlookWebTitle:"Composer avec Outlook Web",sendEmail:"Envoyer",favorites:"Favoris",showFavoritesOnly:"Afficher uniquement les favoris",noTemplate:"Sélectionnez un modèle pour commencer",resetWarningTitle:"Confirmer la réinitialisation",resetWarningMessage:"Êtes-vous sûr de vouloir réinitialiser toutes les variables ? Cette action ne peut pas être annulée.",cancel:"Annuler",confirm:"Confirmer"},en:{title:"echo",subtitle:"Smart Template Studio",selectTemplate:"Select a template",templatesCount:"templates available",searchPlaceholder:"Search for a template...",allCategories:"All categories",categories:{clarifications_and_client_instructions:"Clarifications and client instructions",deadlines_and_delivery:"Deadlines and delivery",documents_and_formatting:"Documents and formatting",follow_ups_and_cancellations:"Follow-ups and cancellations",quotes_and_approvals:"Quotes and approvals",security_and_copyright:"Security and copyright"},templateLanguage:"Template language",interfaceLanguage:"Interface language",variables:"Variables",editEmail:"Edit your template",subject:"Subject",body:"Message body",reset:"Reset",copy:"Copy",copySubject:"Copy Subject",copyBody:"Copy Body",copyAll:"Copy All",copied:"Copied!",copyLink:"Copy link",copyLinkTitle:"Copy direct link to this template",openInOutlookClassic:"Open in Outlook Classic",openInOutlookClassicTitle:"Compose in Outlook Classic",openInOutlookWeb:"Open in Outlook Web",openInOutlookWebTitle:"Compose in Outlook Web",sendEmail:"Send",favorites:"Favorites",showFavoritesOnly:"Show only favorites",noTemplate:"Select a template to get started",resetWarningTitle:"Confirm Reset",resetWarningMessage:"Are you sure you want to reset all variables? This action cannot be undone.",cancel:"Cancel",confirm:"Confirm"}},po="/bt-ctd-echo/assets/echo-logo-D8j-StDs.svg";function Be(...r){return ms(r)}const fo=Sn("inline-flex items-center justify-center whitespace-nowrap rounded-[12px] text-sm font-semibold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#1f8a99] focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-3.5",sm:"h-8 px-3",lg:"h-10 px-6",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Ce=a.forwardRef(({className:r,variant:i,size:s,asChild:d=!1,...n},f)=>{const w=d?ps:"button";return e.jsx(w,{className:Be(fo({variant:i,size:s,className:r})),ref:f,...n})});Ce.displayName="Button";const Ge=a.forwardRef(({className:r,type:i,...s},d)=>e.jsx("input",{type:i,className:Be("flex h-9 w-full rounded-[12px] border border-input bg-background px-3.5 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",r),ref:d,...s}));Ge.displayName="Input";const Lr=(r="")=>String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),ho=new Set(["DIV","P","SECTION","ARTICLE","HEADER","FOOTER","ASIDE","NAV","UL","OL","LI","PRE","BLOCKQUOTE","TABLE","TBODY","THEAD","TFOOT","TR","H1","H2","H3","H4","H5","H6","HR"]),ar=(r="")=>Lr(r).replace(/\r\n|\r/g,`
`).replace(/\n/g,'<br data-line-break="true">'),fn=r=>{var d;if(!r)return;const i=(d=document.getSelection)==null?void 0:d.call(document);if(!i)return;const s=document.createRange();s.selectNodeContents(r),i.removeAllRanges(),i.addRange(s)},go=zr.forwardRef(({value:r,onChange:i,variables:s,placeholder:d,onVariablesChange:n,focusedVarName:f,onFocusedVarChange:w,variant:U="default",templateLanguage:v="fr"},O)=>{const u=a.useRef(null),[I,c]=a.useState(!1),W=a.useRef({varName:null,timestamp:0}),R=a.useRef(0),se=a.useRef(null),re=a.useCallback((p="")=>qt(s,p,v),[s,v]),ce=a.useCallback(()=>{var z,Z,pe,we;if(!u.current)return!1;const p=(z=document.getSelection)==null?void 0:z.call(document);if(!(p!=null&&p.anchorNode))return!1;const y=p.anchorNode,N=y.nodeType===Node.ELEMENT_NODE?(Z=y.closest)==null?void 0:Z.call(y,".var-pill"):(we=(pe=y.parentElement)==null?void 0:pe.closest)==null?void 0:we.call(pe,".var-pill");if(!N)return!1;const C=N.getAttribute("data-var");if(!C)return!1;const L=`<<${C}>>`;return(N.textContent||"").trim()===L?(N.textContent="",N.setAttribute("data-display",""),N.classList.add("empty"),N.classList.remove("filled"),!0):!1},[]),D=p=>{if(!p)return"";const y=/<<([^>]+)>>/g,N=[];let C=0,L;for(;(L=y.exec(p))!==null;){const H=L[1],z=re(H);if(z==="__DELETED__"){C=y.lastIndex;continue}const Z=z.trim().length>0,pe=Z?z:`<<${H}>>`,we=`<<${H}>>`,de=Z?z:"";L.index>C&&N.push(ar(p.substring(C,L.index)));const qe=`var-pill ${Z?"filled":"empty"}`;N.push(`<span class="${qe}" data-var="${H}" data-value="${Lr(we)}" data-display="${Lr(de)}" contenteditable="true" spellcheck="false">${ar(pe)}</span>`),C=y.lastIndex}return C<p.length&&N.push(ar(p.substring(C))),N.join("")},P=a.useCallback(p=>{const y=u.current;y&&y.querySelectorAll(".var-pill").forEach(N=>{const C=N.getAttribute("data-var"),L=Ir(C,p);N.classList.toggle("focused",!!L)})},[]),oe=a.useCallback((p,y)=>{var z;if(!p||!y||!p.classList.contains("empty")||Date.now()<(R.current||0))return;const C=(z=document.getSelection)==null?void 0:z.call(document);if(!C||!C.isCollapsed&&C.toString())return;const L=W.current,H=Date.now();L.varName===y&&H-L.timestamp<200||(L.varName=y,L.timestamp=H,requestAnimationFrame(()=>fn(p)))},[]),be=a.useCallback((p,y)=>{var we,de,qe,xe;if(!u.current||!p)return;const N=(we=document.getSelection)==null?void 0:we.call(document);let C=null;if(N!=null&&N.anchorNode){const ye=N.anchorNode;C=ye.nodeType===Node.ELEMENT_NODE?(de=ye.closest)==null?void 0:de.call(ye,".var-pill"):(xe=(qe=ye.parentElement)==null?void 0:qe.closest)==null?void 0:xe.call(qe,".var-pill")}const L=y??"",H=L.trim(),z=H.length>0?L:`<<${p}>>`,Z=ar(z),pe=H.length>0;u.current.querySelectorAll(".var-pill").forEach(ye=>{ye.getAttribute("data-var")===p&&(C&&ye===C||(ye.innerHTML!==Z&&(ye.innerHTML=Z),ye.classList.toggle("filled",pe),ye.classList.toggle("empty",!pe),ye.setAttribute("data-display",pe?L:"")))})},[]);a.useImperativeHandle(O,()=>({focus:()=>{var p;return(p=u.current)==null?void 0:p.focus()},getHtml:()=>{var p;return((p=u.current)==null?void 0:p.innerHTML)??""},getPlainText:()=>J(),getEditorElement:()=>u.current}));const J=()=>{if(!u.current)return"";let p="";const y=(H="")=>{H&&(p+=H)},N=()=>{p.endsWith(`
`)||(p+=`
`)},C=H=>{H.childNodes.forEach(z=>{if(z.nodeType===Node.TEXT_NODE){const Z=z.parentElement;if(Z&&Z.closest(".var-pill"))return;y(z.textContent??"")}else if(z.nodeType===Node.ELEMENT_NODE){const Z=z;if(Z.classList.contains("var-pill")){const pe=Z.getAttribute("data-var"),we=Z.getAttribute("data-value")||(pe?`<<${pe}>>`:"");y(we)}else if(Z.tagName==="BR")y(`
`);else{const pe=ho.has(Z.tagName);pe&&p&&!p.endsWith(`
`)&&y(`
`),C(Z),pe&&N()}}})};C(u.current);const L=p.replace(/\u00a0/g," ");return L.endsWith(`
`)&&!L.endsWith(`

`)?L.slice(0,-1):L},he=()=>{var Z,pe,we,de,qe;const p=J(),y=(Z=u.current)==null?void 0:Z.querySelectorAll(".var-pill"),N={},C=new Set;let L=!1;const H=(pe=document.getSelection)==null?void 0:pe.call(document);let z=null;if(H!=null&&H.anchorNode){const xe=H.anchorNode;z=xe.nodeType===Node.ELEMENT_NODE?(we=xe.closest)==null?void 0:we.call(xe,".var-pill"):(qe=(de=xe.parentElement)==null?void 0:de.closest)==null?void 0:qe.call(de,".var-pill")}if(z&&y){const xe=z.getAttribute("data-var");if(xe){const ye=z.textContent??"",We=ye.replace(/\u00a0/g," ").replace(/[\r\n]+/g," "),V=`<<${xe}>>`,x=We.split(V).join("").trim();let F=x;x?(z.classList.add("filled"),z.classList.remove("empty")):(F="",ye!==V&&(z.textContent=V),z.classList.remove("filled"),z.classList.add("empty")),z.setAttribute("data-display",F),((s==null?void 0:s[xe])||"")!==F&&(L=!0),N[xe]=F,C.add(xe)}}y&&y.forEach(xe=>{const ye=xe.getAttribute("data-var");if(!ye||C.has(ye))return;const We=xe.textContent??"",V=We.replace(/\u00a0/g," ").replace(/[\r\n]+/g," "),m=`<<${ye}>>`,F=V.split(m).join("").trim();let K=F;F?(xe.classList.add("filled"),xe.classList.remove("empty")):(K="",We!==m&&(xe.textContent=m),xe.classList.remove("filled"),xe.classList.add("empty")),xe.setAttribute("data-display",K),((s==null?void 0:s[ye])||"")!==K&&(L=!0),N[ye]=K,C.add(ye)}),Object.entries(N).forEach(([xe,ye])=>{be(xe,ye)}),L&&typeof n=="function"&&n(N),i==null||i({target:{value:p}})},_=()=>{c(!0),requestAnimationFrame(()=>{var L,H,z,Z;const p=(L=document.getSelection)==null?void 0:L.call(document),y=(p==null?void 0:p.anchorNode)||null;if(!u.current||!y||!u.current.contains(y))return;const N=y.nodeType===Node.ELEMENT_NODE?(H=y.closest)==null?void 0:H.call(y,".var-pill"):(Z=(z=y.parentElement)==null?void 0:z.closest)==null?void 0:Z.call(z,".var-pill"),C=(N==null?void 0:N.getAttribute("data-var"))||null;C&&(ce(),P(C),Date.now()>=(R.current||0)&&oe(N,C))})},$=()=>{c(!1),he(),(typeof document>"u"||!document.hasFocus||document.hasFocus())&&P(null),W.current={varName:null,timestamp:0}},ue=p=>{var C;if(!u.current)return;const y=p.target;if(!(y instanceof Element))return;const N=(C=y.closest)==null?void 0:C.call(y,".var-pill");if(N&&u.current.contains(N)){const L=p.detail;L===1?(se.current&&clearTimeout(se.current),se.current=setTimeout(()=>{fn(N),se.current=null},220)):L>=2&&(se.current&&(clearTimeout(se.current),se.current=null),R.current=Date.now()+600)}},ne=p=>{var C,L;if(!u.current)return;const y=p.target;if(!(y instanceof Element))return;const N=(C=y.closest)==null?void 0:C.call(y,".var-pill");if(!(!N||!u.current.contains(N))){p.preventDefault();try{const H=(L=document.getSelection)==null?void 0:L.call(document);if(!H)return;let z=null;if(document.caretRangeFromPoint)z=document.caretRangeFromPoint(p.clientX,p.clientY);else if(document.caretPositionFromPoint){const Z=document.caretPositionFromPoint(p.clientX,p.clientY);Z&&(z=document.createRange(),z.setStart(Z.offsetNode,Z.offset),z.collapse(!0))}(!z||!N.contains(z.startContainer))&&(z=document.createRange(),z.selectNodeContents(N),z.collapse(!1)),H.removeAllRanges(),H.addRange(z),R.current=Date.now()+600}catch{}}};a.useEffect(()=>{if(!u.current||I)return;const p=D(r);u.current.innerHTML!==p&&(u.current.innerHTML=p)},[r,s,I,re,v]),a.useEffect(()=>{P(f)},[f,s,P]),a.useEffect(()=>{var C,L,H,z;if(!u.current)return;const p=(C=document.getSelection)==null?void 0:C.call(document);let y=null;if(p!=null&&p.anchorNode){const Z=p.anchorNode;y=Z.nodeType===Node.ELEMENT_NODE?(L=Z.closest)==null?void 0:L.call(Z,".var-pill"):(z=(H=Z.parentElement)==null?void 0:H.closest)==null?void 0:z.call(H,".var-pill")}u.current.querySelectorAll(".var-pill").forEach(Z=>{if(y&&Z===y)return;const pe=Z.getAttribute("data-var");if(!pe)return;const we=re(pe);if(we==="__DELETED__"){const We=document.createTextNode("");Z.replaceWith(We);return}const de=we.trim().length>0,qe=de?we:`<<${pe}>>`,xe=(Z.textContent||"").trim(),ye=qe.trim();xe!==ye&&(Z.textContent=qe,Z.classList.toggle("filled",de),Z.classList.toggle("empty",!de),Z.setAttribute("data-display",de?we:""))})},[s,re]),a.useEffect(()=>{if(!I||!u.current)return;const p=()=>{var Z,pe,we,de;const y=u.current;if(!y||!(typeof document>"u"||!document.hasFocus||document.hasFocus()))return;const C=(Z=document.getSelection)==null?void 0:Z.call(document);if(!C){W.current={varName:null,timestamp:0};return}const L=C.anchorNode;if(!L||!y.contains(L)){W.current={varName:null,timestamp:0};return}const H=L.nodeType===Node.ELEMENT_NODE?(pe=L.closest)==null?void 0:pe.call(L,".var-pill"):(de=(we=L.parentElement)==null?void 0:we.closest)==null?void 0:de.call(we,".var-pill"),z=(H==null?void 0:H.getAttribute("data-var"))||null;z&&C.isCollapsed&&Date.now()>=(R.current||0)&&oe(H,z),z||(W.current={varName:null,timestamp:0})};return document.addEventListener("selectionchange",p),()=>document.removeEventListener("selectionchange",p)},[I,oe]);const T=p=>{var L,H,z,Z;if(p.key!=="Enter")return;const y=(L=document.getSelection)==null?void 0:L.call(document);if(!y)return;const N=y.anchorNode;if(!N)return;(N.nodeType===Node.ELEMENT_NODE?(H=N.closest)==null?void 0:H.call(N,".var-pill"):(Z=(z=N.parentElement)==null?void 0:z.closest)==null?void 0:Z.call(z,".var-pill"))&&p.preventDefault()},Y=a.useCallback(p=>{const y=(p==null?void 0:p.inputType)||"";(!y||y.startsWith("insert")||y==="deleteContentBackward")&&ce()},[ce]),X=a.useCallback(()=>{ce()},[ce]);return e.jsx("div",{ref:u,contentEditable:!0,role:"textbox","aria-multiline":"true","aria-autocomplete":"none",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",inputMode:"text","data-gramm":"false","data-lpignore":"true","data-1p-ignore":"true","data-1password-blocklist":"true",className:`lexical-content-editable${U==="compact"?" lexical-content-editable--compact":""}`,onInput:he,onFocus:_,onBlur:$,onBeforeInput:Y,onCompositionStart:X,onMouseDown:ue,onDoubleClick:ne,onKeyDown:T,suppressContentEditableWarning:!0,"data-placeholder":d,dangerouslySetInnerHTML:{__html:D(r)}})}),bo=({value:r,onChange:i,fonts:s,disabled:d=!1})=>{const[n,f]=a.useState(!1),w=a.useRef(null);a.useEffect(()=>{const O=u=>{w.current&&!w.current.contains(u.target)&&f(!1)};if(n)return document.addEventListener("mousedown",O),()=>document.removeEventListener("mousedown",O)},[n]);const U=O=>{i(O),f(!1)},v=s.find(O=>O.value===r)||s[0];return e.jsxs("div",{ref:w,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>!d&&f(!n),disabled:d,className:`
          w-full min-w-[160px] px-3 py-1.5 text-sm
          border border-slate-300 rounded bg-white
          flex items-center justify-between gap-2
          ${d?"opacity-50 cursor-not-allowed":"cursor-pointer hover:border-slate-400"}
          focus:outline-none focus:ring-2 focus:ring-slate-400
        `,style:{fontFamily:v.value},children:[e.jsx("span",{className:"truncate",children:v.name}),e.jsx(pr,{className:`h-4 w-4 flex-shrink-0 transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-full min-w-[200px] bg-white border border-slate-300 rounded shadow-lg z-50 max-h-[300px] overflow-y-auto",children:s.map(O=>e.jsx("button",{type:"button",onClick:()=>U(O.value),className:`
                w-full px-3 py-2.5 text-left text-base
                hover:bg-slate-100 transition-colors
                ${O.value===r?"bg-slate-50":""}
              `,style:{fontFamily:O.value},children:O.name},O.value))})]})},xo=({value:r,onChange:i,sizes:s,disabled:d=!1})=>{const[n,f]=a.useState(!1),w=a.useRef(null);a.useEffect(()=>{const O=u=>{w.current&&!w.current.contains(u.target)&&f(!1)};if(n)return document.addEventListener("mousedown",O),()=>document.removeEventListener("mousedown",O)},[n]);const U=O=>{i(O),f(!1)},v=s.find(O=>O.value===r)||s[1];return e.jsxs("div",{ref:w,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>!d&&f(!n),disabled:d,className:`
          w-full min-w-[120px] px-3 py-1.5 text-sm
          border border-slate-300 rounded bg-white
          flex items-center justify-between gap-2
          ${d?"opacity-50 cursor-not-allowed":"cursor-pointer hover:border-slate-400"}
          focus:outline-none focus:ring-2 focus:ring-slate-400
        `,children:[e.jsx("span",{className:"truncate",children:v.label}),e.jsx(pr,{className:`h-4 w-4 flex-shrink-0 transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-full min-w-[140px] bg-white border border-slate-300 rounded shadow-lg z-50",children:s.map(O=>e.jsx("button",{type:"button",onClick:()=>U(O.value),className:`
                w-full px-3 py-2 text-left
                hover:bg-slate-100 transition-colors
                ${O.value===r?"bg-slate-50":""}
              `,style:{fontSize:O.value},children:O.label},O.value))})]})},hn=[{label:"Small",value:"14px"},{label:"Normal",value:"16px"},{label:"Large",value:"18px"},{label:"X-Large",value:"20px"}],It="16px",gn={"14px":"2","16px":"3","18px":"4","20px":"5"},vo={1:"12px",2:"14px",3:"16px",4:"18px",5:"20px",6:"24px",7:"28px"},yo=[{name:"Yellow",value:"#ffeb3b"},{name:"Green",value:"#c6f68d"},{name:"Blue",value:"#90caf9"},{name:"Pink",value:"#f48fb1"},{name:"Orange",value:"#ffcc80"},{name:"None",value:"transparent"}],wo=[{name:"Black",value:"#000000"},{name:"Dark Gray",value:"#424242"},{name:"Gray",value:"#757575"},{name:"Red",value:"#f44336"},{name:"Blue",value:"#2196f3"},{name:"Green",value:"#4caf50"},{name:"Orange",value:"#ff9800"},{name:"Purple",value:"#9c27b0"}],jo=[{name:"Arial",value:"Arial, sans-serif"},{name:"Times New Roman",value:"Times New Roman, serif"},{name:"Courier New",value:"Courier New, monospace"},{name:"Georgia",value:"Georgia, serif"},{name:"Verdana",value:"Verdana, sans-serif"},{name:"Helvetica",value:"Helvetica, sans-serif"},{name:"Comic Sans",value:"Comic Sans MS, cursive"},{name:"Impact",value:"Impact, fantasy"}],No=({onCommand:r,className:i="",disabled:s=!1})=>{const[d,n]=a.useState({bold:!1,italic:!1,underline:!1,strikethrough:!1}),[f,w]=a.useState(It),[U,v]=a.useState("Arial, sans-serif"),[O,u]=a.useState(!1),[I,c]=a.useState(!1),W=a.useRef(null),R=a.useCallback(P=>{if(!P)return It;const oe=parseFloat(P);if(!Number.isFinite(oe))return It;let be=It,J=Number.POSITIVE_INFINITY;return hn.forEach(({value:he})=>{const _=parseFloat(he),$=Math.abs(_-oe);$<J&&(J=$,be=he)}),be},[]),se=a.useCallback(()=>{if(!s)try{const P=window.getSelection();if(!P.rangeCount)return;n({bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikeThrough")});const oe=P.getRangeAt(0);let be=null;if(oe.startContainer.nodeType===Node.TEXT_NODE?be=oe.startContainer.parentElement:oe.startContainer.nodeType===Node.ELEMENT_NODE&&(be=oe.startContainer),be){const J=window.getComputedStyle(be);w(R(J.fontSize))}}catch(P){console.warn("Error updating format state:",P)}},[s,R]);a.useEffect(()=>{const P=()=>{setTimeout(se,10)};return document.addEventListener("selectionchange",P),()=>document.removeEventListener("selectionchange",P)},[se]),a.useEffect(()=>{const P=oe=>{W.current&&!W.current.contains(oe.target)&&(u(!1),c(!1))};if(O||I)return document.addEventListener("mousedown",P),()=>document.removeEventListener("mousedown",P)},[O,I]);const re=a.useCallback((P,oe=null)=>{if(!s)try{const be=window.getSelection();let J=null;be&&be.rangeCount>0&&(J=be.getRangeAt(0).cloneRange());const he=P==="insertUnorderedList"||P==="insertOrderedList"||P==="justifyLeft"||P==="justifyCenter"||P==="justifyRight"||P==="justifyFull";if(he&&J){const T=J.startContainer;let Y=T.nodeType===Node.ELEMENT_NODE?T:T.parentElement,X=null;if(Y&&Y.closest&&(X=Y.closest(".var-pill")),X){const p=document.createRange();p.setStartAfter(X),p.collapse(!0),J=p}}const _=!he&&J&&!J.collapsed,$=[];if(_){const T=J.commonAncestorContainer,Y=T.nodeType===Node.ELEMENT_NODE?T:T.parentElement;Y&&Y.querySelectorAll&&Y.querySelectorAll(".var-pill").forEach(p=>{try{J.intersectsNode(p)&&$.push(p)}catch{const N=document.createRange();N.selectNode(p),J.compareBoundaryPoints(Range.START_TO_END,N)>0&&J.compareBoundaryPoints(Range.END_TO_START,N)<0&&$.push(p)}})}if(J){const T=window.getSelection();T&&(T.removeAllRanges(),T.addRange(J))}const ue=P==="foreColor"||P==="backColor"||P==="hiliteColor";if(ue)try{document.execCommand("styleWithCSS",!1,!0)}catch{}if(document.execCommand(P,!1,oe),$.length>0&&($.forEach(T=>{const Y=document.createRange();Y.selectNodeContents(T);const X=window.getSelection();X.removeAllRanges(),X.addRange(Y),document.execCommand(P,!1,oe)}),J)){const T=window.getSelection();T&&(T.removeAllRanges(),T.addRange(J))}if(ue)try{document.execCommand("styleWithCSS",!1,!1)}catch{}se(),r==null||r(P,oe);const ne=document.activeElement;if(ne&&ne.isContentEditable){const T=new Event("input",{bubbles:!0});ne.dispatchEvent(T)}}catch(be){console.warn("Error executing command:",P,be)}},[s,r,se]),ce=a.useCallback(P=>{var he,_,$;if(s)return;const oe=window.getSelection();if(!oe||oe.rangeCount===0){w(P),r==null||r("fontSize",P);return}oe.getRangeAt(0);const be=gn[P]||gn[It];try{document.execCommand("styleWithCSS",!1,!0)}catch{}document.execCommand("fontSize",!1,be);try{document.execCommand("styleWithCSS",!1,!1)}catch{}const J=(he=document.activeElement)!=null&&he.isContentEditable?document.activeElement:($=(_=document.activeElement)==null?void 0:_.closest)==null?void 0:$.call(_,'[contenteditable="true"]');if(J&&J.querySelectorAll("font[size]").forEach(ne=>{const T=document.createElement("span"),Y=ne.getAttribute("size"),X=vo[Y]||P;T.style.fontSize=X,T.innerHTML=ne.innerHTML,ne.replaceWith(T)}),w(P),r==null||r("fontSize",P),se(),document.activeElement&&document.activeElement.isContentEditable){const ue=new Event("input",{bubbles:!0});document.activeElement.dispatchEvent(ue)}},[s,r,se]),D=a.useCallback(P=>{if(s)return;const oe=window.getSelection();if(!oe||oe.rangeCount===0){v(P),r==null||r("fontName",P);return}try{document.execCommand("styleWithCSS",!1,!0)}catch{}document.execCommand("fontName",!1,P);try{document.execCommand("styleWithCSS",!1,!1)}catch{}if(v(P),r==null||r("fontName",P),se(),document.activeElement&&document.activeElement.isContentEditable){const be=new Event("input",{bubbles:!0});document.activeElement.dispatchEvent(be)}},[s,r,se]);return s?null:e.jsxs("div",{ref:W,className:`flex flex-wrap items-center gap-1.5 p-2.5 bg-slate-50 border border-slate-200 rounded-lg ${i}`,children:[e.jsxs("div",{className:"flex items-center gap-1 pr-2 border-r border-slate-300",children:[e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:`h-9 w-9 p-0 ${d.bold?"bg-slate-200 text-slate-900":"text-slate-600 hover:text-slate-900 hover:bg-slate-100"}`,onMouseDown:P=>P.preventDefault(),onClick:()=>re("bold"),title:"Bold (Ctrl+B)",children:e.jsx(fs,{className:"h-5 w-5"})}),e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:`h-9 w-9 p-0 ${d.italic?"bg-slate-200 text-slate-900":"text-slate-600 hover:text-slate-900 hover:bg-slate-100"}`,onMouseDown:P=>P.preventDefault(),onClick:()=>re("italic"),title:"Italic (Ctrl+I)",children:e.jsx(hs,{className:"h-5 w-5"})}),e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:`h-9 w-9 p-0 ${d.underline?"bg-slate-200 text-slate-900":"text-slate-600 hover:text-slate-900 hover:bg-slate-100"}`,onMouseDown:P=>P.preventDefault(),onClick:()=>re("underline"),title:"Underline (Ctrl+U)",children:e.jsx(gs,{className:"h-5 w-5"})}),e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:`h-9 w-9 p-0 ${d.strikethrough?"bg-slate-200 text-slate-900":"text-slate-600 hover:text-slate-900 hover:bg-slate-100"}`,onMouseDown:P=>P.preventDefault(),onClick:()=>re("strikeThrough"),title:"Strikethrough",children:e.jsx(bs,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-1 pr-2 border-r border-slate-300",children:[e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:"h-9 w-9 p-0 text-slate-600 hover:text-slate-900 hover:bg-slate-100",onMouseDown:P=>P.preventDefault(),onClick:()=>re("insertUnorderedList"),title:"Bullet List",children:e.jsx(xs,{className:"h-5 w-5"})}),e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:"h-9 w-9 p-0 text-slate-600 hover:text-slate-900 hover:bg-slate-100",onMouseDown:P=>P.preventDefault(),onClick:()=>re("insertOrderedList"),title:"Numbered List",children:e.jsx(vs,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-1 pr-2 border-r border-slate-300 relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:"h-9 w-9 p-0 text-slate-600 hover:text-slate-900 hover:bg-slate-100",onMouseDown:P=>P.preventDefault(),onClick:()=>{u(!O),c(!1)},title:"Highlight Color",children:e.jsx(ys,{className:"h-5 w-5"})}),O&&e.jsx("div",{className:"absolute top-full left-0 mt-1 p-2 bg-white border border-slate-300 rounded-lg shadow-lg z-50 flex gap-1",children:yo.map(P=>e.jsx("button",{type:"button",className:"w-7 h-7 rounded border-2 border-slate-300 hover:border-slate-500 transition-colors",style:{backgroundColor:P.value},onMouseDown:oe=>oe.preventDefault(),onClick:()=>{re("backColor",P.value),u(!1)},title:P.name},P.value))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:"h-9 w-9 p-0 text-slate-600 hover:text-slate-900 hover:bg-slate-100",onMouseDown:P=>P.preventDefault(),onClick:()=>{c(!I),u(!1)},title:"Text Color",children:e.jsx(ws,{className:"h-5 w-5"})}),I&&e.jsx("div",{className:"absolute top-full left-0 mt-1 p-2 bg-white border border-slate-300 rounded-lg shadow-lg z-50 flex gap-1",children:wo.map(P=>e.jsx("button",{type:"button",className:"w-7 h-7 rounded border-2 border-slate-300 hover:border-slate-500 transition-colors",style:{backgroundColor:P.value},onMouseDown:oe=>oe.preventDefault(),onClick:()=>{re("foreColor",P.value),c(!1)},title:P.name},P.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-1 pr-2 border-r border-slate-300",children:[e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:"h-9 w-9 p-0 text-slate-600 hover:text-slate-900 hover:bg-slate-100",onMouseDown:P=>P.preventDefault(),onClick:()=>re("justifyLeft"),title:"Align Left",children:e.jsx(js,{className:"h-5 w-5"})}),e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:"h-9 w-9 p-0 text-slate-600 hover:text-slate-900 hover:bg-slate-100",onMouseDown:P=>P.preventDefault(),onClick:()=>re("justifyCenter"),title:"Align Center",children:e.jsx(Ns,{className:"h-5 w-5"})}),e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:"h-9 w-9 p-0 text-slate-600 hover:text-slate-900 hover:bg-slate-100",onMouseDown:P=>P.preventDefault(),onClick:()=>re("justifyRight"),title:"Align Right",children:e.jsx(Cs,{className:"h-5 w-5"})}),e.jsx(Ce,{type:"button",variant:"ghost",size:"sm",className:"h-9 w-9 p-0 text-slate-600 hover:text-slate-900 hover:bg-slate-100",onMouseDown:P=>P.preventDefault(),onClick:()=>re("justifyFull"),title:"Justify",children:e.jsx(Es,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-5 w-5 text-slate-600"}),e.jsx(xo,{value:f,onChange:ce,sizes:hn,disabled:s})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(bo,{value:U,onChange:D,fonts:jo,disabled:s})})]})},qr=(r="")=>String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),Co=new Set(["DIV","P","SECTION","ARTICLE","HEADER","FOOTER","ASIDE","NAV","UL","OL","LI","PRE","BLOCKQUOTE","TABLE","TBODY","THEAD","TFOOT","TR","H1","H2","H3","H4","H5","H6","HR"]),_t=(r="")=>qr(r).replace(/\r\n|\r/g,`
`).replace(/\n/g,'<br data-line-break="true">'),Ar="__RT_PILL_VALUE__",Eo=(r="")=>String(r||"").replace(/\s+/g,"").toLowerCase(),_o=new Set(["rgb(245,243,232)","rgba(245,243,232,1)","rgb(254,249,195)","rgba(254,249,195,1)","rgb(219,234,254)","rgba(219,234,254,1)"]),So=(r="")=>_o.has(Eo(r)),Po=r=>{if(!r)return null;const i=r.cloneNode(!0),s=(f,w)=>{var c;if(w.nodeType!==Node.ELEMENT_NODE)return;const U=window.getComputedStyle(f);let v="";["fontSize","fontFamily","fontWeight","fontStyle","color","textDecoration","textAlign","lineHeight","letterSpacing"].forEach(W=>{const R=U[W];if(R&&R!=="normal"&&R!=="none"){const se=W.replace(/([A-Z])/g,"-$1").toLowerCase();v+=`${se}: ${R}; `}});const u=U.backgroundColor,I=u==null?void 0:u.replace(/\s/g,"");u&&I!=="rgba(0,0,0,0)"&&I!=="transparent"&&I!=="rgb(255,255,255)"&&I!=="rgba(255,255,255,1)"&&!So(u)&&(v+=`background-color: ${u}; `),v&&w.setAttribute("style",v.trim());for(let W=0;W<f.childNodes.length;W++)f.childNodes[W].nodeType===Node.ELEMENT_NODE&&((c=w.childNodes[W])==null?void 0:c.nodeType)===Node.ELEMENT_NODE&&s(f.childNodes[W],w.childNodes[W])};s(r,i);let d=!1;const n=f=>{f.childNodes.forEach(w=>{w.nodeType===Node.TEXT_NODE?d?w.textContent="":(w.textContent=Ar,d=!0):w.nodeType===Node.ELEMENT_NODE&&n(w)})};return n(i),d?i.innerHTML:null},Lt=r=>{if(!r)return;const i=Po(r);i?r.dataset.template=i:delete r.dataset.template},bn=(r,i)=>{var n;if(!r)return;const s=(n=r.dataset)==null?void 0:n.template;if(s&&s.includes(Ar)){const f=s.replace(Ar,i);r.innerHTML=f,Lt(r);return}if(r.childNodes.length===1&&r.childNodes[0].nodeType===Node.ELEMENT_NODE){r.childNodes[0].innerHTML=i,Lt(r);return}r.innerHTML=i,Lt(r)},ko=r=>{if(!r)return;r.querySelectorAll(".var-pill").forEach(Lt)},xn=r=>{var d;if(!r)return;const i=(d=document.getSelection)==null?void 0:d.call(document);if(!i)return;const s=document.createRange();s.selectNodeContents(r),i.removeAllRanges(),i.addRange(s)},Ro=(r={},i={})=>{const s=Object.keys(r),d=Object.keys(i);if(s.length!==d.length)return!0;for(const n of d)if((r[n]??"")!==(i[n]??""))return!0;return!1},To=zr.forwardRef(({value:r="",onChange:i,onFocus:s,onBlur:d,onVariablesChange:n,variables:f={},placeholder:w="",className:U="",style:v={},focusedVarName:O=null,onFocusedVarChange:u,variant:I="default",disabled:c=!1,minHeight:W="120px",showRichTextToolbar:R=!0,onRichTextCommand:se,templateLanguage:re="fr"},ce)=>{const D=a.useRef(null),[P,oe]=a.useState(!1),be=a.useRef(null),J=a.useRef(r),he=a.useRef(f),_=a.useRef(!1),$=a.useRef({varName:null,timestamp:0}),ue=a.useRef(0),ne=a.useRef(null),T=a.useCallback((V="")=>qt(f,V,re),[f,re]),Y=a.useCallback(()=>{var te,G,je,Oe;if(!D.current)return!1;const V=(te=document.getSelection)==null?void 0:te.call(document);if(!(V!=null&&V.anchorNode))return!1;const m=V.anchorNode,x=m.nodeType===Node.ELEMENT_NODE?(G=m.closest)==null?void 0:G.call(m,".var-pill"):(Oe=(je=m.parentElement)==null?void 0:je.closest)==null?void 0:Oe.call(je,".var-pill");if(!x)return!1;const F=x.getAttribute("data-var");if(!F)return!1;const K=`<<${F}>>`;return(x.textContent||"").trim()===K?(x.innerHTML="",x.setAttribute("data-display",""),x.classList.add("empty"),x.classList.remove("filled"),!0):!1},[]),X=V=>{if(!V)return"";let m=V.replace(/&lt;&lt;([^&]+?)&gt;&gt;/g,"<<$1>>").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'");const x=/<(p|div|br|strong|b|i|u|span|ul|ol|li|h[1-6])[>\s]/i.test(m),F=/<<([^>]+)>>/g,K=[];let ae=0,te;for(;(te=F.exec(m))!==null;){const G=te[1],je=T(G);if(je==="__DELETED__"){ae=F.lastIndex;continue}const Oe=je.trim().length>0,Te=Oe?je:`<<${G}>>`,Ve=`<<${G}>>`,$e=Oe?je:"";if(te.index>ae){const Fe=m.substring(ae,te.index);K.push(x?Fe:_t(Fe))}const Ae=`var-pill ${Oe?"filled":"empty"}`;K.push(`<span class="${Ae}" data-var="${G}" data-value="${qr(Ve)}" data-display="${qr($e)}" contenteditable="true" spellcheck="false">${_t(Te)}</span>`),ae=F.lastIndex}if(ae<m.length){const G=m.substring(ae);K.push(x?G:_t(G))}return K.join("")},p=a.useCallback(V=>{const m=D.current;m&&m.querySelectorAll(".var-pill").forEach(x=>{const F=x.getAttribute("data-var"),K=V?Ir(F,V):!1;x.classList.toggle("focused",!!K)})},[]),y=a.useCallback((V,m)=>{var te;if(!V||!m||!V.classList.contains("empty")||Date.now()<(ue.current||0))return;const F=(te=document.getSelection)==null?void 0:te.call(document);if(!F||!F.isCollapsed&&F.toString())return;const K=$.current,ae=Date.now();K.varName===m&&ae-K.timestamp<200||(K.varName=m,K.timestamp=ae,requestAnimationFrame(()=>{xn(V)}))},[]),N=a.useCallback((V,m)=>{var Oe,Te,Ve,$e;if(!D.current||!V)return;const x=(Oe=document.getSelection)==null?void 0:Oe.call(document);let F=null;if(x!=null&&x.anchorNode){const Ae=x.anchorNode;F=Ae.nodeType===Node.ELEMENT_NODE?(Te=Ae.closest)==null?void 0:Te.call(Ae,".var-pill"):($e=(Ve=Ae.parentElement)==null?void 0:Ve.closest)==null?void 0:$e.call(Ve,".var-pill")}const K=m??"",ae=K.trim(),te=ae.length>0?K:`<<${V}>>`,G=_t(te),je=ae.length>0;D.current.querySelectorAll(".var-pill").forEach(Ae=>{Ae.getAttribute("data-var")===V&&(F&&Ae===F||(Ae.innerHTML!==G&&(Ae.innerHTML=G),Ae.classList.toggle("filled",je),Ae.classList.toggle("empty",!je),Ae.setAttribute("data-display",je?K:"")))})},[]),C=a.useCallback(V=>{const m=V||null;be.current!==m&&(be.current=m,typeof u=="function"&&u(m))},[u]),L=()=>{if(!D.current)return"";let V="";const m=(ae="")=>{ae&&(V+=ae)},x=()=>{V.endsWith(`
`)||(V+=`
`)},F=ae=>{ae.childNodes.forEach(te=>{if(te.nodeType===Node.TEXT_NODE){const G=te.parentElement;if(G&&G.closest(".var-pill"))return;m(te.textContent??"")}else if(te.nodeType===Node.ELEMENT_NODE){const G=te;if(G.classList.contains("var-pill")){const je=G.getAttribute("data-var"),Oe=G.getAttribute("data-value")||(je?`<<${je}>>`:"");m(Oe)}else if(G.tagName==="BR")m(`
`);else{const je=Co.has(G.tagName);je&&V&&!V.endsWith(`
`)&&m(`
`),F(G),je&&x()}}})};F(D.current);const K=V.replace(/\u00a0/g," ");return K.endsWith(`
`)&&!K.endsWith(`

`)?K.slice(0,-1):K},H=()=>{var je,Oe,Te,Ve,$e,Ae;const V=L(),m=((je=D.current)==null?void 0:je.innerHTML)??"",x=(Oe=D.current)==null?void 0:Oe.querySelectorAll(".var-pill"),F={},K=new Set;let ae=!1;const te=(Te=document.getSelection)==null?void 0:Te.call(document);let G=null;if(te!=null&&te.anchorNode){const Fe=te.anchorNode;G=Fe.nodeType===Node.ELEMENT_NODE?(Ve=Fe.closest)==null?void 0:Ve.call(Fe,".var-pill"):(Ae=($e=Fe.parentElement)==null?void 0:$e.closest)==null?void 0:Ae.call($e,".var-pill")}if(G&&x){const Fe=G.getAttribute("data-var");if(Fe){const Je=G.textContent??"",Ie=Je.replace(/\u00a0/g," ").replace(/[\r\n]+/g," "),Ke=`<<${Fe}>>`,mt=Ie.split(Ke).join("").trim();let Ze=mt;mt?(G.classList.add("filled"),G.classList.remove("empty")):(Ze="",Je!==Ke&&(G.textContent=Ke),G.classList.remove("filled"),G.classList.add("empty")),G.setAttribute("data-display",Ze),((f==null?void 0:f[Fe])||"")!==Ze&&(ae=!0),F[Fe]=Ze,K.add(Fe),Lt(G)}}x&&x.forEach(Fe=>{const Je=Fe.getAttribute("data-var");if(!Je||K.has(Je))return;const Ie=Fe.textContent??"",Ke=Ie.replace(/\u00a0/g," ").replace(/[\r\n]+/g," "),dt=`<<${Je}>>`,Ze=Ke.split(dt).join("").trim();let tt=Ze;Ze?(Fe.classList.add("filled"),Fe.classList.remove("empty")):(tt="",Ie!==dt&&(Fe.textContent=dt),Fe.classList.remove("filled"),Fe.classList.add("empty")),Fe.setAttribute("data-display",tt),((f==null?void 0:f[Je])||"")!==tt&&(ae=!0),F[Je]=tt,K.add(Je),Lt(Fe)}),Object.entries(F).forEach(([Fe,Je])=>{N(Fe,Je)}),ae&&typeof n=="function"&&n(F),i&&i({target:{value:V,htmlValue:m}})};a.useImperativeHandle(ce,()=>({focus:()=>{var V;(V=D.current)==null||V.focus()},getHtml:()=>{var V;return((V=D.current)==null?void 0:V.innerHTML)??""},getPlainText:()=>L(),getEditorElement:()=>D.current}));const z=V=>{oe(!0),requestAnimationFrame(()=>{var ae,te,G,je;const m=(ae=document.getSelection)==null?void 0:ae.call(document),x=(m==null?void 0:m.anchorNode)||null;if(!D.current||!x||!D.current.contains(x))return;const F=x.nodeType===Node.ELEMENT_NODE?(te=x.closest)==null?void 0:te.call(x,".var-pill"):(je=(G=x.parentElement)==null?void 0:G.closest)==null?void 0:je.call(G,".var-pill"),K=(F==null?void 0:F.getAttribute("data-var"))||null;K&&(Y(),p(K),C(K),Date.now()>=(ue.current||0)&&y(F,K))}),s==null||s(V)},Z=V=>{var m;oe(!1),H(),(!(typeof document<"u")||((m=document.hasFocus)==null?void 0:m.call(document))!==!1)&&(C(null),p(null)),$.current={varName:null,timestamp:0},d==null||d(V)},pe=V=>{var K,ae;if(!D.current)return;V.preventDefault();const m=((K=V.clipboardData)==null?void 0:K.getData("text/plain"))??"";if(!m)return;const x=_t(m),F=(ae=document.getSelection)==null?void 0:ae.call(document);if(F&&F.rangeCount>0){const te=F.getRangeAt(0);te.deleteContents();const G=te.createContextualFragment(x);te.insertNode(G),te.collapse(!1),F.removeAllRanges(),F.addRange(te)}else D.current.insertAdjacentHTML("beforeend",x);requestAnimationFrame(()=>{H()})},we=V=>{var K,ae,te,G;if(V.key!=="Enter")return;const m=(K=document.getSelection)==null?void 0:K.call(document);if(!m)return;const x=m.anchorNode;if(!x)return;(x.nodeType===Node.ELEMENT_NODE?(ae=x.closest)==null?void 0:ae.call(x,".var-pill"):(G=(te=x.parentElement)==null?void 0:te.closest)==null?void 0:G.call(te,".var-pill"))&&V.preventDefault()},de=V=>{var F;if(!D.current)return;const m=V.target;if(!(m instanceof Element))return;const x=(F=m.closest)==null?void 0:F.call(m,".var-pill");if(x&&D.current.contains(x)){const K=V.detail,ae=x.getAttribute("data-var")||null;K===1?(ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{xn(x),ne.current=null},220)):K>=2&&(ne.current&&(clearTimeout(ne.current),ne.current=null),ue.current=Date.now()+600),C(ae),p(ae)}},qe=a.useCallback(V=>{const m=(V==null?void 0:V.inputType)||"";(!m||m.startsWith("insert")||m==="deleteContentBackward")&&Y()},[Y]),xe=a.useCallback(()=>{Y()},[Y]),ye=V=>{var F,K;if(!D.current)return;const m=V.target;if(!(m instanceof Element))return;const x=(F=m.closest)==null?void 0:F.call(m,".var-pill");if(!(!x||!D.current.contains(x))){V.preventDefault();try{const ae=(K=document.getSelection)==null?void 0:K.call(document);if(!ae)return;let te=null;if(document.caretRangeFromPoint)te=document.caretRangeFromPoint(V.clientX,V.clientY);else if(document.caretPositionFromPoint){const G=document.caretPositionFromPoint(V.clientX,V.clientY);G&&(te=document.createRange(),te.setStart(G.offsetNode,G.offset),te.collapse(!0))}(!te||!x.contains(te.startContainer))&&(te=document.createRange(),te.selectNodeContents(x),te.collapse(!1)),ae.removeAllRanges(),ae.addRange(te),ue.current=Date.now()+600}catch{}}},We=a.useCallback((V,m)=>{const x=D.current;x&&(document.activeElement!==x&&x.focus(),se==null||se(V,m),setTimeout(()=>{if(x){const F=new Event("input",{bubbles:!0});x.dispatchEvent(F)}},10))},[se]);return a.useEffect(()=>{const V=D.current,m=!_.current;if(!V){J.current=r,he.current=f;return}if(P){J.current=r,he.current=f,_.current=!0;return}const x=J.current,F=he.current,K=r!==x,ae=Ro(F||{},f||{});if(m){const te=X(r);V.innerHTML!==te&&(V.innerHTML=te)}else if(K){const te=X(r);V.innerHTML!==te&&(V.innerHTML=te)}else ae&&V.querySelectorAll(".var-pill").forEach(G=>{const je=G.getAttribute("data-var");if(!je)return;const Oe=f==null?void 0:f[je],Te=Oe==null?"":String(Oe);if(Te==="__DELETED__"){G.replaceWith(document.createTextNode(""));return}const Ve=Te.trim(),$e=`<<${je}>>`,Ae=Ve.length?Te:$e,Fe=_t(Ae);bn(G,Fe),G.setAttribute("data-display",Te),G.setAttribute("data-value",$e),Ve.length?(G.classList.add("filled"),G.classList.remove("empty")):(G.classList.add("empty"),G.classList.remove("filled"))});_.current=!0,J.current=r,he.current=f,(m||K)&&ko(V)},[r,f,P,T,re]),a.useEffect(()=>{p(O)},[O,f,p]),a.useEffect(()=>{var F,K,ae,te;if(!D.current)return;const V=(F=document.getSelection)==null?void 0:F.call(document);let m=null;if(V!=null&&V.anchorNode){const G=V.anchorNode;m=G.nodeType===Node.ELEMENT_NODE?(K=G.closest)==null?void 0:K.call(G,".var-pill"):(te=(ae=G.parentElement)==null?void 0:ae.closest)==null?void 0:te.call(ae,".var-pill")}D.current.querySelectorAll(".var-pill").forEach(G=>{if(m&&G===m)return;const je=G.getAttribute("data-var");if(!je)return;const Oe=T(je);if(Oe==="__DELETED__"){G.replaceWith(document.createTextNode(""));return}const Te=Oe.trim().length>0,Ve=Te?Oe:`<<${je}>>`,$e=(G.textContent||"").trim(),Ae=Ve.trim();if($e!==Ae){const Fe=_t(Ve);bn(G,Fe),G.classList.toggle("filled",Te),G.classList.toggle("empty",!Te),G.setAttribute("data-display",Te?Oe:"")}})},[f,T]),a.useEffect(()=>{if(!P||!D.current)return;const V=()=>{var G,je,Oe,Te;const m=D.current;if(!m||!(typeof document>"u"||!document.hasFocus||document.hasFocus()))return;const F=(G=document.getSelection)==null?void 0:G.call(document);if(!F){C(null),p(null),$.current={varName:null,timestamp:0};return}const K=F.anchorNode;if(!K||!m.contains(K)){C(null),p(null),$.current={varName:null,timestamp:0};return}const ae=K.nodeType===Node.ELEMENT_NODE?(je=K.closest)==null?void 0:je.call(K,".var-pill"):(Te=(Oe=K.parentElement)==null?void 0:Oe.closest)==null?void 0:Te.call(Oe,".var-pill"),te=(ae==null?void 0:ae.getAttribute("data-var"))||null;C(te),p(te),te&&F.isCollapsed&&Date.now()>=(ue.current||0)&&y(ae,te),te||($.current={varName:null,timestamp:0})};return document.addEventListener("selectionchange",V),()=>document.removeEventListener("selectionchange",V)},[P,C,p,y]),e.jsxs("div",{className:"relative",children:[R&&e.jsx(No,{onCommand:We,disabled:c,className:"mb-2"}),e.jsx("div",{ref:D,contentEditable:!c,className:`lexical-content-editable${I==="compact"?" lexical-content-editable--compact":""} ${U}`,role:"textbox","aria-multiline":"true","aria-autocomplete":"none",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",inputMode:"text","data-gramm":"false","data-lpignore":"true","data-1p-ignore":"true","data-1password-blocklist":"true",onInput:H,onFocus:z,onBlur:Z,onBeforeInput:qe,onCompositionStart:xe,onMouseDown:de,onDoubleClick:ye,onPaste:pe,onKeyDown:we,suppressContentEditableWarning:!0,"data-placeholder":w,style:{minHeight:W,...v}})]})}),ht=a.forwardRef(({className:r,...i},s)=>e.jsx("div",{ref:s,className:Be("rounded-lg border bg-card text-card-foreground shadow-sm",r),...i}));ht.displayName="Card";const fr=a.forwardRef(({className:r,...i},s)=>e.jsx("div",{ref:s,className:Be("flex flex-col space-y-1.5 p-6",r),...i}));fr.displayName="CardHeader";const hr=a.forwardRef(({className:r,...i},s)=>e.jsx("h3",{ref:s,className:Be("text-2xl font-semibold leading-none tracking-tight",r),...i}));hr.displayName="CardTitle";const vt=a.forwardRef(({className:r,...i},s)=>e.jsx("div",{ref:s,className:Be("p-6 pt-0",r),...i}));vt.displayName="CardContent";const Ut=a.forwardRef(({className:r,autoComplete:i="off",autoCorrect:s="off",autoCapitalize:d="off",spellCheck:n=!1,...f},w)=>e.jsx("textarea",{className:Be("flex min-h-[80px] w-full rounded-[14px] border border-input bg-transparent px-4 py-4 text-[16px] leading-[1.7] ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#1f8a99] focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none font-[Inter] tracking-[0.01em]",r),"data-lpignore":"true","data-1p-ignore":"true","data-bwignore":"true","data-gramm":"false","data-enable-grammarly":"false","data-ms-editor":"false",autoComplete:i,autoCorrect:s,autoCapitalize:d,spellCheck:n,ref:w,...f}));Ut.displayName="Textarea";const Lo={improve:{icon:ft,color:"from-slate-600 to-slate-700"},formal:{icon:Bt,color:"from-slate-700 to-indigo-700"},friendly:{icon:ft,color:"from-emerald-600 to-teal-600"},concise:{icon:Bt,color:"from-slate-500 to-slate-600"},grammar:{icon:Ht,color:"from-amber-600 to-orange-600"},translate:{icon:Sr,color:"from-indigo-600 to-slate-600"},translateToEnglish:{icon:Sr,color:"from-blue-600 to-slate-600"},emphasize:{icon:ft,color:"from-orange-600 to-red-600"},simplify:{icon:dr,color:"from-green-600 to-teal-600"},persuasive:{icon:Bt,color:"from-purple-600 to-indigo-600"},urgent:{icon:Bt,color:"from-red-600 to-orange-600"},confident:{icon:ft,color:"from-blue-600 to-indigo-600"}},qo={fr:{headerTitle:"Assistant de rédaction Copilot M365",headerSubtitle:"Améliorez votre texte avec Copilot",quickStartTitle:"Comment ça marche ?",quickStartSteps:["Cliquez sur une action pour copier le prompt","Ouvrez Copilot dans Edge, Word ou Outlook","Collez et validez pour voir le résultat"],edgeDetected:"Edge détecté ! Ctrl+Shift+. pour Copilot",actionsTitle:"Actions rapides",emptyState:"Sélectionnez un modèle pour utiliser Copilot",shortcutsTitle:"Raccourcis utiles",shortcuts:[{label:"Ouvrir Copilot (Edge)",combo:"Ctrl+Shift+."},{label:"Copier le texte",combo:"Ctrl+C"},{label:"Coller le résultat",combo:"Ctrl+V"}],edgeButton:"En savoir plus sur Edge Copilot",tip:"Astuce : Les variables sont automatiquement conservées lorsque vous utilisez Copilot. Demandez des ajustements spécifiques si nécessaire.",copyAlertNoContent:"Veuillez d'abord sélectionner un modèle et saisir du contenu.",copyError:"Impossible de copier dans le presse-papiers",edgeAlert:"Appuyez sur Ctrl+Shift+. (Cmd+Shift+. sur Mac) pour ouvrir Copilot dans Edge",customPromptTitle:"Instruction personnalisée",customPromptPlaceholder:'Ajoutez ici une consigne spécifique (ex.: "Réduis à 80 mots en conservant un ton inspirant").',customPromptHelper:"Copiée avec le contenu actuel.",customPromptButton:"Copier avec ma consigne",customPromptFallback:"Améliore ce texte selon la consigne suivante :",actions:{improve:{title:"Améliorer",prompt:"Améliore ce texte pour le rendre plus professionnel et engageant sans modifier les variables existantes :"},formal:{title:"Formel",prompt:"Rends ce texte plus formel et professionnel tout en conservant les variables :"},friendly:{title:"Amical",prompt:"Rends ce texte plus chaleureux et amical tout en gardant un ton professionnel :"},concise:{title:"Concis",prompt:"Rends ce texte plus concis et direct sans perdre d'information :"},grammar:{title:"Corriger",prompt:"Corrige la grammaire, l'orthographe et la ponctuation sans modifier les variables :"},translate:{title:"EN→FR",prompt:"Traduis ce texte de l'anglais vers le français en gardant un ton professionnel :"},translateToEnglish:{title:"FR→EN",prompt:"Traduis ce texte du français vers l'anglais en gardant un ton professionnel :"},emphasize:{title:"Emphase",prompt:"Réécris ce texte pour mettre en valeur les points clés de façon plus percutante :"},simplify:{title:"Simplifier",prompt:"Simplifie ce texte pour le rendre plus clair et accessible :"},persuasive:{title:"Persuasif",prompt:"Réécris ce texte pour le rendre plus convaincant et persuasif :"},urgent:{title:"Urgent",prompt:"Réécris ce texte avec un ton urgent pour inciter à l'action :"},confident:{title:"Confiant",prompt:"Réécris ce texte avec un ton plus confiant et assuré :"}}},en:{headerTitle:"M365 Copilot Writing Assistant",headerSubtitle:"Use Microsoft Copilot to enhance your email templates",quickStartTitle:"How it works",quickStartSteps:["Click an action below to copy the prompt","Open Copilot in Edge, Word, or Outlook","Paste the prompt and review the improved result"],edgeDetected:"Edge detected! Press Ctrl+Shift+. to open Copilot",actionsTitle:"Quick actions",emptyState:"Select a template and add content before using the Copilot assistant",shortcutsTitle:"Helpful shortcuts",shortcuts:[{label:"Open Copilot (Edge)",combo:"Ctrl+Shift+."},{label:"Copy text",combo:"Ctrl+C"},{label:"Paste result",combo:"Ctrl+V"}],edgeButton:"Learn more about Edge Copilot",tip:"Tip: Your placeholders are preserved automatically. Feel free to ask Copilot for specific edits.",copyAlertNoContent:"Select a template and add content before using the assistant.",copyError:"Unable to copy to clipboard",edgeAlert:"Press Ctrl+Shift+. (Cmd+Shift+. on Mac) to open Copilot in Edge",customPromptTitle:"Custom instruction",customPromptPlaceholder:"Add a specific instruction (e.g. “Rewrite in 80 words with a confident tone”).",customPromptHelper:"Your instruction is copied along with the current email content.",customPromptButton:"Copy with my instruction",customPromptFallback:"Improve this text using the following instruction:",actions:{improve:{title:"Improve tone",prompt:"Improve this email so it sounds more professional and engaging without touching the placeholders:"},formal:{title:"Make it formal",prompt:"Rewrite this email with a formal, polished tone. Keep all placeholders intact:"},friendly:{title:"Make it friendly",prompt:"Make this email warmer and friendlier while staying professional:"},concise:{title:"Make it concise",prompt:"Tighten this email so it stays concise and to the point without losing key details:"},grammar:{title:"Fix grammar",prompt:"Fix grammar, spelling, and punctuation while leaving placeholders untouched:"},translate:{title:"Translate EN→FR",prompt:"Translate this English email into French with a professional tone:"},translateToEnglish:{title:"Translate FR→EN",prompt:"Translate this French email into English with a professional tone:"},emphasize:{title:"Emphasize key points",prompt:"Rewrite this email to emphasize key points more powerfully:"},simplify:{title:"Simplify",prompt:"Simplify this email to make it clearer and easier to understand:"},persuasive:{title:"Make it persuasive",prompt:"Rewrite this email to be more convincing and persuasive:"},urgent:{title:"Urgent tone",prompt:"Rewrite this email with an urgent tone to encourage action:"},confident:{title:"Confident tone",prompt:"Rewrite this email with a more confident and assertive tone:"}}}},Ao=({emailText:r,onResult:i,variables:s,interfaceLanguage:d="fr",templateLanguage:n="fr"})=>{const[f,w]=a.useState(null),[U,v]=a.useState(""),[O,u]=a.useState(!1),[I,c]=a.useState(!1),W=(d==null?void 0:d.toLowerCase())==="en"?"en":"fr",R=qo[W];a.useEffect(()=>{const _=navigator.userAgent;c(_.includes("Edg/"))},[]);const se=(_="")=>String(_??"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'"),re=(_="")=>{const ue=se(_).trim();return ue?ue.replace(/[<>]/g,""):""},ce=(_="")=>{if(!_)return"";const $=/^\/?\s*(?:div|p|br|span|strong|b|em|i|u|ul|ol|li|h[1-6]|table|tbody|thead|tr|td|th|a|img|section|article|header|footer)\b/i;return String(_).replace(/<([^<>]+)>/g,(ue,ne)=>$.test(ne)?ue:ne)},D=(_="")=>{if(!_)return"";const $=qt(s||{},_,n)||"";if($&&$.trim().length)return re($);const ue=s==null?void 0:s[_];if(ue&&String(ue).trim().length)return re(ue);const ne=s==null?void 0:s[String(_).toLowerCase()];return ne&&String(ne).trim().length?re(ne):""},P=(_="")=>_?_.replace(/<<\s*([^<>]+?)\s*>>/g,($,ue)=>D(ue)||`<<${ue.trim()}>>`):"",oe=_=>{if(!_)return"";const ne=se(_).replace(/<([A-Za-z0-9-]*_[A-Za-z0-9-]*)>/g,"<<$1>>");if(/<<\s*[^<>]+\s*>>/.test(ne)){const y=ne.replace(/<<\s*>>/g,"").replace(/\s+\n/g,`
`).replace(/\n{2,}/g,`
`).trim();return ce(P(y))}const T=document.createElement("div");T.innerHTML=_;const Y=y=>re(y),X=y=>{let N="";return y&&y.childNodes.forEach(C=>{if(C.nodeType===Node.TEXT_NODE)N+=C.textContent;else if(C.nodeType===Node.ELEMENT_NODE){const L=C.getAttribute("data-var");if(L){const H=D(L),z=Y(C.getAttribute("data-display"))||Y(C.getAttribute("data-value"))||Y(C.textContent),Z=H||z||`<<${L}>>`;N+=Z}else C.tagName==="BR"?N+=`
`:N+=X(C)}}),N},p=X(T).replace(/\s+\n/g,`
`).replace(/\n{2,}/g,`
`).trim();return ce(P(p))},be=()=>{const _=oe(r),$={};return Object.entries(Lo).forEach(([ue,ne])=>{const T=R.actions[ue];T&&($[ue]={title:T.title,icon:ne.icon,color:ne.color,prompt:`${T.prompt}

${_}`})}),$},J=async _=>{if(!r||r.trim()===""){alert(R.copyAlertNoContent);return}const ue=be()[_];try{await navigator.clipboard.writeText(ue.prompt),w(_),setTimeout(()=>w(null),2e3)}catch(ne){console.error("Erreur de copie:",ne),alert(R.copyError)}},he=async()=>{if(!r||r.trim()===""){alert(R.copyAlertNoContent);return}const _=oe(r),ue=`${U.trim()||R.customPromptFallback}

${_}`;try{await navigator.clipboard.writeText(ue),u(!0),setTimeout(()=>u(!1),2e3)}catch(ne){console.error("Erreur de copie:",ne),alert(R.copyError)}};return e.jsxs("div",{className:"h-full flex flex-col space-y-3",children:[e.jsx(ht,{className:"bg-white/98 border border-slate-100 rounded-lg shadow-sm",children:e.jsx(fr,{className:"p-3",children:e.jsxs(hr,{className:"text-sm font-semibold text-gray-800 flex items-center",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg bg-slate-100 text-slate-700 mr-2.5",children:e.jsx(ft,{className:"h-4 w-4 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"leading-tight",children:R.headerTitle}),e.jsx("p",{className:"text-xs font-normal text-gray-500 mt-0.5",children:R.headerSubtitle})]})]})})}),e.jsx(ht,{className:"bg-white/98 border border-slate-100 rounded-lg shadow-sm",children:e.jsxs(vt,{className:"p-3 flex items-center",children:[e.jsxs("div",{className:"flex items-start space-x-2.5",children:[e.jsx("div",{className:"flex-shrink-0 w-7 h-7 rounded-full bg-blue-100 flex items-center justify-center mt-3",children:e.jsx(dr,{className:"h-3.5 w-3.5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-xs text-gray-800 mb-1.5 mt-3",children:R.quickStartTitle}),e.jsx("ol",{className:"text-xs text-gray-600 space-y-1",children:R.quickStartSteps.map((_,$)=>e.jsxs("li",{className:"flex items-start",children:[e.jsxs("span",{className:"font-semibold text-blue-600 mr-1.5 text-xs",children:[$+1,"."]}),e.jsx("span",{className:"text-xs",children:_})]},_))})]})]}),I&&e.jsxs("div",{className:"mt-2.5 p-2 bg-green-50 border border-green-200 rounded-lg flex items-start space-x-2",children:[e.jsx(Ht,{className:"h-3.5 w-3.5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-xs text-green-800",children:R.edgeDetected})]})]})}),e.jsx(ht,{className:"bg-white/98 border border-slate-100 rounded-lg shadow-sm flex-1 overflow-hidden",children:e.jsxs(vt,{className:"p-3 h-full overflow-y-auto",children:[e.jsxs("h3",{className:"font-semibold text-xs text-gray-800 mb-2.5 pt-2 flex items-center",children:[e.jsx(Bt,{className:"h-3.5 w-3.5 mr-1.5 text-slate-600"}),R.actionsTitle]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(be()).map(([_,$])=>{const ue=$.icon,ne=f===_;return e.jsxs(Ce,{onClick:()=>J(_),className:"h-10 w-full rounded-lg border border-slate-200 bg-white text-xs font-medium text-slate-700 justify-center group hover:bg-slate-50 transition-colors transition-transform transform hover:-translate-y-0.5 hover:shadow-sm",disabled:!r||r.trim()==="",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"h-4 w-4 mr-2 text-slate-500 group-hover:text-slate-700"}),e.jsx("span",{children:$.title})]}),e.jsx("div",{className:"flex items-center absolute right-2",children:ne?e.jsxs(e.Fragment,{children:[e.jsx(Ht,{className:"h-3.5 w-3.5 text-emerald-500"}),e.jsx("span",{className:"text-emerald-600 text-xs ml-2",children:"Copied"})]}):e.jsx(mr,{className:"h-3.5 w-3.5 text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity"})})]},_)})}),(!r||r.trim()==="")&&e.jsx("div",{className:"mt-3 p-2.5 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Pn,{className:"h-3.5 w-3.5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-amber-800",children:R.emptyState})]})})]})}),e.jsx(ht,{className:"bg-white/98 border border-slate-100 rounded-lg shadow-sm",children:e.jsxs(vt,{className:"p-3 space-y-2.5",children:[e.jsxs("h3",{className:"font-semibold text-xs text-gray-800 pt-2 flex items-center",children:[e.jsx(ft,{className:"h-3.5 w-3.5 mr-1.5 text-slate-600"}),R.customPromptTitle]}),e.jsx(Ut,{value:U,onChange:_=>v(_.target.value),placeholder:R.customPromptPlaceholder,className:"min-h-[50px] text-xs resize-none"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{className:"text-xs",children:R.customPromptHelper}),e.jsxs("span",{className:"text-xs text-gray-400",children:[U.length,"/280"]})]}),e.jsxs(Ce,{onClick:he,disabled:!r||r.trim()==="",className:"w-full h-9 rounded-lg bg-slate-800 hover:bg-slate-900 text-white text-xs flex items-center justify-center gap-2 transition-transform transform hover:-translate-y-0.5 hover:shadow-sm",children:[O?e.jsx(Ht,{className:"h-3.5 w-3.5"}):e.jsx(mr,{className:"h-3.5 w-3.5"}),R.customPromptButton]})]})})]})},Br=a.forwardRef(({className:r,children:i,viewportClassName:s,viewportRef:d,onViewportScroll:n,...f},w)=>e.jsxs(kn,{ref:w,className:Be("relative overflow-hidden",r),...f,children:[e.jsx(Ss,{ref:d,className:Be("h-full w-full rounded-[inherit]",s),onScroll:n,children:i}),e.jsx(On,{}),e.jsx(Ps,{})]}));Br.displayName=kn.displayName;const On=a.forwardRef(({className:r,orientation:i="vertical",...s},d)=>e.jsx(Rn,{ref:d,orientation:i,"data-slot":"scroll-area-scrollbar",className:Be("flex touch-none select-none transition-all duration-200",i==="vertical"&&"h-full w-1.5 border-l border-l-transparent p-px",i==="horizontal"&&"h-1.5 flex-col border-t border-t-transparent p-px",r),...s,children:e.jsx(ks,{"data-slot":"scroll-area-thumb",className:"relative flex-1 rounded-full bg-slate-300/60 hover:bg-slate-400/70 transition-colors"})}));On.displayName=Rn.displayName;const Tt=a.forwardRef(({className:r,orientation:i="horizontal",decorative:s=!0,...d},n)=>e.jsx(Tn,{ref:n,decorative:s,orientation:i,className:Be("shrink-0 bg-border",i==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...d}));Tt.displayName=Tn.displayName;const vn={fr:{title:"Centre d'aide",subtitle:"Réponses express pour ECHO",quickStart:{heading:"Prise en main rapide",description:"Suivez ces étapes pour générer un courriel prêt à envoyer en moins d'une minute.",bullets:["Choisissez un modèle dans la colonne de gauche. Utilisez la recherche et le filtre de catégories pour accélérer.","Ajoutez vos informations : tapez directement dans les zones “Objet” et “Message” ou utilisez le popup Variables pour profiter des mises à jour en temps réel.","Copiez le résultat (objet, corps ou tout) ou composez directement dans Outlook lorsque vous êtes satisfait."]},sections:{copilot:{heading:"Assistant Copilot M365",points:["L'assistant Copilot vous aide à améliorer vos courriels avec 12 actions rapides : améliorer, formaliser, simplifier, corriger, traduire, etc.","Cliquez sur une action pour copier le prompt avec le contenu de votre email, puis collez dans Copilot (Edge, Word ou Outlook).","Les variables sont préservées automatiquement : Copilot voit les valeurs réelles, pas les noms de variables.",`Utilisez l'instruction personnalisée pour des demandes spécifiques (ex.: "Réduis à 80 mots avec un ton inspirant").`]},variables:{heading:"Variables & pastilles",points:["Les variables apparaissent comme des pastilles colorées dans l'Objet et le Corps. Cliquez dessus pour les modifier directement.","Les pastilles montrent la valeur en temps réel avec le nom de la variable. Le système extrait automatiquement les valeurs lors du copier-coller.","Utilisez le panneau Variables pour voir et éditer toutes les valeurs d'un coup; la synchronisation est bidirectionnelle et instantanée.","Les variables sont préservées lors de l'utilisation de l'assistant Copilot et apparaissent avec leurs valeurs réelles dans les prompts."]},popout:{heading:"Fenêtre détachée (popout)",points:["Ouvrez le panneau Variables dans une fenêtre séparée pour travailler côte à côte.","À l'ouverture, les valeurs sont extraites immédiatement de l'Objet et du Corps (via les pastilles).","Les changements dans l'une ou l'autre fenêtre se reflètent automatiquement (BroadcastChannel)."]},copying:{heading:"Copier & Envoyer",points:["Les boutons Copier Objet / Copier Corps / Copier Tout incluent vos valeurs actuelles et le formatage riche (gras, surlignage, etc.).","Le bouton « Ouvrir dans un courriel » génère un lien mailto qui ouvre votre client de messagerie par défaut (Outlook, Gmail, etc.) et insère automatiquement l'objet et le corps en texte brut.","Important : Le formatage riche est perdu avec le bouton mailto. Pour conserver le gras, les couleurs et le surlignage, utilisez « Copier Tout » puis collez dans votre client préféré.","Le lien direct (icône de lien) inclut l'identifiant et la langue dans l'URL pour partager le modèle avec des collègues.","Les actions Copilot copient automatiquement le prompt complet avec les valeurs des variables injectées pour une utilisation immédiate dans Copilot."]},favorites:{heading:"Favoris",points:["Cliquez l'icône étoile pour marquer un modèle. L'icône devient or quand favori et très claire sinon.","Activez « Afficher uniquement les favoris » pour filtrer la liste.","Les favoris sont mémorisés localement dans le navigateur."]},shortcuts:{heading:"Raccourcis clavier",items:[["Ctrl/Cmd + Entrée","Copier tout"],["Ctrl/Cmd + B","Copier le corps"],["Ctrl/Cmd + J","Copier l'objet"],["Ctrl/Cmd + Shift + Entrée","Ouvrir dans un courriel"],["Ctrl/Cmd + /","Focus sur la recherche"],["Ctrl/Cmd + R (Variables)","Réinitialiser aux exemples"],["Ctrl/Cmd + Shift + V (Variables)","Collage intelligent var: valeur"]]},privacy:{heading:"Confidentialité & stockage",points:["Tout fonctionne localement dans votre navigateur. Aucune donnée n'est envoyée à un serveur, sauf si vous soumettez le formulaire de contact.","Les préférences (langues, favoris, etc.) et les variables en cours sont sauvegardées en local."]}},faq:{heading:"Questions fréquentes",items:[{question:"Les valeurs du popup correspondent-elles toujours au texte ?",answer:"Oui. À l'ouverture, le popup synchronise immédiatement les valeurs actuelles grâce à l'extraction directe de l'objet et du message. Les modifications faites dans le texte sont détectées automatiquement."},{question:"Comment utiliser les boutons X et Réinitialiser sur les cartes de variables ?",answer:"Le bouton X supprime la pastille de la variable du texte de votre courriel. Le bouton Réinitialiser restaure la variable avec sa valeur d'exemple d'origine et réinsère la pastille dans le texte."},{question:"Comment revenir aux valeurs par défaut ?",answer:"Utilisez le bouton Réinitialiser dans l'éditeur. Il recharge le modèle sélectionné, restaure les valeurs d'exemple et efface les champs personnalisés."},{question:"Puis-je travailler sans connexion ?",answer:"Oui. Tous les traitements se font dans votre navigateur et les données restent locales."}]},troubleshooting:{heading:"Dépannage express",items:[{title:"Le popup ne montre pas les nouvelles valeurs",steps:["Fermez puis rouvrez le popup pour déclencher une synchronisation complète.","Vérifiez que vous n'êtes pas sur un onglet inactif qui bloquerait les BroadcastChannels (certains navigateurs limitent la communication).","Rechargez la page avec ⇧ + ⌘ + R (Mac) ou ⇧ + Ctrl + R (Windows) pour repartir d'un état propre."]},{title:"Le bouton “Ouvrir dans un courriel” ne fait rien",steps:["Confirmez qu'un modèle est sélectionné. Le bouton s'active uniquement quand un contenu final est disponible.","Certaines organisations bloquent les liens `mailto:`. Dans ce cas, utilisez « Copier Tout » puis collez manuellement dans votre client de messagerie.","Si rien ne se produit, vérifiez que vous avez un client de messagerie par défaut configuré dans Windows (Paramètres > Applications > Applications par défaut > E-mail)."]}]},resources:{heading:"Ressources utiles",links:[]},contact:{heading:"Besoin d'un coup de main ?",description:"Choisissez ce qui décrit le mieux votre demande et envoyez-nous un court message.",options:[{value:"support",label:"Support",helper:"Accès, permissions ou fonctionnement général",messageLabel:"Décrivez la situation",placeholder:"Expliquez ce dont vous avez besoin, les personnes impliquées et les échéances."},{value:"glitch",label:"Glitch / bogue",helper:"Fonctionnalité en panne ou comportement étrange",messageLabel:"Que s'est-il produit ?",placeholder:"Ajoutez les étapes pour reproduire, le navigateur utilisé et tout message d'erreur."},{value:"improvement",label:"Amélioration / idée",helper:"Partagez une idée ou une optimisation pour ECHO",messageLabel:"Quelle est votre suggestion ?",placeholder:"Décrivez l'amélioration souhaitée et l'impact attendu."},{value:"template",label:"Soumettre un modèle",helper:"Envoyez un modèle à réviser ou à publier",messageLabel:"Présentez votre modèle",placeholder:"Résumé, ton, contexte d'utilisation et points à surveiller.",extraField:{label:"Lien vers le fichier ou SharePoint (facultatif)",placeholder:"Collez un lien vers Teams, OneDrive ou SharePoint."}}],form:{nameLabel:"Nom complet",namePlaceholder:"Ex. Marie Dubois",emailLabel:"Courriel professionnel",emailPlaceholder:"prenom.nom@tpsgc-pwgsc.gc.ca",messageLabelFallback:"Message",optional:"(facultatif)",submit:"Envoyer la demande",submitting:"Envoi en cours…",successTitle:"Merci !",successMessage:"Votre message a été transmis à l'équipe. Nous vous répondrons sous deux jours ouvrables.",sendAnother:"Envoyer une autre demande",errorTitle:"Oups…",errorMessage:()=>"Impossible d'envoyer pour le moment. Réessayez plus tard ou contactez le support technique.",validation:{nameRequired:"Indiquez votre nom.",emailRequired:"Entrez un courriel valide.",messageRequired:"Merci d'ajouter quelques détails."},extraHelp:"Pour les soumissions de modèles, joignez un lien accessible si possible."},close:"Fermer le centre d'aide"}},en:{title:"Help Centre",subtitle:"Get answers fast for ECHO",quickStart:{heading:"Quick start",description:"Follow these steps to produce a ready-to-send message in under a minute.",bullets:["Pick a template from the left rail. Use search and category filters to narrow the list.","Add your details: type directly in the Subject and Message areas or open the Variables popout for real-time updates.","Copy the result (subject, body, or everything) or launch Outlook when you're happy with the message."]},sections:{copilot:{heading:"M365 Copilot Assistant",points:["The Copilot Assistant helps enhance your emails with 12 quick actions: improve, formalize, simplify, fix grammar, translate, and more.","Click an action to copy the prompt with your email content, then paste into Copilot (Edge, Word, or Outlook).","Variables are preserved automatically: Copilot sees the actual values, not variable names.",'Use the custom instruction field for specific requests (e.g., "Rewrite in 80 words with a confident tone").']},variables:{heading:"Variables & pills",points:["Variables appear as colored pills in Subject and Body. Click them to edit values directly.","Pills display real-time values with variable names. The system automatically extracts values during copy operations.","Use the Variables panel to view/edit all values at once; syncing is bidirectional and instantaneous.","Variables are preserved when using the Copilot Assistant and appear with their actual values in prompts."]},popout:{heading:"Detached window (popout)",points:["Open Variables in a separate window to work side-by-side.","When opening, values are extracted immediately from the Subject and Body (via the pills).","Edits reflect both ways automatically using BroadcastChannel."]},copying:{heading:"Copying & Sending",points:["Copy Subject / Copy Body / Copy All buttons include your current values and preserve rich formatting (bold, highlights, etc.).",'The "Open in an email" button generates a mailto link that opens your default email client (Outlook, Gmail, etc.) and pre-fills the subject and body with plain text.','Important: Rich formatting is lost when using the mailto button. To preserve bold, colors, and highlights, use "Copy All" and paste into your preferred client.',"The direct-link icon includes id & language in the URL to share the template with colleagues.","Copilot actions automatically copy the complete prompt with injected variable values for immediate use in Copilot."]},favorites:{heading:"Favorites",points:["Click the star to favorite a template. The icon turns gold when favorited and very light when not.","Turn on “Show only favorites” to filter the list.","Favorites are stored locally in your browser."]},shortcuts:{heading:"Keyboard shortcuts",items:[["Ctrl/Cmd + Enter","Copy all"],["Ctrl/Cmd + B","Copy body"],["Ctrl/Cmd + J","Copy subject"],["Ctrl/Cmd + Shift + Enter","Open in an email"],["Ctrl/Cmd + /","Focus search"],["Ctrl/Cmd + R (Variables)","Reset to examples"],["Ctrl/Cmd + Shift + V (Variables)","Smart paste var: value"]]},privacy:{heading:"Privacy & storage",points:["Everything runs locally in your browser. No data is sent to a server unless you submit the contact form.","Preferences (languages, favorites, etc.) and in-progress variables are saved in local storage."]}},faq:{heading:"Frequently asked questions",items:[{question:"Does the popout always match the main editors?",answer:"Yes. Opening the popout triggers an immediate sync that extracts the current subject and body. Text edits are auto-detected and reflected back."},{question:"How do I use the X and Reinitialize buttons on variable cards?",answer:"The X button removes the variable pill from your email text. The Reinitialize button restores the variable with its original example value and reinserts the pill into the text."},{question:"How do I restore default example values?",answer:"Use the Reset button in the editor. It reloads the selected template, restores example values, and clears custom text fields."},{question:"Can I work offline?",answer:"Absolutely. Everything runs in your browser and data stays local."}]},troubleshooting:{heading:"Troubleshooting checklist",items:[{title:"Popout is missing recent edits",steps:["Close and reopen the popout to force a full refresh.","Make sure the tab stays active—some browsers pause BroadcastChannels in background tabs.","Hard reload with ⇧ + ⌘ + R (Mac) or ⇧ + Ctrl + R (Windows) to clear cached state."]},{title:'"Open in an email" button does nothing',steps:["Confirm that a template is selected. The button is enabled only when final content is available.",'Some organizations block `mailto:` links. If that\'s the case, use "Copy All" and paste into your email client manually.',"If nothing happens, check that you have a default email client configured in Windows (Settings > Apps > Default apps > Email)."]}]},resources:{heading:"Helpful resources",links:[]},contact:{heading:"Need something else?",description:"Pick the option that fits best and send us a quick note.",options:[{value:"support",label:"Support",helper:"Access, permissions, or general guidance",messageLabel:"Tell us what you need",placeholder:"Share the context, people involved, and any deadlines."},{value:"glitch",label:"Glitch",helper:"Broken feature or unexpected behaviour",messageLabel:"What happened?",placeholder:"List the steps to reproduce, browser used, and any error messages."},{value:"improvement",label:"Improvement / suggestion",helper:"Share an idea to make ECHO better",messageLabel:"What would you improve?",placeholder:"Describe the enhancement and the impact you expect."},{value:"template",label:"Submit a template",helper:"Send a new template or a modification",messageLabel:"Describe your template",placeholder:"Summarize tone, audience, context, and any review notes.",extraField:{label:"Link to files or SharePoint (optional)",placeholder:"Paste a Teams, OneDrive, or SharePoint link."}}],form:{nameLabel:"Full name",namePlaceholder:"e.g. Sarah Thompson",emailLabel:"Work email",emailPlaceholder:"firstname.lastname@tpsgc-pwgsc.gc.ca",messageLabelFallback:"Message",optional:"(optional)",submit:"Send request",submitting:"Sending…",successTitle:"Thanks!",successMessage:"Your message is on its way. We usually respond within two business days.",sendAnother:"Send another request",errorTitle:"Uh-oh…",errorMessage:()=>"We couldn't send your message. Try again later or contact technical support.",validation:{nameRequired:"Please share your name.",emailRequired:"Enter a valid email address.",messageRequired:"Add a few details so we can help."},extraHelp:"For template submissions, include a link we can open if possible."},close:"Close help centre"}}};function ot({icon:r,title:i,description:s}){return e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 flex h-10 w-10 items-center justify-center rounded-lg border border-[#bfe7e3] bg-[#f0fbfb] text-[#145a64]",children:e.jsx(r,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-[#123a45]",children:i}),s?e.jsx("p",{className:"text-sm text-slate-600",children:s}):null]})]})}function Fo({language:r="fr",onClose:i,supportEmail:s="echo-support@jskennedy.net",contactEndpoint:d}){var p,y,N,C,L,H,z,Z,pe,we,de,qe,xe,ye,We,V;const n=a.useMemo(()=>vn[r]||vn.fr,[r]),f=((p=n.contact)==null?void 0:p.options)||[],w=a.useRef(null),U=a.useRef(null),[v,O]=a.useState(""),u=a.useMemo(()=>{var m;try{const F=new URLSearchParams(window.location.search).get("category");if(F&&f.some(K=>K.value===F))return F}catch{}return((m=f[0])==null?void 0:m.value)||"support"},[f]),I=u==="template",[c,W]=a.useState(()=>({category:u,name:"",email:"",message:"",extra:""})),[R,se]=a.useState({templateType:"new",existingId:"",languages:{fr:!1,en:!1},titleFr:"",titleEn:"",category:"",audience:"",context:"",variablePlan:"",examples:"",deadline:""}),[re,ce]=a.useState("idle"),[D,P]=a.useState({}),oe=(()=>{var m,x;try{const F=(x=(m=import.meta)==null?void 0:m.env)==null?void 0:x.VITE_SUPPORT_FORM_ENDPOINT;if(typeof F=="string"&&F.trim())return F.trim()}catch{}return null})(),be=`https://formsubmit.co/ajax/${encodeURIComponent(s)}`,he=d||oe||be,_=f.find(m=>m.value===c.category)||f[0]||null,$=re==="submitting",ue=re==="success"?n.contact.form.successMessage:re==="error"?n.contact.form.errorMessage():"";a.useEffect(()=>{!_&&f[0]&&W(m=>({...m,category:f[0].value}))},[_,f]),a.useEffect(()=>{const m=F=>{F.key==="Escape"&&(F.preventDefault(),i==null||i())};document.addEventListener("keydown",m);const x=document.body.style.overflow;return document.body.style.overflow="hidden",requestAnimationFrame(()=>{var F;u==="template"&&U.current?setTimeout(()=>{var K;(K=U.current)==null||K.scrollIntoView({behavior:"instant",block:"start"})},50):(F=w.current)==null||F.focus()}),()=>{document.removeEventListener("keydown",m),document.body.style.overflow=x}},[i,u]);const ne=m=>{W(x=>({...x,category:m})),re!=="idle"&&ce("idle")},T=m=>x=>{const F=x.target.value;W(K=>({...K,[m]:F})),P(K=>{if(!K[m])return K;const ae={...K};return delete ae[m],ae}),re!=="idle"&&ce("idle")},Y=()=>{ce("idle"),P({}),W(m=>({...m,message:"",extra:""}))},X=async m=>{if(m.preventDefault(),$)return;const x={};c.name.trim()||(x.name=n.contact.form.validation.nameRequired);const F=c.email.trim();if((!F||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(F))&&(x.email=n.contact.form.validation.emailRequired),c.message.trim()||(x.message=n.contact.form.validation.messageRequired),c.category==="template"&&(!R.languages.fr&&!R.languages.en&&(x.languages=r==="fr"?"Choisissez au moins une langue (FR ou EN).":"Choose at least one language (FR or EN)."),R.templateType||(x.templateType=r==="fr"?"Sélectionnez le type.":"Select the type."),R.templateType==="modify"&&!R.existingId.trim()&&(x.existingId=r==="fr"?"Indiquez l’ID ou le nom du modèle existant.":"Provide the existing template ID or name.")),Object.keys(x).length){P(x);return}ce("submitting");try{const K={category:c.category,categoryLabel:(_==null?void 0:_.label)||c.category,name:c.name.trim(),email:F,message:c.message.trim(),extra:c.extra.trim(),language:r,submittedAt:new Date().toISOString(),product:"ECHO-BT-CTD"};c.category==="template"&&(K.templateDetails={type:R.templateType,existingId:R.existingId||void 0,languages:Object.keys(R.languages).filter(te=>R.languages[te]),titleFr:R.titleFr||void 0,titleEn:R.titleEn||void 0,category:R.category||void 0,audience:R.audience||void 0,context:R.context||void 0,variablePlan:R.variablePlan||void 0,examples:R.examples||void 0,deadline:R.deadline||void 0});const ae=await fetch(he,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(K)});if(!ae.ok)throw new Error(`Unexpected status ${ae.status}`);ce("success"),P({}),W(te=>({...te,message:"",extra:""})),se({templateType:"new",existingId:"",languages:{fr:!1,en:!1},titleFr:"",titleEn:"",category:"",audience:"",context:"",variablePlan:"",examples:"",deadline:""})}catch(K){console.error("Contact form submission failed:",K),ce("error")}};return e.jsxs("div",{className:"fixed inset-0 z-[400] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/55 backdrop-blur-sm",onClick:i,"aria-hidden":"true"}),e.jsxs(ht,{role:"dialog","aria-modal":"true","aria-labelledby":"help-centre-title",className:"relative z-10 flex w-full max-w-4xl flex-col border-0 bg-white shadow-2xl",style:{borderRadius:"0",height:"100vh",maxHeight:"100vh"},children:[e.jsxs(fr,{className:"flex flex-row items-start justify-between m-0 p-0",children:[e.jsxs("div",{className:"m-0 p-0",children:[e.jsx(hr,{id:"help-centre-title",className:"text-xl font-bold text-[#0f2c33] m-0 p-2",children:n.title}),e.jsx("p",{className:"text-xs text-slate-600 m-0 p-2 pt-0",children:n.subtitle})]}),e.jsx(Ce,{ref:w,variant:"ghost",onClick:i,className:"h-9 w-9 rounded-sm m-0 flex items-center justify-center text-slate-600 hover:text-slate-900 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-slate-300","aria-label":n.contact.close,children:e.jsx("span",{className:"text-xl leading-none font-bold select-none","aria-hidden":"true",children:"×"})})]}),e.jsx(vt,{className:"flex-1 m-0 p-0",style:{minHeight:0},children:e.jsx(Br,{className:"h-full w-full",children:e.jsxs("div",{className:I?"px-2 py-2 m-0":"space-y-4 px-2 py-0 m-0",children:[I?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-2 border-b border-[#e6eef5] bg-transparent md:flex-row md:items-center md:justify-between m-0 p-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-700",children:[e.jsx("a",{href:"#quickstart",className:"font-semibold text-[#145a64] hover:underline px-2 py-1",children:n.quickStart.heading}),(y=n.sections)!=null&&y.copilot?e.jsx("a",{href:"#copilot",className:"font-semibold text-[#145a64] hover:underline px-2 py-1",children:n.sections.copilot.heading}):null,(N=n.sections)!=null&&N.variables?e.jsx("a",{href:"#variables",className:"font-semibold text-[#145a64] hover:underline px-2 py-1",children:n.sections.variables.heading}):null,(C=n.sections)!=null&&C.popout?e.jsx("a",{href:"#popout",className:"font-semibold text-[#145a64] hover:underline px-2 py-1",children:n.sections.popout.heading}):null,(L=n.sections)!=null&&L.copying?e.jsx("a",{href:"#copying",className:"font-semibold text-[#145a64] hover:underline px-2 py-1",children:n.sections.copying.heading}):null,(H=n.sections)!=null&&H.favorites?e.jsx("a",{href:"#favorites",className:"font-semibold text-[#145a64] hover:underline px-2 py-1",children:n.sections.favorites.heading}):null,(z=n.sections)!=null&&z.shortcuts?e.jsx("a",{href:"#shortcuts",className:"font-semibold text-[#145a64] hover:underline px-2 py-1",children:n.sections.shortcuts.heading}):null,(Z=n.sections)!=null&&Z.privacy?e.jsx("a",{href:"#privacy",className:"font-semibold text-[#145a64] hover:underline px-2 py-1",children:n.sections.privacy.heading}):null]}),e.jsx("div",{className:"md:w-60",children:e.jsx(Ge,{value:v,onChange:m=>O(m.target.value),placeholder:r==="fr"?"Rechercher dans l'aide…":"Search the help…",className:"h-7 text-xs px-2"})})]}),e.jsxs("section",{id:"quickstart",children:[e.jsx(ot,{icon:dr,title:n.quickStart.heading,description:n.quickStart.description}),e.jsx("ul",{className:"mt-4 space-y-2 text-sm text-slate-700",children:n.quickStart.bullets.map((m,x)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 rounded-full bg-[#1f8a99]","aria-hidden":"true"}),e.jsx("span",{children:m})]},x))})]}),(pe=n.sections)!=null&&pe.copilot?e.jsxs("section",{id:"copilot",children:[e.jsx(ot,{icon:ft,title:n.sections.copilot.heading}),e.jsx("ul",{className:"mt-4 space-y-2 text-sm text-slate-700",children:(n.sections.copilot.points||[]).filter(m=>!v||m.toLowerCase().includes(v.toLowerCase())).map((m,x)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 rounded-full bg-[#1f8a99]","aria-hidden":"true"}),e.jsx("span",{children:m})]},x))})]}):null,(we=n.sections)!=null&&we.variables?e.jsxs("section",{id:"variables",children:[e.jsx(ot,{icon:sn,title:n.sections.variables.heading}),e.jsx("ul",{className:"mt-4 space-y-2 text-sm text-slate-700",children:(n.sections.variables.points||[]).filter(m=>!v||m.toLowerCase().includes(v.toLowerCase())).map((m,x)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 rounded-full bg-[#1f8a99]","aria-hidden":"true"}),e.jsx("span",{children:m})]},x))})]}):null,(de=n.sections)!=null&&de.popout?e.jsxs("section",{id:"popout",children:[e.jsx(ot,{icon:Pr,title:n.sections.popout.heading}),e.jsx("ul",{className:"mt-4 space-y-2 text-sm text-slate-700",children:(n.sections.popout.points||[]).filter(m=>!v||m.toLowerCase().includes(v.toLowerCase())).map((m,x)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 rounded-full bg-[#1f8a99]","aria-hidden":"true"}),e.jsx("span",{children:m})]},x))})]}):null,(qe=n.sections)!=null&&qe.copying?e.jsxs("section",{id:"copying",children:[e.jsx(ot,{icon:mr,title:n.sections.copying.heading}),e.jsx("ul",{className:"mt-4 space-y-2 text-sm text-slate-700",children:(n.sections.copying.points||[]).filter(m=>!v||m.toLowerCase().includes(v.toLowerCase())).map((m,x)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 rounded-full bg-[#1f8a99]","aria-hidden":"true"}),e.jsx("span",{children:m})]},x))})]}):null,(xe=n.sections)!=null&&xe.favorites?e.jsxs("section",{id:"favorites",children:[e.jsx(ot,{icon:Rs,title:n.sections.favorites.heading}),e.jsx("ul",{className:"mt-4 space-y-2 text-sm text-slate-700",children:(n.sections.favorites.points||[]).filter(m=>!v||m.toLowerCase().includes(v.toLowerCase())).map((m,x)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 rounded-full bg-[#1f8a99]","aria-hidden":"true"}),e.jsx("span",{children:m})]},x))})]}):null,e.jsx(Tt,{className:"bg-[#e6eef5]"}),e.jsxs("section",{children:[e.jsx(ot,{icon:sn,title:n.faq.heading}),e.jsx("div",{className:"mt-4 space-y-4",children:n.faq.items.filter(m=>{if(!v)return!0;const x=v.toLowerCase();return m.question.toLowerCase().includes(x)||m.answer.toLowerCase().includes(x)}).map((m,x)=>e.jsxs("div",{className:"rounded-lg border border-[#e1eff4] bg-[#f9feff] p-4 shadow-sm",children:[e.jsx("p",{className:"font-semibold text-[#124a52]",children:m.question}),e.jsx("p",{className:"mt-2 text-sm text-slate-700",children:m.answer})]},x))})]}),e.jsx(Tt,{className:"bg-[#e6eef5]"}),e.jsxs("section",{children:[e.jsx(ot,{icon:on,title:n.troubleshooting.heading}),e.jsx("div",{className:"mt-4 space-y-5",children:n.troubleshooting.items.filter(m=>{if(!v)return!0;const x=v.toLowerCase();return m.title.toLowerCase().includes(x)||(m.steps||[]).some(F=>F.toLowerCase().includes(x))}).map((m,x)=>e.jsxs("div",{className:"rounded-xl border border-[#fde68a] bg-[#fffbeb] p-4 shadow-sm",children:[e.jsx("h4",{className:"text-sm font-semibold text-[#92400e]",children:m.title}),e.jsx("ul",{className:"mt-3 space-y-1.5 text-sm text-[#78350f]",children:m.steps.map((F,K)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"mt-1 h-1.5 w-1.5 flex-shrink-0 rounded-full bg-[#f59e0b]","aria-hidden":"true"}),e.jsx("span",{children:F})]},K))})]},x))})]}),e.jsx(Tt,{className:"bg-[#e6eef5]"}),(ye=n.sections)!=null&&ye.shortcuts?e.jsxs("section",{id:"shortcuts",children:[e.jsx(ot,{icon:dr,title:n.sections.shortcuts.heading}),e.jsx("div",{className:"mt-3 overflow-hidden rounded-lg border border-[#e6eef5]",children:e.jsx("div",{className:"grid grid-cols-1 divide-y divide-[#e6eef5] text-sm md:grid-cols-2 md:divide-x md:divide-y-0",children:(n.sections.shortcuts.items||[]).filter(([m,x])=>{if(!v)return!0;const F=v.toLowerCase();return m.toLowerCase().includes(F)||x.toLowerCase().includes(F)}).map(([m,x],F)=>e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3",children:[e.jsx("span",{className:"font-mono text-xs text-slate-700",children:m}),e.jsx("span",{className:"text-slate-800",children:x})]},F))})})]}):null,(We=n.sections)!=null&&We.privacy?e.jsxs("section",{id:"privacy",children:[e.jsx(ot,{icon:Ts,title:n.sections.privacy.heading}),e.jsx("ul",{className:"mt-4 space-y-2 text-sm text-slate-700",children:(n.sections.privacy.points||[]).filter(m=>!v||m.toLowerCase().includes(v.toLowerCase())).map((m,x)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 rounded-full bg-[#1f8a99]","aria-hidden":"true"}),e.jsx("span",{children:m})]},x))})]}):null,e.jsx(Tt,{className:"bg-[#e6eef5]"}),e.jsx("section",{children:Array.isArray((V=n.resources)==null?void 0:V.links)&&n.resources.links.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ot,{icon:Ls,title:n.resources.heading}),e.jsx("ul",{className:"mt-4 grid gap-2 text-sm text-[#145a64] md:grid-cols-2",children:n.resources.links.map(m=>e.jsx("li",{children:e.jsxs("a",{className:"group inline-flex items-center gap-2 rounded-lg border border-transparent px-3 py-2 transition-colors duration-150 hover:border-[#bfe7e3] hover:bg-[#f0fbfb]",href:m.href,target:"_blank",rel:"noreferrer",children:[e.jsx(Pr,{className:"h-3.5 w-3.5 text-[#1f8a99] transition-transform duration-150 group-hover:translate-x-0.5","aria-hidden":"true"}),e.jsx("span",{children:m.label})]})},m.href))})]}):null}),I?null:e.jsx(Tt,{className:"bg-[#e6eef5]"})]}),e.jsxs("section",{ref:U,className:I?"bg-transparent pt-2":"border-t border-[#bfe7e3] bg-transparent",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[#145a64]",children:[e.jsx(kr,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-sm font-semibold m-0 p-0",children:n.contact.heading})]}),e.jsx("p",{className:"mt-1 text-xs text-slate-600",children:n.contact.description}),e.jsxs("form",{onSubmit:X,className:"mt-2 space-y-3",noValidate:!0,children:[e.jsx("div",{className:"grid gap-1 sm:grid-cols-2",children:f.map(m=>{const x=c.category===m.value;return e.jsx("button",{type:"button",className:`group relative flex flex-col border text-left transition-all duration-200 p-2 rounded-lg ${x?"border-[#1f8a99] bg-white shadow-md ring-2 ring-[#1f8a99]/20":"border-transparent bg-white/60 hover:border-[#bfe7e3] hover:bg-white"}`,"aria-pressed":x,onClick:()=>ne(m.value),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-semibold text-[#0f4c55] text-xs",children:m.label}),e.jsx("span",{className:"block mt-0.5 text-[10px] text-slate-500",children:m.helper})]}),x&&e.jsx(an,{className:"h-4 w-4 text-[#1f8a99] flex-shrink-0","aria-hidden":"true"})]})},m.value)})}),e.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-700",children:[e.jsx("span",{children:n.contact.form.nameLabel}),e.jsx(Ge,{value:c.name,onChange:T("name"),placeholder:n.contact.form.namePlaceholder,"aria-invalid":!!D.name}),D.name?e.jsx("span",{className:"text-[10px] font-normal text-red-600",children:D.name}):null]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-700",children:[e.jsx("span",{children:n.contact.form.emailLabel}),e.jsx(Ge,{type:"email",value:c.email,onChange:T("email"),placeholder:n.contact.form.emailPlaceholder,"aria-invalid":!!D.email}),D.email?e.jsx("span",{className:"text-[10px] font-normal text-red-600",children:D.email}):null]})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-700",children:[e.jsx("span",{children:(_==null?void 0:_.messageLabel)||n.contact.form.messageLabelFallback}),e.jsx(Ut,{value:c.message,onChange:T("message"),placeholder:(_==null?void 0:_.placeholder)||"",rows:5,"aria-invalid":!!D.message}),D.message?e.jsx("span",{className:"text-[10px] font-normal text-red-600",children:D.message}):null]}),c.category==="template"?e.jsxs("div",{className:"space-y-4 rounded-xl border border-[#e6eef5] bg-white p-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Type de demande":"Request type"}),e.jsxs("select",{className:"h-9 rounded-md border border-slate-300 px-2 text-sm",value:R.templateType,onChange:m=>se(x=>({...x,templateType:m.target.value})),"aria-invalid":!!D.templateType,children:[e.jsx("option",{value:"new",children:r==="fr"?"Nouveau modèle":"New template"}),e.jsx("option",{value:"modify",children:r==="fr"?"Modification d'un modèle":"Modification of existing"})]}),D.templateType?e.jsx("span",{className:"text-xs font-normal text-red-600",children:D.templateType}):null]}),R.templateType==="modify"?e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"ID/nom du modèle existant":"Existing template ID/name"}),e.jsx(Ge,{value:R.existingId,onChange:m=>se(x=>({...x,existingId:m.target.value})),placeholder:r==="fr"?"Ex. q002 – Avis de fermeture":"e.g. q002 – Closure notice","aria-invalid":!!D.existingId}),D.existingId?e.jsx("span",{className:"text-xs font-normal text-red-600",children:D.existingId}):null]}):null]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("fieldset",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Langue de votre soumission":"Submission language"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:R.languages.fr,onChange:m=>se(x=>({...x,languages:{...x.languages,fr:m.target.checked}}))}),e.jsx("span",{children:"FR"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:R.languages.en,onChange:m=>se(x=>({...x,languages:{...x.languages,en:m.target.checked}}))}),e.jsx("span",{children:"EN"})]})]}),D.languages?e.jsx("span",{className:"text-xs font-normal text-red-600",children:D.languages}):e.jsx("span",{className:"text-xs font-normal text-slate-500",children:r==="fr"?"Envoyez au moins en français ou en anglais.":"Submit in English or French at minimum."})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Catégorie suggérée":"Suggested category"}),e.jsx(Ge,{value:R.category,onChange:m=>se(x=>({...x,category:m.target.value})),placeholder:r==="fr"?"Ex. Traduction, Délais, Facturation":"e.g., Translation, Deadlines, Billing"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Titre FR":"Title (FR)"}),e.jsx(Ge,{value:R.titleFr,onChange:m=>se(x=>({...x,titleFr:m.target.value})),placeholder:r==="fr"?"Intitulé côté FR (si connu)":"French title (if known)"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Titre EN":"Title (EN)"}),e.jsx(Ge,{value:R.titleEn,onChange:m=>se(x=>({...x,titleEn:m.target.value})),placeholder:r==="fr"?"Titre anglais (si connu)":"English title (if known)"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Public visé":"Audience"}),e.jsx(Ge,{value:R.audience,onChange:m=>se(x=>({...x,audience:m.target.value})),placeholder:r==="fr"?"Ex. employés, gestionnaires, partenaires":"e.g., employees, managers, partners"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Contexte":"Context"}),e.jsx(Ge,{value:R.context,onChange:m=>se(x=>({...x,context:m.target.value})),placeholder:r==="fr"?"Ex. annonce, rappel, incident":"e.g., announcement, reminder, incident"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Où insérer les variables ?":"Where should variables go?"}),e.jsx(Ut,{rows:4,value:R.variablePlan,onChange:m=>se(x=>({...x,variablePlan:m.target.value})),placeholder:r==="fr"?"Ex.: <<date_evenement>> dans l'objet, <<nom_client>> au début du message, etc.":"e.g., <<event_date>> in Subject, <<client_name>> at start of body, etc."}),e.jsx("span",{className:"text-xs font-normal text-slate-500",children:r==="fr"?"Ajoutez ce que vous savez; nous compléterons si nécessaire.":"Add what you know; we can fill in the rest."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Exemples (valeurs connues)":"Examples (known values)"}),e.jsx(Ut,{rows:3,value:R.examples,onChange:m=>se(x=>({...x,examples:m.target.value})),placeholder:r==="fr"?"Ex.: date_evenement = 10-17 juin 2025":"e.g., event_date = June 10–17, 2025"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsx("span",{children:r==="fr"?"Échéance (facultatif)":"Deadline (optional)"}),e.jsx(Ge,{value:R.deadline,onChange:m=>se(x=>({...x,deadline:m.target.value})),placeholder:r==="fr"?"Ex.: d'ici le 15 juin":"e.g., by June 15"})]})]})]}):null,_!=null&&_.extraField?e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[e.jsxs("span",{children:[_.extraField.label," ",e.jsx("span",{className:"font-normal text-slate-500",children:n.contact.form.optional})]}),e.jsx(Ge,{value:c.extra,onChange:T("extra"),placeholder:_.extraField.placeholder})]}):null,_!=null&&_.extraField&&n.contact.form.extraHelp?e.jsx("p",{className:"text-xs text-slate-500",children:n.contact.form.extraHelp}):null,ue?e.jsxs("div",{className:`flex items-start gap-3 rounded-lg border p-3 text-sm ${re==="success"?"border-emerald-200 bg-emerald-50 text-emerald-800":"border-red-200 bg-red-50 text-red-700"}`,children:[re==="success"?e.jsx(an,{className:"mt-0.5 h-4 w-4","aria-hidden":"true"}):e.jsx(on,{className:"mt-0.5 h-4 w-4","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:re==="success"?n.contact.form.successTitle:n.contact.form.errorTitle}),e.jsx("p",{className:"mt-1",children:ue}),re==="success"?e.jsx("button",{type:"button",onClick:Y,className:"mt-2 text-xs font-semibold uppercase tracking-wide text-[#166f7b] hover:text-[#0f4c55]",children:n.contact.form.sendAnother}):null,re==="error"?e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("p",{className:"font-semibold mb-1",children:r==="fr"?"Solutions de repli:":"Fallback options:"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:r==="fr"?"Réessayez plus tard; l’endpoint peut être temporairement indisponible.":"Retry later; endpoint may be temporarily unavailable."}),e.jsxs("li",{children:[r==="fr"?"Envoyez un courriel direct:":"Send direct email:"," ",e.jsx("a",{className:"text-[#145a64] underline",href:`mailto:${s}?subject=ECHO%20Support%20(${encodeURIComponent(c.category)})`,children:s})]})]})]}):null]})]}):null,e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(Ce,{type:"submit",className:"inline-flex items-center gap-2 bg-[#1f8a99] px-5 py-2 text-white hover:bg-[#166f7b]",disabled:$,children:[$?e.jsx(qs,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}):null,e.jsx("span",{children:$?n.contact.form.submitting:n.contact.form.submit})]}),e.jsx(Ce,{type:"button",variant:"ghost",onClick:i,className:"text-[#145a64] hover:bg-[#f0fbfb]",children:n.contact.close})]})]})]})]})})})]})]})}const Mo=Sn("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function yn({className:r,variant:i,...s}){return e.jsx("div",{className:Be(Mo({variant:i}),r),...s})}const wn=Vs,Fr=a.forwardRef(({className:r,children:i,...s},d)=>e.jsxs(Ln,{ref:d,className:Be("flex h-10 w-full items-center justify-between rounded-full border border-input bg-background px-4 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...s,children:[i,e.jsx(As,{asChild:!0,children:e.jsx(pr,{className:"h-4 w-4 opacity-50"})})]}));Fr.displayName=Ln.displayName;const In=a.forwardRef(({className:r,...i},s)=>e.jsx(qn,{ref:s,className:Be("flex cursor-default items-center justify-center py-1",r),...i,children:e.jsx(Fs,{className:"h-4 w-4"})}));In.displayName=qn.displayName;const Vn=a.forwardRef(({className:r,...i},s)=>e.jsx(An,{ref:s,className:Be("flex cursor-default items-center justify-center py-1",r),...i,children:e.jsx(pr,{className:"h-4 w-4"})}));Vn.displayName=An.displayName;const Mr=a.forwardRef(({className:r,children:i,position:s="popper",...d},n)=>e.jsx(Ms,{children:e.jsxs(Fn,{ref:n,className:Be("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:s,...d,children:[e.jsx(In,{}),e.jsx(Ds,{className:Be("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),e.jsx(Vn,{})]})}));Mr.displayName=Fn.displayName;const Do=a.forwardRef(({className:r,...i},s)=>e.jsx(Mn,{ref:s,className:Be("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...i}));Do.displayName=Mn.displayName;const $t=a.forwardRef(({className:r,children:i,...s},d)=>e.jsxs(Dn,{ref:d,className:Be("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(zs,{children:e.jsx(Os,{className:"h-4 w-4"})})}),e.jsx(Is,{children:i})]}));$t.displayName=Dn.displayName;const zo=a.forwardRef(({className:r,...i},s)=>e.jsx(zn,{ref:s,className:Be("-mx-1 my-1 h-px bg-muted",r),...i}));zo.displayName=zn.displayName;const Bn=a.createContext(null),Oo=()=>{const r=a.useContext(Bn);if(!r)throw new Error("useToast must be used within ToastProvider");return r},Io=({children:r})=>{const[i,s]=a.useState([]),d=a.useCallback((w,U="info",v=4e3)=>{const O=Date.now()+Math.random(),u={id:O,message:w,type:U,duration:v};return s(I=>[...I,u]),v>0&&setTimeout(()=>{n(O)},v),O},[]),n=a.useCallback(w=>{s(U=>U.filter(v=>v.id!==w))},[]),f=a.useCallback((w,U={})=>{const{type:v="info",duration:O=4e3}=U;return d(w,v,O)},[d]);return f.success=a.useCallback((w,U)=>d(w,"success",U),[d]),f.error=a.useCallback((w,U)=>d(w,"error",U),[d]),f.info=a.useCallback((w,U)=>d(w,"info",U),[d]),e.jsxs(Bn.Provider,{value:f,children:[r,e.jsx(Vo,{toasts:i,onRemove:n})]})},Vo=({toasts:r,onRemove:i})=>r.length===0?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none",children:r.map(s=>e.jsx(Bo,{toast:s,onRemove:i},s.id))}),Bo=({toast:r,onRemove:i})=>{const{id:s,message:d,type:n}=r,f=()=>{switch(n){case"success":return e.jsx(Ht,{className:"h-5 w-5 text-green-600"});case"error":return e.jsx(Bs,{className:"h-5 w-5 text-red-600"});case"info":default:return e.jsx(Pn,{className:"h-5 w-5 text-blue-600"})}},w=()=>{switch(n){case"success":return"bg-green-50 border-green-200 text-green-900";case"error":return"bg-red-50 border-red-200 text-red-900";case"info":default:return"bg-blue-50 border-blue-200 text-blue-900"}};return e.jsxs("div",{className:`
        pointer-events-auto
        min-w-[300px] max-w-[500px]
        px-4 py-3 rounded-lg border shadow-lg
        flex items-start gap-3
        animate-in slide-in-from-right-full duration-300
        ${w()}
      `,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:f()}),e.jsx("div",{className:"flex-1 text-sm font-medium whitespace-pre-line",children:d}),e.jsx("button",{onClick:()=>i(s),className:"flex-shrink-0 ml-2 p-1 rounded hover:bg-black/5 transition-colors","aria-label":"Close",children:e.jsx(Or,{className:"h-4 w-4"})})]})},at={BASE_URL:"/bt-ctd-echo/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},$o=(r="")=>{if(!r)return{normalized:"",indexMap:[0]};const i=[];let s="",d=0;for(let n=0;n<r.length;n++){const f=r[n];f!=="\r"&&(i[d]=n,s+=f,d++)}return i[d]=r.length,{normalized:s,indexMap:i}},jn=(r="")=>{if(!r)return{};const i=document.createElement("div");i.innerHTML=r;const s={};return i.querySelectorAll("[data-var]").forEach(n=>{const f=n.getAttribute("data-var"),w=n.getAttribute("data-display")||n.textContent||"";f&&w&&(s[f]=w)}),s},Ho=r=>{if(!r)return[];const i=[],s=/<<([^>]+)>>/g;let d=0,n;for(;(n=s.exec(r))!==null;)n.index>d&&i.push({type:"text",value:r.slice(d,n.index)}),i.push({type:"var",name:n[1]}),d=s.lastIndex;return d<r.length&&i.push({type:"text",value:r.slice(d)}),i},Uo=(r,i)=>{if(!i||typeof r!="string")return[];const s=Ho(i);if(!s.length)return[];let d=0;const n=[];for(let f=0;f<s.length;f++){const w=s[f];if(w.type==="text"){if(!w.value)continue;const U=r.indexOf(w.value,d);if(U===-1)return[];d=U+w.value.length}else if(w.type==="var"){const U=(()=>{for(let u=f+1;u<s.length;u++)if(s[u].type==="text"&&s[u].value)return s[u].value;return null})(),v=d;let O;if(U){const u=r.indexOf(U,v);O=u===-1?r.length:u}else O=r.length;O>=v&&(n.push({start:v,end:O,name:w.name}),d=O)}}return n},Nn=(r="",i="",s=[])=>{if(!r||!i||!Array.isArray(s)||!s.length)return{};const{normalized:d,indexMap:n}=$o(r),f=i.replace(/\r/g,""),w=Uo(d,f);if(!w.length)return{};const U=new Set(s),v={};return w.forEach(({start:O,end:u,name:I})=>{if(!U.has(I))return;const c=n[O]??0,W=n[u]??r.length,R=r.substring(c,W).trim();R&&R!==`<<${I}>>`&&(v[I]=R)}),v},$n=(r,i="")=>{if(!(r!=null&&r.variables)||!i)return null;if(r.variables[i])return r.variables[i];const s=i.replace(/_(FR|EN)$/i,"");return r.variables[s]||null},Hn=(r,i="")=>{const s=$n(r,i),d=(i||"").match(/_(FR|EN)$/i),n=d?d[1].toUpperCase():null,f=(()=>{var W,R,se,re;const I=s!=null&&s.example&&typeof s.example=="object"&&(s.example.fr||s.example.en)?s.example:null,c=ce=>I?ce==="EN"?I.en??I.fr??"":I.fr??I.en??"":null;return n==="EN"?((W=s==null?void 0:s.examples)==null?void 0:W.en)??c("EN")??(typeof(s==null?void 0:s.example)=="string"?s.example:"")??"":n==="FR"?((R=s==null?void 0:s.examples)==null?void 0:R.fr)??c("FR")??(typeof(s==null?void 0:s.example)=="string"?s.example:"")??"":((se=s==null?void 0:s.examples)==null?void 0:se.fr)??((re=s==null?void 0:s.examples)==null?void 0:re.en)??c("FR")??(typeof(s==null?void 0:s.example)=="string"?s.example:"")??""})(),w=(i||"").toLowerCase(),U=s!=null&&s.format?s.format:/date|jour|day/.test(w)?"date":/heure|time/.test(w)?"time":/(montant|total|amount|price|cost|refund|credit|deposit|payment)/.test(w)?"currency":/(nombre|count|num|quant)/.test(w)?"number":"text",v=(I="")=>{const c=String(I).trim();return c?/^valeur\s+à\s+d[ée]finir$/i.test(c)?"To be defined":c:""},O=(I,c)=>{const W=String(I||"").trim();if(!W)return c==="date"?"2025-07-15":c==="time"?"09:00":c==="currency"?"$1,250.00":c==="number"?"0":"Example";if(/^https?:\/\//i.test(W)||/@/.test(W))return W;const R=v(W);if(R!==W)return R;if(c==="currency"){const se=W.match(/([0-9][0-9\s\u00A0.,]*)\s*\$/);if(se){const ce=se[1].replace(/\u00A0|\s/g,"").replace(/\.(?=\d{3})/g,"").replace(/,(\d{2})$/,".$1").split(".");return ce[0]=ce[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),`$${ce.join(".")}`}return/^\$?\d{1,3}(,\d{3})*(\.\d{2})?$/.test(W)?W.startsWith("$")?W:`$${W}`:"$1,250.00"}return c==="date"?W:c==="time"?"09:00":W},u=(I,c)=>{const W=String(I||"").trim();return W||(c==="date"?new Date().toISOString().slice(0,10):c==="time"?"09:00":c==="currency"?"2 890,00 $":c==="number"?"0":"…")};if(n==="EN")return O(f,U);if(n==="FR")return u(f,U);if(f)return f;switch(U){case"date":return new Date().toISOString().slice(0,10);case"time":return"09:00";case"currency":return"2 890,00 $";case"number":return"0";default:return"…"}},ir=r=>typeof r=="string"&&r.trim().length>0,Wo=(r={})=>{const i=f=>typeof f=="string"?f:"",s={...r},d=(r==null?void 0:r.description)||{};s.description={fr:i(d.fr),en:i(d.en)};const n=r==null?void 0:r.example;return n&&typeof n=="object"?s.example={fr:i(n.fr),en:i(n.en)}:typeof n=="string"?s.example={fr:n,en:n}:s.example={fr:"",en:""},s.format=(r==null?void 0:r.format)||"text",r!=null&&r.examples&&(s.examples=r.examples),s},Cn=(r={})=>{const i={};return Object.entries(r||{}).forEach(([s,d])=>{i[s]=Wo(d||{})}),i},Ko=(r={},i={})=>{const s={};return new Set([...Object.keys(i||{}),...Object.keys(r||{})]).forEach(n=>{var O,u,I,c,W,R,se,re;const f=r[n],w=i[n];if(!f&&!w)return;const U={format:(f==null?void 0:f.format)||(w==null?void 0:w.format)||"text",description:{fr:ir((O=f==null?void 0:f.description)==null?void 0:O.fr)?f.description.fr:((u=w==null?void 0:w.description)==null?void 0:u.fr)||"",en:ir((I=f==null?void 0:f.description)==null?void 0:I.en)?f.description.en:((c=w==null?void 0:w.description)==null?void 0:c.en)||""},example:{fr:ir((W=f==null?void 0:f.example)==null?void 0:W.fr)?f.example.fr:((R=w==null?void 0:w.example)==null?void 0:R.fr)||"",en:ir((se=f==null?void 0:f.example)==null?void 0:se.en)?f.example.en:((re=w==null?void 0:w.example)==null?void 0:re.en)||""}},v=(f==null?void 0:f.examples)||(w==null?void 0:w.examples);v&&(U.examples=v),s[n]=U}),s},ur=(r={},i=null)=>{const s=Cn((r==null?void 0:r.variables)||{});if(!i)return{...r,variables:s};const d=Cn((i==null?void 0:i.variables)||{}),n={...i||{},...r||{}};return n.metadata={...(i==null?void 0:i.metadata)||{},...(r==null?void 0:r.metadata)||{}},n.templates=Array.isArray(r==null?void 0:r.templates)&&r.templates.length?r.templates:(i==null?void 0:i.templates)||[],n.variables=Ko(s,d),n},Yo=ur(io,null),Vt=(r,i,s)=>{const d={};return!(r!=null&&r.variables)||!Array.isArray(r.variables)||r.variables.forEach(n=>{const f=new Set([n]);Tr.forEach(w=>f.add(`${n}_${w}`)),f.forEach(w=>{if(w===n){const U=$n(i,n);if(U){const v=(s||"fr").toLowerCase();if(U.example&&typeof U.example=="object"){d[w]=U.example[v]??U.example.fr??U.example.en??"";return}if(U.examples&&U.examples[v]){d[w]=U.examples[v];return}}}d[w]=Hn(i,w)})}),d},it=(r={},i={})=>{const s=Object.keys(i||{});if(!s.length)return r;let d=!1;const n={...r};return s.forEach(f=>{const w=(i[f]??"").toString();(n[f]??"")!==w&&(n[f]=w,d=!0)}),d?n:r},Un=(r="")=>r.replace(/[ \t]{2,}/g," ").replace(/\s+([,.;:!?])/g,"$1").replace(/[ \t]+\n/g,`
`).replace(/\n[ \t]+/g,`
`).replace(/\n{3,}/g,`

`),Dr=(r="",i="")=>{if(!r||!i)return null;const s=De(i);if(!s)return null;const d=/<<([^>]+)>>/g;let n;for(;(n=d.exec(r))!==null;)if(De(n[1])===s)return n[0];return null},En=(r="",i="")=>{if(!r||!i)return r;const s=De(i);if(!s)return r;const d=/(\s*)<<([^>]+)>>(\s*)/g,n=r.replace(d,(f,w="",U="",v="")=>{if(De(U)!==s)return f;const O=/\n/.test(w),u=/\n/.test(v);return O&&u?`

`:O||u?`
`:" "});return Un(n)},_n=(r="",i="",s="")=>{if(!i||!s)return r||"";const d=Dr(i,s)||`<<${s}>>`,n=r||"";if(n.includes(d))return n;const f=i.indexOf(d);if(f===-1)return n;const w=i.substring(0,f).split(/<<[^>]+>>/),U=w[w.length-1]||"",O=i.substring(f+d.length).split(/<<[^>]+>>/)[0]||"";let u=n.length;if(O){const D=n.indexOf(O);D!==-1&&(u=D)}if(u===n.length&&U){const D=n.lastIndexOf(U);D!==-1&&(u=D+U.length)}let I=n;u===I.length&&!U&&!O&&I.length>0&&!/\n$/.test(I)&&(I+=`
`,u=I.length);const c=u>0?I[u-1]:"",W=u<I.length?I[u]:"",R=c&&!/[\s([\n]/.test(c),se=W&&!/[\s,.;:!?)/\]]/.test(W);let re=d;R&&(re=` ${re}`),se&&(re=`${re} `);const ce=I.slice(0,u)+re+I.slice(u);return Un(ce)};function Xo(){var Jr;const r=Oo();a.useEffect(()=>{const t=document.createElement("style");return t.textContent=mo,document.head.appendChild(t),()=>document.head.removeChild(t)},[]);const i=a.useMemo(()=>{try{return new URLSearchParams(window.location.search).has("debug")}catch{return!1}},[]),s=a.useMemo(()=>{try{return new URLSearchParams(window.location.search).get("reset")==="1"}catch{return!1}},[]),d=a.useMemo(()=>s?cr():lo(),[s]);a.useEffect(()=>{if(s){uo();try{localStorage.removeItem("ea_last_template_id"),localStorage.removeItem("ea_last_template_lang")}catch{}try{const t=new URL(window.location.href);t.searchParams.delete("reset"),window.history.replaceState(null,"",t.toString())}catch{}}},[s]);const[n,f]=a.useState(null),[w,U]=a.useState(!0),[v,O]=a.useState(d.interfaceLanguage||"fr"),[u,I]=a.useState(d.templateLanguage||"fr"),[c,W]=a.useState(null),[R,se]=a.useState(d.selectedTemplateId||null),[re,ce]=a.useState(d.searchQuery||""),[D,P]=a.useState(d.selectedCategory||"all"),[oe,be]=a.useState(""),[J,he]=a.useState(""),[_,$]=a.useState(d.variables||{}),[ue,ne]=a.useState(()=>{if(typeof d.strictClassic<"u")return!!d.strictClassic;try{return localStorage.getItem("ea_strict_classic")==="1"}catch{return!1}}),T=a.useRef(_),Y=a.useRef(oe),X=a.useRef(J),p=a.useRef(null),y=a.useRef(null),N=a.useRef(c),C=a.useRef(u),L=a.useRef(null),H=a.useRef(!1);a.useEffect(()=>{T.current=_},[_]),a.useEffect(()=>{Y.current=oe},[oe]),a.useEffect(()=>{X.current=J},[J]),a.useEffect(()=>{try{localStorage.setItem("ea_strict_classic",ue?"1":"0")}catch{}},[ue]),a.useEffect(()=>{N.current=c},[c]),a.useEffect(()=>{C.current=u},[u]);const[z,Z]=a.useState(d.favorites||[]),[pe,we]=a.useState(d.favoritesOnly||!1),[de,qe]=a.useState(null),[xe,ye]=a.useState(!1),[We,V]=a.useState(!1),[m,x]=a.useState(!1),[F,K]=a.useState(()=>{try{return localStorage.getItem("ea_prefer_popout")==="true"}catch{return!1}}),[ae,te]=a.useState(()=>{const t=localStorage.getItem("ea_show_highlights");return t===null?!0:t==="true"}),G=a.useMemo(()=>{try{const t=at==null?void 0:at.VITE_SUPPORT_EMAIL;if(typeof t=="string"){const o=t.trim();if(o)return o}}catch{}return"echo-support@jskennedy.net"},[]);a.useMemo(()=>{try{const t=at==null?void 0:at.VITE_SUPPORT_FORM_ENDPOINT;if(typeof t=="string"&&t.trim().length)return t.trim()}catch{}return null},[]);const[je,Oe]=a.useState(()=>{const t=Number(localStorage.getItem("ea_left_width"));return Number.isFinite(t)&&t>=340&&t<=680?t:480});a.useRef(!1);const[Te,Ve]=a.useState(()=>{try{const t=JSON.parse(localStorage.getItem("ea_var_popup_pos_v3")||"null");if(t&&typeof t.top=="number"&&typeof t.left=="number"&&typeof t.width=="number"&&typeof t.height=="number")return t}catch{}return{top:80,left:80,width:470,height:700}}),$e=a.useRef(null),Ae=a.useRef({dragging:!1,startX:0,startY:0,origTop:0,origLeft:0}),[Fe,Je]=a.useState(""),[Ie,Ke]=a.useState(null),dt=a.useRef({}),[mt,Ze]=a.useState(!0),[tt,yt]=a.useState(!1),[Wt,Kn]=a.useState({right:16,bottom:16}),[gr,Yn]=a.useState(()=>{try{return!!(document.fullscreenElement||document.webkitFullscreenElement)}catch{return!1}}),At=a.useRef(null),lt=a.useRef(Math.random().toString(36).slice(2)),Xe=a.useRef(null),rt=a.useRef(Math.random().toString(36).slice(2)),Kt=a.useRef(null),wt=a.useRef(!1),Yt=a.useRef({pending:!1,templateId:null,templateLanguage:null}),gt=a.useRef({subject:!1,body:!1}),br=a.useRef(null),nt=typeof window<"u"&&"BroadcastChannel"in window,ct=a.useCallback(t=>{try{const o=De(t),l=document.querySelectorAll("mark.var-highlight"),g=document.querySelectorAll(".var-pill");l.forEach(h=>{const b=h.getAttribute("data-var"),S=o&&De(b)===o;h.classList.toggle("focused",!!S)}),g.forEach(h=>{const b=h.getAttribute("data-var"),S=o&&De(b)===o;h.classList.toggle("focused",!!S)})}catch(o){console.warn("Failed to update focus highlight",o)}},[]),Xn=a.useCallback(t=>{const o=De(t);o&&requestAnimationFrame(()=>{const l=Array.from(document.querySelectorAll(".var-pill")).find(b=>De(b.getAttribute("data-var"))===o),g=l?null:Array.from(document.querySelectorAll("mark.var-highlight")).find(b=>De(b.getAttribute("data-var"))===o),h=l||g;if(h)try{h.scrollIntoView({block:"center",behavior:"smooth"})}catch{}})},[]),Ft=a.useCallback(t=>{try{const o=De(t),l=document.querySelectorAll("mark.var-highlight"),g=document.querySelectorAll(".var-pill");l.forEach(h=>{const b=h.getAttribute("data-var"),S=o&&De(b)===o;h.classList.toggle("hovered",!!S)}),g.forEach(h=>{const b=h.getAttribute("data-var"),S=o&&De(b)===o;h.classList.toggle("hovered",!!S)})}catch(o){console.warn("Failed to update hover highlight",o)}},[]),jt=a.useRef(null),xr=()=>{var t;Yt.current={pending:!0,templateId:((t=N.current)==null?void 0:t.id)||null,templateLanguage:C.current||null}};a.useEffect(()=>(jt.current&&(clearTimeout(jt.current),jt.current=null),Ie?ct(Ie):jt.current=setTimeout(()=>ct(null),300),()=>{jt.current&&(clearTimeout(jt.current),jt.current=null)}),[Ie,ct]),a.useEffect(()=>{const t=o=>{const{key:l}=o.detail||{};Ke(l||null)};return window.addEventListener("ea-focus-variable",t),()=>window.removeEventListener("ea-focus-variable",t)},[]),a.useEffect(()=>{let t=null;const o=l=>{const g=l.target;if(!g)return;const h=g.closest(".var-pill"),b=g.closest("mark.var-highlight"),S=h||b;if(S){const j=S.getAttribute("data-var");if(j&&j!==t&&(t=j,Ft(j),Xe.current))try{Xe.current.postMessage({type:"variableHovered",varName:j,sender:rt.current})}catch(A){console.error("Failed to send hover update:",A)}}else if(t&&(t=null,Ft(null),Xe.current))try{Xe.current.postMessage({type:"variableHovered",varName:null,sender:rt.current})}catch(j){console.error("Failed to send hover clear:",j)}};return document.addEventListener("mouseover",o,!0),()=>{document.removeEventListener("mouseover",o,!0),t&&Ft(null)}},[Ft]);const $r=a.useCallback(t=>{t&&$(o=>{const l={},g=(C.current||"fr").toUpperCase();Object.entries(t).forEach(([b,S])=>{const j=(S??"").toString();Object.assign(l,et(b,j,{preferredLanguage:g,variables:o}))});const h=it(o,l);return h!==o&&(T.current=h),h})},[]);a.useEffect(()=>{Ie&&requestAnimationFrame(()=>ct(Ie))},[_,ae,Ie,ct]),a.useEffect(()=>{ct(null)},[R,u,ct]);const[Xt,ut]=a.useState(!1),vr=a.useRef(null),St=a.useRef(null),[Hr,yr]=a.useState(null),[Gn,Ur]=a.useState(-1),wr=a.useRef({}),[Qn,Jn]=a.useState(""),Wr=a.useRef(null),[Zn,es]=a.useState(0),[ts,rs]=a.useState(600),[ns,Gt]=a.useState(!1),He=a.useMemo(()=>{try{return new URLSearchParams(window.location.search).get("varsOnly")==="1"}catch{return!1}},[]);a.useEffect(()=>{He&&ye(!0)},[He]),a.useEffect(()=>{if(!He)return;const t=()=>Ve(l=>({...l,top:0,left:0,width:window.innerWidth,height:window.innerHeight}));t();const o=()=>t();return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[He]),a.useEffect(()=>{const t=()=>{Yn(!!(document.fullscreenElement||document.webkitFullscreenElement)),He&&Ve(o=>({...o,top:0,left:0,width:window.innerWidth,height:window.innerHeight}))};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t)}},[He]);const ss=()=>{try{const t=document.documentElement;!!(document.fullscreenElement||document.webkitFullscreenElement)?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}catch{}};a.useEffect(()=>{const t=setTimeout(()=>{co({interfaceLanguage:v,templateLanguage:u,searchQuery:re,selectedCategory:D,selectedTemplateId:R,variables:_,favorites:z,favoritesOnly:pe})},300);return()=>clearTimeout(t)},[v,u,re,D,R,_,z,pe]),a.useEffect(()=>{try{localStorage.setItem("ea_left_width",String(je))}catch{}},[je]),a.useEffect(()=>{try{localStorage.setItem("ea_show_highlights",String(ae))}catch{}},[ae]),a.useEffect(()=>{try{localStorage.setItem("ea_var_popup_pos_v3",JSON.stringify(Te))}catch{}},[Te]),a.useEffect(()=>{try{localStorage.setItem("ea_prefer_popout",String(F))}catch{}},[F]),a.useEffect(()=>{try{R&&localStorage.setItem("ea_last_template_id",R),u&&localStorage.setItem("ea_last_template_lang",u)}catch{}},[R,u]),a.useCallback(()=>{var t,o,l,g,h,b;if(F&&((t=c==null?void 0:c.variables)==null?void 0:t.length)>0){const S=new URL(window.location.href);S.searchParams.set("varsOnly","1"),c!=null&&c.id&&S.searchParams.set("id",c.id),u&&S.searchParams.set("lang",u);const j=((o=c==null?void 0:c.variables)==null?void 0:o.length)||0,A=110,M=60,ee=40;let E=720;const B=Math.ceil(j/2);let k=Math.max(400,Math.min(900,M+B*A+ee));const q=(((l=window.screen)==null?void 0:l.availWidth)||window.innerWidth)-40,Q=(((g=window.screen)==null?void 0:g.availHeight)||window.innerHeight)-80;E=Math.min(E,q),k=Math.min(k,Q);const ie=Math.max(0,Math.floor(((((h=window.screen)==null?void 0:h.availWidth)||window.innerWidth)-E)/2)),me=Math.max(0,Math.floor(((((b=window.screen)==null?void 0:b.availHeight)||window.innerHeight)-k)/3)),fe=`popup=yes,width=${Math.round(E)},height=${Math.round(k)},left=${ie},top=${me},toolbar=0,location=0,menubar=0,status=0,scrollbars=1,resizable=1,alwaysRaised=yes`,ge=window.open("","_blank",fe);if(ge){try{ge.document.write("<!doctype html><title>Loading…</title><style>html,body{height:100%;margin:0;font:14px system-ui, -apple-system, Segoe UI, Roboto, sans-serif;display:grid;place-items:center;color:#6b7280;background:#fff}</style><div>Loading…</div>")}catch{}try{ge.location.replace(S.toString())}catch{try{ge.location.href=S.toString()}catch{}}try{ge.focus()}catch{}}if(ge){if(yt(!1),Ze(!1),ye(!1),nt)try{const Re=new BroadcastChannel("email-assistant-sync");Re.postMessage({type:"popoutOpened",timestamp:Date.now()}),Re.close()}catch{console.log("BroadcastChannel not available for popout sync")}const _e=setInterval(()=>{if(ge.closed&&(clearInterval(_e),nt))try{const Re=new BroadcastChannel("email-assistant-sync");Re.postMessage({type:"popoutClosed",timestamp:Date.now()}),Re.close()}catch{console.log("BroadcastChannel not available for popout close sync")}},1e3)}}else if(ye(!0),nt)try{const S=new BroadcastChannel("email-assistant-sync");S.postMessage({type:"variablesPopupOpened",timestamp:Date.now()}),S.close()}catch{console.log("BroadcastChannel not available for popup sync")}},[F,c,u]),a.useEffect(()=>{if(nt)try{const t=new BroadcastChannel("ea_vars");return At.current=t,t.onmessage=o=>{const l=(o==null?void 0:o.data)||{};if(!l||l.sender===lt.current)return;const g=h=>{var b;if(h!=null&&h.templateLanguage&&(h.templateLanguage==="fr"||h.templateLanguage==="en")&&I(h.templateLanguage),h!=null&&h.templateId)if((b=n==null?void 0:n.templates)!=null&&b.length){const S=n.templates.find(j=>j.id===h.templateId);S&&W(S)}else br.current=h.templateId};l.type==="update"&&(l.variables||l.templateId||l.templateLanguage||l.hasOwnProperty("focusedVar"))?(l.variables&&typeof l.variables=="object"&&(wt.current=!0,$(h=>{const b={...h,...l.variables};return T.current=b,b})),l.hasOwnProperty("focusedVar")&&Ke(l.focusedVar),g(l)):l.type==="request_state"?t.postMessage({type:"state",variables:_,templateId:(c==null?void 0:c.id)||null,templateLanguage:u,focusedVar:Ie,sender:lt.current}):l.type==="state"&&(l.variables&&(wt.current=!0,$(h=>{const b={...h,...l.variables};return T.current=b,b})),l.hasOwnProperty("focusedVar")&&Ke(l.focusedVar),g(l))},He&&setTimeout(()=>{try{t.postMessage({type:"request_state",sender:lt.current})}catch{}},50),()=>{try{t.close()}catch{}}}catch{}},[]),a.useEffect(()=>{if(nt)try{const t=new BroadcastChannel("email-assistant-sync");return Xe.current=t,t.onmessage=o=>{var g,h;const l=o.data;if(!(!l||l.sender===rt.current)){if(l.type==="variableHovered"){Ft(l.varName||null);return}if(l.type==="variableChanged"&&l.allVariables){wt.current=!0,xr();const b={...l.allVariables};T.current=b,$(b);try{Object.entries(b).forEach(([S,j])=>{if(j==="__DELETED__"){const A=S.replace(/_(FR|EN)$/i,"");document.querySelectorAll(".var-pill").forEach(M=>{const ee=M.getAttribute("data-var")||"";(ee===S||ee.replace(/_(FR|EN)$/i,"")===A)&&M.remove()})}})}catch{}return}if(l.type==="variableDeleted"&&l.varName){const{varName:b}=l;wt.current=!0,xr();const S=l.allVariables?{...l.allVariables}:{...T.current,[b]:"__DELETED__"};if(T.current=S,$(S),b){be(j=>{const A=typeof j=="string"?j:Y.current||"",M=En(A,b);return Y.current=M,M}),he(j=>{const A=typeof j=="string"?j:X.current||"",M=En(A,b);return X.current=M,M});try{const j=b.replace(/_(FR|EN)$/i,"");document.querySelectorAll(".var-pill").forEach(A=>{const M=A.getAttribute("data-var")||"";(M===b||M.replace(/_(FR|EN)$/i,"")===j)&&A.remove()})}catch{}}return}if(l.type==="variableRestored"&&l.varName){const{varName:b,value:S=""}=l;wt.current=!0,xr();const j=l.allVariables?{...l.allVariables}:(()=>{const q=et(b,S,{preferredLanguage:(C.current||"fr").toUpperCase(),variables:T.current});return it(T.current,q)})();T.current=j,$(j);const A=N.current,M=C.current||u,ee=((g=A==null?void 0:A.subject)==null?void 0:g[M])||"",E=((h=A==null?void 0:A.body)==null?void 0:h[M])||"";!!Dr(ee,b)&&be(q=>{const Q=typeof q=="string"?q:Y.current||"",ie=_n(Q,ee,b);return Y.current=ie,ie}),!!Dr(E,b)&&he(q=>{const Q=typeof q=="string"?q:X.current||"",ie=_n(Q,E,b);return X.current=ie,ie});return}if(l.type==="focusedVar"){H.current=!0;const b=l.varName??null;Ke(b),ct(b),Xn(b);return}if(l.type==="popoutOpened"||l.type==="popoutReady"){console.log(`🔄 ${l.type==="popoutReady"?"Popout ready":"Popout opened"}, extracting current values from editors...`),setTimeout(()=>{var S;let b=null;try{const j=L.current,A=typeof j=="function"?j():null;A!=null&&A.variables&&(b={...A.variables},console.log("🔄 Extracted variables from editors:",b))}catch(j){console.error("Failed to extract variables while preparing popout snapshot:",j)}!b&&Kt.current&&(b={...Kt.current},console.log("🔄 Using pending snapshot:",b)),b||(b={...T.current},console.log("🔄 Using current variables ref:",b)),Kt.current=null,console.log("🔄 Sending variables to popout:",b);try{t.postMessage({type:"variablesUpdated",variables:b,templateId:((S=N.current)==null?void 0:S.id)||null,templateLanguage:C.current||u,sender:rt.current}),console.log("🔄 Sent variables to popout successfully")}catch(j){console.error("Failed to send variables snapshot to popout:",j)}},60);return}if(l.type==="syncFromText"){console.log("🔄 Received syncFromText request from popout"),setTimeout(()=>{const b=L.current,S=typeof b=="function"?b():{success:!1,updated:!1,variables:{...T.current}};console.log("🔄 Sync result:",S);try{console.log("🔄 Sending sync result back to popout:",S.variables),t.postMessage({type:"syncComplete",success:S.success,updated:S.updated,variables:S.variables,sender:rt.current})}catch(j){console.error("Failed to send sync result:",j)}},50);return}}},()=>{try{t.close()}catch(o){console.error("Error closing BroadcastChannel:",o)}Xe.current=null}}catch(t){console.error("BroadcastChannel not available:",t)}},[]),a.useEffect(()=>{if(!nt)return;if(wt.current){wt.current=!1;return}const t={..._},o=setTimeout(()=>{const l=At.current;if(l)try{l.postMessage({type:"update",variables:t,sender:lt.current})}catch{}},90);return()=>clearTimeout(o)},[_]),a.useEffect(()=>{var h;if(!nt)return;const t=((h=N.current)==null?void 0:h.id)||R||null,o=At.current;if(!o)return;const l={type:"update",templateId:t,templateLanguage:u,sender:lt.current};try{o.postMessage(l)}catch{}const g=Xe.current;if(g)try{g.postMessage({type:"variablesUpdated",variables:{...T.current},templateId:t,templateLanguage:u,sender:rt.current})}catch{}},[R,u]),a.useEffect(()=>{var g;if(!nt)return;const t=Xe.current;if(!t)return;const o=((g=N.current)==null?void 0:g.id)||R||null,l=Yt.current;if(l!=null&&l.pending&&l.templateId===o&&l.templateLanguage===(u||null)){Yt.current={pending:!1,templateId:null,templateLanguage:null};return}Yt.current={pending:!1,templateId:null,templateLanguage:null};try{t.postMessage({type:"variablesUpdated",variables:{..._},templateId:o,templateLanguage:u,sender:rt.current})}catch(h){console.error("Failed to broadcast variables to popout:",h)}},[_,R,u]),a.useEffect(()=>{if(H.current)H.current=!1;else if(nt){const o=At.current;if(o)try{o.postMessage({type:"update",focusedVar:Ie,sender:lt.current})}catch{}const l=Xe.current;if(l)try{l.postMessage({type:"focusedVar",varName:Ie??null,normalizedVar:De(Ie)||null,sender:rt.current})}catch{}}const t=setTimeout(()=>{if(!H.current)try{localStorage.setItem("ea_focused_var",JSON.stringify({focusedVar:Ie,normalizedVar:De(Ie)||null,timestamp:Date.now(),sender:lt.current}))}catch{}},50);return()=>clearTimeout(t)},[Ie]),a.useEffect(()=>{nt&&At.current;const t=setTimeout(()=>{try{localStorage.setItem("ea_show_highlights_sync",JSON.stringify({showHighlights:ae,timestamp:Date.now(),sender:lt.current}))}catch{}},50);return()=>clearTimeout(t)},[ae]),a.useEffect(()=>{const t=o=>{if(o.key==="ea_focused_var"&&o.newValue)try{const l=JSON.parse(o.newValue);l.sender!==lt.current&&Date.now()-l.timestamp<5e3&&Ke(l.focusedVar)}catch{}else if(o.key==="ea_show_highlights_sync"&&o.newValue)try{const l=JSON.parse(o.newValue);l.sender!==lt.current&&Date.now()-l.timestamp<5e3&&te(l.showHighlights)}catch{}};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[]),a.useEffect(()=>{var l;const t=br.current;if(!t||!((l=n==null?void 0:n.templates)!=null&&l.length))return;const o=n.templates.find(g=>g.id===t);o&&W(o),br.current=null},[n]),a.useEffect(()=>{if(!xe||tt)return;const t=setTimeout(()=>{var o;try{if(!c||!c.variables||c.variables.length===0)return;const l=c.variables.find(h=>!(_[h]||"").trim())||c.variables[0],g=dt.current[l];g&&typeof g.focus=="function"&&(g.focus(),(o=g.select)==null||o.call(g))}catch{}},0);return()=>clearTimeout(t)},[xe,tt]),a.useEffect(()=>{if(!xe||mt||tt)return;const t=o=>{$e.current&&($e.current.contains(o.target)||yt(!0))};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[xe,mt,tt]);const Kr=t=>{var S;if(!t||!c)return;const o=String(t).split(/\r?\n/),l={},g=(j="")=>j.normalize("NFD").replace(new RegExp("\\p{Diacritic}+","gu"),"").toLowerCase().trim(),h=c.variables,b={};for(const j of h){const A=(S=n==null?void 0:n.variables)==null?void 0:S[j],M=[j];if(A!=null&&A.description){const ee=A.description.fr||"",E=A.description.en||"";M.push(ee,E)}b[j]=M.map(g).filter(Boolean)}for(const j of o){const A=j.match(/^\s*([^:=]+?)\s*[:=-]\s*(.+)\s*$/);if(!A)continue;const M=g(A[1]),ee=A[2];let E=null;for(const B of h)if(b[B].some(k=>M.includes(k)||k.includes(M))){E=B;break}E||(E=h.find(B=>g(B)===M)),E&&(l[E]=ee)}if(Object.keys(l).length){$(M=>{const ee={},E=(C.current||"fr").toUpperCase();Object.entries(l).forEach(([k,q])=>{Object.assign(ee,et(k,q,{preferredLanguage:E,variables:M}))});const B=it(M,ee);return B!==M&&(T.current=B),B});const j=Object.keys(l)[0],A=dt.current[j];A&&A.focus()}};a.useEffect(()=>{if(!Xt)return;const t=l=>{vr.current&&!vr.current.contains(l.target)&&ut(!1)},o=l=>{l.key==="Escape"&&ut(!1)};return document.addEventListener("mousedown",t),document.addEventListener("keydown",o),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",o)}},[Xt]);const Ne=or[v],Yr=()=>v==="fr"?"Sélectionnez un modèle":"Select a template";a.useEffect(()=>{c||(Y.current="",X.current="",be(""),he(""))},[v]),a.useEffect(()=>{const t=()=>{try{const g=localStorage.getItem("ea_admin_templates_data");if(g){const h=JSON.parse(g);if(h&&typeof h=="object"&&Array.isArray(h.templates)&&h.templates.length)return i&&console.log("[EA][Debug] Using locally published admin templates dataset"),h}}catch(g){i&&console.warn("[EA][Debug] local admin dataset parse failed",g)}return null},o=async()=>{i&&console.log("[EA][Debug] Fetching templates (prefer raw main data)...");const g=(at==null?void 0:at.VITE_TEMPLATES_URL)||"https://raw.githubusercontent.com/snarky1980/bt-ctd-echo/main/complete_email_templates.json",h="https://raw.githubusercontent.com/snarky1980/bt-ctd-echo/gh-pages/complete_email_templates.json",b="./complete_email_templates.json",S=typeof import.meta<"u"&&at?"/bt-ctd-echo/":"/",j=(S.endsWith("/")?S:S+"/")+"complete_email_templates.json",A=Date.now(),M=k=>k+(k.includes("?")?"&":"?")+"cb="+A,ee=[M(g),M(h),M(j),M(b)];let E=null,B=null;for(const k of ee)try{i&&console.log("[EA][Debug] Try fetch",k);const q=await fetch(k,{cache:"no-cache"});if(!q.ok)throw new Error("HTTP "+q.status);E=await q.json();break}catch(q){B=q,i&&console.warn("[EA][Debug] fetch candidate failed",k,(q==null?void 0:q.message)||q)}if(!E)throw B||new Error("No template source reachable");return E};(async()=>{var b;const g=Yo,h=t();if(h){f(ur(h,g)),U(!1);try{const S=await o();S&&(f(j=>ur(j||g,S)),i&&console.log("[EA][Debug] Admin dataset merged with fallback metadata"))}catch(S){i&&console.warn("[EA][Debug] Fallback template fetch failed",S)}return}f(g);try{const S=await o();S&&(f(ur(S,g)),i&&console.log("[EA][Debug] Templates loaded:",(b=S==null?void 0:S.templates)==null?void 0:b.length))}catch(S){console.error("Error loading templates data:",S)}finally{U(!1)}})()},[i]);const Mt=a.useRef(null);a.useEffect(()=>{var l;if(!n)return;Mt.current||(Mt.current=((l=n==null?void 0:n.metadata)==null?void 0:l.updatedAt)||null);const o=setInterval(async()=>{var g;try{const h=typeof import.meta<"u"&&at?"/bt-ctd-echo/":"/",b=(h.endsWith("/")?h:h+"/")+"complete_email_templates.json?t="+Date.now(),S=await fetch(b,{cache:"no-store"});if(!S.ok)return;const j=await S.json(),A=((g=j==null?void 0:j.metadata)==null?void 0:g.updatedAt)||null;if(A&&A!==Mt.current){console.log("[EA] Template update detected, reloading...",{old:Mt.current,new:A}),Mt.current=A;const M=(c==null?void 0:c.id)||null;if(f(j),M){const ee=j.templates.find(E=>E.id===M);ee?(W(ee),jr.current=null):(W(null),console.log("[EA] Selected template was deleted"))}}}catch(h){i&&console.warn("[EA][Debug] Update check failed:",h)}},3e4);return()=>clearInterval(o)},[n,c,i]),a.useEffect(()=>{var o;if(!w||c||!((o=n==null?void 0:n.templates)!=null&&o.length))return;if(!R){i&&console.log("[EA][Debug] Template load complete without saved selection; awaiting user pick");return}const t=n.templates.find(l=>l.id===R);if(!t){i&&console.warn("[EA][Debug] Saved template id not found in catalog:",R);return}W(t),i&&console.log("[EA][Debug] Auto-selected restored template:",t.id)},[w,n,c,R,i]),a.useEffect(()=>{if(!n)return;const t=new URLSearchParams(window.location.search),o=t.get("id"),l=t.get("lang");if(l&&["fr","en"].includes(l)&&(I(l),O(l)),o){const g=n.templates.find(h=>h.id===o);g&&W(g)}},[n]);const jr=a.useRef(null);a.useEffect(()=>{if(!c||!n||jr.current===c.id)return;jr.current=c.id;const t=Vt(c,n,u);T.current=t,$(t),i&&console.log("[EA][Debug] Rebuilt variables for template:",c.id,"vars:",Object.keys(t).slice(0,5)),setTimeout(()=>{try{const o=Xe.current;o&&(o.postMessage({type:"variablesUpdated",variables:t,templateId:c.id,templateLanguage:C.current||u,sender:rt.current}),i&&console.log("[EA][Debug] Notified popout of new template variables via BroadcastChannel"))}catch(o){i&&console.error("Failed to notify popout:",o)}},100)},[c,n,u,i]),a.useEffect(()=>{const t=o=>{if((o.ctrlKey||o.metaKey)&&!o.shiftKey&&o.key==="Enter"){o.preventDefault(),c&&Dt("all");return}if((o.ctrlKey||o.metaKey)&&o.key==="j"&&(o.preventDefault(),c&&Dt("subject")),(o.ctrlKey||o.metaKey)&&o.shiftKey&&o.key==="Enter"&&(o.preventDefault(),c&&Qr()),(o.ctrlKey||o.metaKey)&&o.key==="/"&&(o.preventDefault(),St.current&&St.current.focus()),xe&&c){if(o.key==="Escape"&&(o.preventDefault(),yt(!0)),(o.ctrlKey||o.metaKey)&&o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),ye(!1)),(o.ctrlKey||o.metaKey)&&o.key==="r"&&(o.preventDefault(),n)){const l=Vt(c,n,u);$(g=>{const h=it(g,l);return h!==g&&(T.current=h),h})}(o.ctrlKey||o.metaKey)&&o.shiftKey&&o.key==="v"&&(o.preventDefault(),(navigator.clipboard&&navigator.clipboard.readText?navigator.clipboard.readText():Promise.resolve("")).then(g=>Kr(g||"")))}};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[c,xe,n,_,Kr]);const{filteredTemplates:st,searchMatchMap:Nr}=a.useMemo(()=>{var en,tn,rn,nn;const t={filteredTemplates:[],searchMatchMap:{}};if(!n)return t;let o=n.templates;const l=(re||"").trim(),g=l.length>0;if(!g&&(D!=="all"&&(o=o.filter(le=>le.category===D)),pe)){const le=new Set(z);o=o.filter(Ee=>le.has(Ee.id))}if(!l)return{filteredTemplates:o,searchMatchMap:{}};const b=(le=>{const Ee=[];let ve="",Pe=!1;for(let Me=0;Me<le.length;Me++){const ke=le[Me];if(ke==='"'){Pe=!Pe,!Pe&&ve&&(Ee.push(ve),ve="");continue}if(!Pe&&/\s/.test(ke)){ve&&(Ee.push(ve),ve="");continue}ve+=ke}return ve&&Ee.push(ve),Ee.map(Me=>{const ke=Me.trim(),ze=ke.toUpperCase();return ze==="AND"||ze==="ET"||ze==="&&"?"AND":ze==="OR"||ze==="OU"||ze==="||"||ze==="|"?"OR":ke})})(l),S=b.some(le=>le==="AND"||le==="OR")||/"/.test(l),j=[];let A=[];const M=()=>{A.length&&(j.push(A),A=[])};for(const le of b)le==="OR"?M():le==="AND"||A.push(le);M();const ee=le=>{if(!g)return le;const Ee=new Set(z),ve=le.filter(Me=>Ee.has(Me.id)),Pe=le.filter(Me=>!Ee.has(Me.id));return[...ve,...Pe]},E=le=>{var Ee,ve,Pe,Me;return xt([((Ee=le.title)==null?void 0:Ee.fr)||"",((ve=le.title)==null?void 0:ve.en)||"",((Pe=le.description)==null?void 0:Pe.fr)||"",((Me=le.description)==null?void 0:Me.en)||"",le.category||""].join(" "))},B=(le,Ee)=>{const ve=E(le);return Ee.every(Pe=>{const Me=pn(Pe).split(/\s+/).filter(Boolean);return Me.length?Me.some(ke=>ve.includes(ke)):!0})};let k=o;if(S&&j.length&&(k=o.filter(le=>j.some(Ee=>B(le,Ee)))),!k.length)return{filteredTemplates:[],searchMatchMap:{}};const q=(le="",Ee="")=>{const ve=[];if(!Ee)return ve;const Pe=xt(Ee),Me=Pe.length;if(!Me)return ve;for(let ke=0;ke+Me<=le.length;ke++){const ze=le.substr(ke,Me);xt(ze)===Pe&&ve.push([ke,ke+Me-1])}return ve},Q=(le,Ee)=>{const ve=[],Pe={},Me=[["title.fr",ke=>{var ze;return((ze=ke.title)==null?void 0:ze.fr)||""}],["title.en",ke=>{var ze;return((ze=ke.title)==null?void 0:ze.en)||""}],["description.fr",ke=>{var ze;return((ze=ke.description)==null?void 0:ze.fr)||""}],["description.en",ke=>{var ze;return((ze=ke.description)==null?void 0:ze.en)||""}],["category",ke=>ke.category||""]];for(const ke of le){const ze={};let zt=0;for(const[nr,us]of Me){const ds=String(us(ke)),sr=[];for(const Et of Ee){const bt=q(ds,Et);bt.length&&sr.push(...bt)}if(sr.length){sr.sort((bt,kt)=>bt[0]-kt[0]);const Et=[];for(const bt of sr){const kt=Et[Et.length-1];!kt||bt[0]>kt[1]+1?Et.push(bt):kt[1]=Math.max(kt[1],bt[1])}ze[nr]=Et,zt+=Et.length}}zt>0&&(ve.push({item:ke,hits:zt}),Pe[ke.id]=ze)}return ve.sort((ke,ze)=>ze.hits-ke.hits),{items:ve.map(ke=>ke.item),matchMap:Pe}},ie=b.filter(le=>le!=="AND"&&le!=="OR").map(le=>le.trim()).filter(Boolean);if(ie.length){const{items:le,matchMap:Ee}=Q(k,ie);if(le.length)return{filteredTemplates:ee(le),searchMatchMap:Ee}}const me=pn(l),fe=Array.from(new Set(me.split(/\s+/).filter(Boolean)));if(fe.length){const{items:le,matchMap:Ee}=Q(k,fe);if(le.length)return{filteredTemplates:ee(le),searchMatchMap:Ee}}const ge=(ie.length?Math.min(...ie.map(le=>le.length)):l.length)||1;let _e=.32;ge<=2?_e=.1:ge===3?_e=.18:ge===4?_e=.22:ge===5?_e=.28:_e=.32;const Re=new $s(k,{includeScore:!0,includeMatches:!0,shouldSort:!1,threshold:_e,ignoreLocation:!0,minMatchCharLength:2,keys:[{name:"title.fr",weight:.45},{name:"title.en",weight:.45},{name:"description.fr",weight:.3},{name:"description.en",weight:.3},{name:"category",weight:.2}]}),Le=ie.length?ie:fe;if(Le.length===0)return{filteredTemplates:k,searchMatchMap:{}};const Se=new Map,Ue=(le,Ee)=>{if(Array.isArray(Ee))for(const ve of Ee){if(!(ve!=null&&ve.key)||!Array.isArray(ve==null?void 0:ve.indices))continue;const Pe=ve.key;le[Pe]||(le[Pe]=[]),le[Pe].push(...ve.indices)}};for(const le of Le){const Ee=Re.search(le);for(const ve of Ee){const Pe=ve.item.id,Me=Se.get(Pe);Me?(Me.score=Math.min(Me.score,ve.score??Me.score),Ue(Me.matches,ve.matches)):(Se.set(Pe,{item:ve.item,score:ve.score??0,matches:{}}),Ue(Se.get(Pe).matches,ve.matches))}}if(Se.size===0){const le=xt(l),Ee=[],ve={};for(const Pe of k){const Me=[["title.fr",((en=Pe.title)==null?void 0:en.fr)||""],["title.en",((tn=Pe.title)==null?void 0:tn.en)||""],["description.fr",((rn=Pe.description)==null?void 0:rn.fr)||""],["description.en",((nn=Pe.description)==null?void 0:nn.en)||""],["category",Pe.category||""]];let ke=!1;const ze={};for(const[zt,nr]of Me)xt(nr).includes(le)&&(ke=!0,ze[zt]=q(String(nr),l));ke&&(Ee.push({item:Pe,score:1}),ve[Pe.id]=ze)}return Ee.length===0?{filteredTemplates:[],searchMatchMap:{}}:{filteredTemplates:ee(Ee.map(Pe=>Pe.item)),searchMatchMap:ve}}const Ye=Array.from(Se.values()).sort((le,Ee)=>(le.score??1)-(Ee.score??1)),Er=Ye.map(le=>le.item),Zr={};for(const le of Ye){const Ee=le.item.id;Zr[Ee]=le.matches}return{filteredTemplates:ee(Er),searchMatchMap:Zr}},[n,re,D,pe,z]),Qt=(t,o)=>Nr&&Nr[t]&&Nr[t][o]||null,Jt=(t="",o)=>{if(!o||!o.length)return t;const l=[];let g=0;for(const[h,b]of o)h>g&&l.push(t.slice(g,h)),l.push(e.jsx("mark",{className:"search-hit",children:t.slice(h,b+1)},`${h}-${b}`)),g=b+1;return g<t.length&&l.push(t.slice(g)),e.jsx(e.Fragment,{children:l})},Xr=a.useMemo(()=>{var o;if(!n)return{};const t={...((o=n.metadata)==null?void 0:o.categoryLabels)||{}};return(n.templates||[]).forEach(l=>{const g=l==null?void 0:l.category;g&&(t[g]||(t[g]={fr:"",en:""}),l.category_fr&&!t[g].fr&&(t[g].fr=l.category_fr),l.category_en&&!t[g].en&&(t[g].en=l.category_en))}),t},[n]),Zt=a.useMemo(()=>{var o;if(!n)return[];const t=(o=n==null?void 0:n.metadata)==null?void 0:o.categories;return Array.isArray(t)&&t.length?t:[...new Set((n.templates||[]).map(l=>l.category).filter(Boolean))]},[n]),pt=a.useCallback(t=>{var g,h;if(!t)return v==="fr"?"Autre":"Other";const o=Xr[t];if(o){const b=v==="fr"?o.fr:o.en;if(b&&b.trim().length>0)return b;const S=v==="fr"?o.en:o.fr;if(S&&S.trim().length>0)return S}const l=((h=(g=or==null?void 0:or[v])==null?void 0:g.categories)==null?void 0:h[t])||t;return i&&!o&&console.log(`Category label not found for: ${t}, using fallback: ${l}`),l},[Xr,v,i]),er=t=>z.includes(t),Cr=t=>{Z(o=>o.includes(t)?o.filter(l=>l!==t):[...o,t])},Gr=a.useMemo(()=>!Zt||!Zt.length?[]:[...Zt].sort((t,o)=>{const l=pt(t)||t,g=pt(o)||o;return l.localeCompare(g,v==="fr"?"fr":"en",{sensitivity:"base"})}),[Zt,pt,v]),Nt=a.useCallback((t,o)=>{if(!t)return"";const l=o||T.current||{},g=C.current||u||"fr";return String(t??"").replace(/<<([^>]+)>>/g,(h,b)=>{const S=qt(l,b,g);if(S==="__DELETED__")return"";if(S&&S.trim().length)return S;const j=l[b];if(j!=null){const A=String(j);if(A==="__DELETED__")return"";if(A.trim().length)return A}return h})},[u]),Pt=(t,o,l="")=>{if(!t)return{html:"",text:l||""};const g=(k="")=>{const q=String(k??"");return q.trim()?/[<>&]/.test(q)&&/<\/?[a-z]/i.test(q)?q:String(q).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\r\n|\r/g,`
`).replace(/\n/g,"<br>"):""},h=document.createElement("div");h.innerHTML=g(t);const b=k=>{k.querySelectorAll("*").forEach(q=>{if(["BR","HR"].includes(q.tagName))return;const Q=window.getComputedStyle(q);let ie="";const me=Q.fontSize;me&&me!=="16px"&&me!=="14px"&&(ie+=`font-size: ${me}; `);const fe=Q.color,ge=fe.replace(/\s/g,"");fe&&ge!=="rgb(0,0,0)"&&ge!=="rgba(0,0,0,1)"&&(ie+=`color: ${fe}; `);const _e=Q.backgroundColor,Re=_e.replace(/\s/g,"");_e&&Re!=="rgba(0,0,0,0)"&&Re!=="transparent"&&Re!=="rgb(255,255,255)"&&Re!=="rgba(255,255,255,1)"&&(ie+=`background-color: ${_e}; `);const Le=Q.fontWeight;Le&&(Le==="bold"||parseInt(Le)>=700)&&(ie+="font-weight: bold; "),Q.fontStyle==="italic"&&(ie+="font-style: italic; ");const Ue=Q.textDecoration;Ue&&!Ue.includes("none")&&(ie+=`text-decoration: ${Ue}; `);const Ye=Q.fontFamily;Ye&&Ye!=="Arial"&&!Ye.startsWith("-apple-system")&&(ie+=`font-family: ${Ye}; `),ie&&q.setAttribute("style",ie.trim())}),k.querySelectorAll("ul, ol").forEach(q=>{const Q=q.getAttribute("style")||"";q.setAttribute("style",Q+" margin: 0; padding-left: 40px;")}),k.querySelectorAll("li").forEach(q=>{const Q=q.getAttribute("style")||"";q.setAttribute("style",Q+" margin: 0; padding: 0;")})};b(h),h.querySelectorAll("br[data-line-break]").forEach(k=>{k.removeAttribute("data-line-break")});const S=(k="")=>{try{if(typeof CSS<"u"&&typeof CSS.escape=="function")return CSS.escape(k)}catch{}return String(k).replace(/[^a-zA-Z0-9_-]/g,"\\$&")},j=(k="")=>{const q=String(k??"");return/<[a-z][\s\S]*>/i.test(q)?q.replace(/\r\n|\r/g,`
`).replace(/\n/g,"<br>"):q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\r\n|\r/g,`
`).replace(/\n/g,"<br>")},A=k=>{var Q;if(!k||k.nodeType!==Node.ELEMENT_NODE)return;(Q=k.classList)==null||Q.remove("var-pill","filled","empty","focused"),k.classList&&k.classList.length===0&&k.removeAttribute("class"),["data-var","data-value","data-display","data-template","contenteditable","spellcheck"].forEach(ie=>k.removeAttribute(ie)),Array.from(k.children||[]).forEach(A)},M=(k,q="")=>{if(k.innerHTML="",!q)return;const Q=document.createRange().createContextualFragment(q);k.appendChild(Q)},ee="__RT_PILL_VALUE__";Object.entries(o||{}).forEach(([k,q])=>{h.querySelectorAll(`[data-var="${S(k)}"]`).forEach(ie=>{var Le;const me=q!=null&&String(q).length?String(q):`<<${k}>>`,fe=`<<${k}>>`,ge=ie.cloneNode(!1),_e=Se=>{M(ge,Se),A(ge),ie.replaceWith(ge)},Re=ie.getAttribute("data-template")||((Le=ie.dataset)==null?void 0:Le.template);if(Re&&me!==fe){const Se=j(me),Ue=Re.replace(ee,Se);_e(Ue)}else ie.innerHTML&&me!==fe?_e(ie.innerHTML):(ge.textContent=me,A(ge),ie.replaceWith(ge))})}),b(h);const E=h.innerHTML;if(l)return{html:E,text:l};const B=h.innerText.replace(/\r\n/g,`
`);return{html:E,text:B}},tr=a.useCallback(()=>{if(console.log("🔄 Sync from text: Starting reverse synchronization..."),console.log("🔄 Current state:",{selectedTemplate:c==null?void 0:c.id,templateLanguage:u,finalSubject:(oe==null?void 0:oe.substring(0,100))+"...",finalBody:(J==null?void 0:J.substring(0,100))+"...",currentVariables:_}),!c||!n)return console.log("🔄 No template selected or templates data unavailable"),{success:!1,updated:!1,variables:{..._}};const t={},o=jn(oe),l=jn(J);console.log("🔄 Values extracted from pills:",{subject:o,body:l}),Object.assign(t,l,o);const g=c.subject[u]||"",h=c.body[u]||"";console.log("🔄 Templates:",{subjectTemplate:(g==null?void 0:g.substring(0,100))+"...",bodyTemplate:(h==null?void 0:h.substring(0,100))+"..."});const b=(E="")=>E?Array.from(E.matchAll(/<<([^>]+)>>/g),B=>B[1]):[],S=new Set([...b(g),...b(h)]);if(S.size>0){const E=Array.from(S).filter(B=>!t.hasOwnProperty(B));if(E.length>0&&g&&oe){const B=Nn(oe,g,E);Object.assign(t,B)}if(E.length>0&&h&&J){const B=E.filter(k=>!t.hasOwnProperty(k));if(B.length){const k=Nn(J,h,B);Object.assign(t,k)}}}console.log("🔄 Final extracted values:",t);const j={},A=(u||C.current||"fr").toUpperCase();Object.entries(t).forEach(([E,B])=>{Object.assign(j,et(E,B,{preferredLanguage:A,variables:_}))});const M=it(_,j),ee=M!==_;return ee?(console.log("🔄 Variables updated successfully, returning:",M),T.current=M,$(M)):(console.log("🔄 No new values extracted; sending current variables snapshot"),T.current=M),{success:!0,updated:ee,variables:M}},[c,n,u,oe,J,_]);a.useEffect(()=>{L.current=tr},[tr]),a.useEffect(()=>{if(c){const t=Vt(c,n,u);console.log("🔄 Template loaded, initializing variables (with samples if empty):",t);const o=c.subject[u]||"",l=c.body[u]||"";T.current=t,$(t),Y.current=o,X.current=l,be(o),he(l),gt.current={subject:!1,body:!1},console.log("🔄 Variables state and ref updated with initial/sample values")}else T.current={},Y.current="",X.current="",$({}),be(""),he(""),gt.current={subject:!1,body:!1}},[c,u,v,n]),a.useEffect(()=>{if(!c)return;const t=Array.isArray(c.variables)?c.variables:[];t.length&&$(o=>{if(!o)return o;let l=o,g=!1;for(const h of t){const b=(o[h]||"").trim();if(!b)continue;const S=`${h}_EN`,j=`${h}_FR`,A=(o[S]||"").trim(),M=(o[j]||"").trim();A||(l===o&&(l={...o}),l[S]=b,g=!0),M||(l===o&&(l={...o}),l[j]=b,g=!0)}return g?(T.current=l,l):o})},[c,u]),a.useEffect(()=>{if(!c||!gt.current.subject&&!gt.current.body)return;const t=setTimeout(()=>{console.log("🔄 Detected manual text edits, attempting automatic reverse sync...");const o=tr();o.success&&o.updated?console.log("🔄 Auto reverse sync extracted new values; manual edit flags reset"):o.success?console.log("🔄 Auto reverse sync completed without new values; manual edit flags reset"):console.log("🔄 Auto reverse sync skipped (template unavailable); manual edit flags reset"),gt.current={subject:!1,body:!1}},220);return()=>clearTimeout(t)},[c,u,oe,J,tr]);const Dt=async(t="all")=>{var k,q,Q,ie;console.log("📋 copyToClipboard called with type:",t);let o="",l="";const g=(me="")=>String(me??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\r\n|\r/g,`
`).replace(/\n/g,"<br>"),h=T.current||_||{},b=Y.current??oe,S=X.current??J,j=Nt(b,h),A=Nt(S,h),M=((q=(k=p.current)==null?void 0:k.getHtml)==null?void 0:q.call(k))??S,ee=((ie=(Q=y.current)==null?void 0:Q.getHtml)==null?void 0:ie.call(Q))??g(j),E=Pt(M,h,A),B=Pt(ee,h,j);switch(t){case"subject":o=B.html||g(j),l=j;break;case"body":o=`<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0;">
<div style="font-family: Arial, sans-serif; font-size: 14px; line-height: 1.6; color: #000000;">
${E.html}
</div>
</body>
</html>`,l=E.text;break;case"all":default:o=`<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0;">
<div style="font-family: Arial, sans-serif; font-size: 14px; line-height: 1.6; color: #000000;">
<div><strong>Subject:</strong> ${B.html||g(j)}</div>
<br>
<div>${E.html}</div>
</div>
</body>
</html>`,l=`${j}

${E.text}`;break}try{if(navigator.clipboard&&window.isSecureContext){const me=new ClipboardItem({"text/html":new Blob([o],{type:"text/html"}),"text/plain":new Blob([l],{type:"text/plain"})});await navigator.clipboard.write([me])}else{const me=document.createElement("div");me.innerHTML=o,me.style.position="fixed",me.style.left="-999999px",me.style.top="-999999px",document.body.appendChild(me);const fe=document.createRange();fe.selectNodeContents(me);const ge=window.getSelection();ge.removeAllRanges(),ge.addRange(fe),document.execCommand("copy"),ge.removeAllRanges(),document.body.removeChild(me)}qe(t),setTimeout(()=>qe(null),2e3)}catch(me){console.error("Copy error:",me);try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l);else{const fe=document.createElement("textarea");fe.value=l,fe.style.position="fixed",fe.style.left="-999999px",fe.style.top="-999999px",document.body.appendChild(fe),fe.focus(),fe.select(),document.execCommand("copy"),fe.remove()}qe(t),setTimeout(()=>qe(null),2e3)}catch(fe){console.error("All copy methods failed:",fe),alert("Copy failed. Please select the text manually and use Ctrl+C.")}}},os=async()=>{if(!c)return;const o=`${window.location.origin+window.location.pathname}?id=${c.id}&lang=${u}`;try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(o);else{const l=document.createElement("textarea");l.value=o,l.style.position="fixed",l.style.left="-999999px",l.style.top="-999999px",document.body.appendChild(l),l.focus(),l.select(),document.execCommand("copy"),l.remove()}qe("link"),setTimeout(()=>qe(null),2e3)}catch(l){console.error("Link copy error:",l),alert("Link copy error. Please copy the URL manually from the address bar.")}},Ct=async t=>{var E,B,k,q;const o=(Q="")=>String(Q??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\r\n|\r/g,`
`).replace(/\n/g,"<br>"),l=T.current||_||{},g=Y.current??oe,h=X.current??J,b=Nt(g,l),S=Nt(h,l),j=((B=(E=p.current)==null?void 0:E.getHtml)==null?void 0:B.call(E))??h,A=((q=(k=y.current)==null?void 0:k.getHtml)==null?void 0:q.call(k))??o(b),M=Pt(j,l,S),ee=Pt(A,l,b);if(t==="eml"){const Q="----=_NextPart_000_0000_01DA1234.56789ABC",ie=M.html||"",me=[`Subject: ${b}`,"MIME-Version: 1.0",`Content-Type: multipart/alternative; boundary="${Q}"`,"",`--${Q}`,"Content-Type: text/plain; charset=UTF-8","Content-Transfer-Encoding: quoted-printable","",M.text||"","",`--${Q}`,"Content-Type: text/html; charset=UTF-8","Content-Transfer-Encoding: quoted-printable","","<!DOCTYPE html>","<html>","<head>",'<meta charset="UTF-8">','<meta name="viewport" content="width=device-width, initial-scale=1.0">',"</head>",'<body style="margin: 0; padding: 0;">',ie,"</body>","</html>","",`--${Q}--`].join(`\r
`),fe=new Blob([me],{type:"message/rfc822"}),ge=URL.createObjectURL(fe),_e=document.createElement("a");_e.href=ge,_e.download=`${(b||"email").replace(/[^a-z0-9]/gi,"_")}.eml`,_e.click(),URL.revokeObjectURL(ge);return}if(t==="html"){const Q=`<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>${b||"Document"}</title>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 800px;
  margin: 2em auto;
  padding: 2em;
  line-height: 1.6;
}
h1 {
  color: #2c3d50;
  border-bottom: 2px solid #2c3d50;
  padding-bottom: 0.5em;
}
</style>
</head>
<body>
<h1>${ee.html||b||"Untitled"}</h1>
${M.html}
</body>
</html>`,ie=new Blob([Q],{type:"text/html;charset=utf-8"}),me=URL.createObjectURL(ie),fe=document.createElement("a");fe.href=me,fe.download=`${b||"email"}.html`,fe.click(),URL.revokeObjectURL(me);return}if(t==="copy-html"){try{if(navigator.clipboard&&navigator.clipboard.write){const Q="text/html",ie=new Blob([M.html],{type:Q}),me=new ClipboardItem({[Q]:ie});await navigator.clipboard.write([me])}else await navigator.clipboard.writeText(M.html);qe(!0),setTimeout(()=>qe(!1),1500)}catch(Q){console.error("Copy HTML failed",Q),alert("Copy HTML failed. Please try again or use the HTML export option.")}return}if(t==="word"){const Q=M.html||"",ie=`
<!DOCTYPE html>
<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
<head>
<meta charset='utf-8'>
<title>${b||"Document"}</title>
<!--[if gte mso 9]>
<xml>
<w:WordDocument>
<w:View>Print</w:View>
<w:Zoom>100</w:Zoom>
<w:DoNotOptimizeForBrowser/>
</w:WordDocument>
</xml>
<![endif]-->
<style>
body {
  font-family: 'Calibri', 'Arial', sans-serif;
  font-size: 11pt;
  line-height: 1.5;
  margin: 1in;
}
h1 {
  font-size: 16pt;
  font-weight: bold;
  margin-bottom: 12pt;
  color: #2c3d50;
  border-bottom: 2px solid #2c3d50;
  padding-bottom: 8pt;
}
p {
  margin: 0 0 10pt 0;
}
/* Preserve all rich text formatting */
strong, b { font-weight: bold !important; }
em, i { font-style: italic !important; }
u { text-decoration: underline !important; }
s, strike { text-decoration: line-through !important; }
ul, ol { margin: 10pt 0; padding-left: 40pt; }
li { margin: 5pt 0; }
/* Ensure inline styles are preserved */
[style*="background-color"] { background-color: inherit !important; }
[style*="color"] { color: inherit !important; }
[style*="font-weight"] { font-weight: inherit !important; }
[style*="font-style"] { font-style: inherit !important; }
[style*="text-decoration"] { text-decoration: inherit !important; }
[style*="font-size"] { font-size: inherit !important; }
</style>
</head>
<body>
<h1>${b||"Untitled"}</h1>
${Q}
</body>
</html>`.trim(),me=new Blob([ie],{type:"application/msword"}),fe=URL.createObjectURL(me),ge=`${(b||"document").replace(/[^a-z0-9]/gi,"_")}.doc`,_e=document.createElement("a");_e.href=fe,_e.download=ge,_e.target="_blank",document.body.appendChild(_e),_e.click(),document.body.removeChild(_e),setTimeout(()=>{u==="fr"?r.success(`📄 Fichier téléchargé: ${ge}

Ouvrez le fichier depuis vos Téléchargements pour l'ouvrir dans Word.`,5e3):r.success(`📄 File downloaded: ${ge}

Open the file from your Downloads folder to launch it in Word.`,5e3),URL.revokeObjectURL(fe)},500);return}if(t==="docx"){const Q=M.html||"",ie=`MIME-Version: 1.0
Content-Type: multipart/related; boundary="----=_NextPart_000_0000"

------=_NextPart_000_0000
Content-Type: text/html; charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Location: file:///C:/document.html

<!DOCTYPE html>
<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'>
<head>
<meta charset='utf-8'>
<title>${(b||"Document").replace(/"/g,"&quot;")}</title>
<style>
body {
  font-family: 'Calibri', 'Arial', sans-serif;
  font-size: 11pt;
  line-height: 1.5;
  margin: 1in;
}
h1 {
  font-size: 16pt;
  font-weight: bold;
  margin-bottom: 12pt;
  color: #2c3d50;
  border-bottom: 2px solid #2c3d50;
  padding-bottom: 8pt;
}
p {
  margin: 0 0 10pt 0;
}
/* Ensure inline styles are preserved */
[style*="background-color"] { background-color: inherit !important; }
[style*="color"] { color: inherit !important; }
[style*="font-weight"] { font-weight: inherit !important; }
[style*="font-style"] { font-style: inherit !important; }
[style*="text-decoration"] { text-decoration: inherit !important; }
[style*="font-size"] { font-size: inherit !important; }
</style>
</head>
<body>
<h1>${b||"Untitled"}</h1>
${Q}
</body>
</html>

------=_NextPart_000_0000--`,me=new Blob([ie],{type:"application/msword"}),fe=URL.createObjectURL(me),ge=document.createElement("a");ge.href=fe,ge.download=`${(b||"document").replace(/[^a-z0-9]/gi,"_")}.doc`,ge.click(),URL.revokeObjectURL(fe);return}if(t==="pdf"){const Q=window.open("","_blank");if(!Q){alert("Please allow pop-ups to export as PDF");return}const ie=M.html||"",me=`
<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>${b||"Document"}</title>
<style>
@media print {
  @page {
    margin: 1in;
    size: letter;
  }
  body {
    margin: 0;
    padding: 0;
  }
}
body {
  font-family: 'Calibri', 'Arial', sans-serif;
  font-size: 11pt;
  line-height: 1.6;
  color: #000;
  max-width: 8.5in;
  margin: 0 auto;
  padding: 1in;
}
h1 {
  font-size: 18pt;
  font-weight: bold;
  margin-bottom: 16pt;
  color: #2c3d50;
  border-bottom: 2px solid #2c3d50;
  padding-bottom: 8pt;
}
p {
  margin: 0 0 12pt 0;
}
/* Preserve ALL rich text formatting including highlights */
strong, b { font-weight: bold !important; }
em, i { font-style: italic !important; }
u { text-decoration: underline !important; }
s, strike { text-decoration: line-through !important; }
ul, ol { margin: 10pt 0; padding-left: 40pt; }
li { margin: 5pt 0; }
/* Critical: Ensure inline styles (colors, highlights) are preserved in print */
* {
  -webkit-print-color-adjust: exact !important;
  print-color-adjust: exact !important;
  color-adjust: exact !important;
}
/* Ensure all inline background colors print */
[style*="background-color"],
[style*="background"],
span[style],
mark[style] {
  -webkit-print-color-adjust: exact !important;
  print-color-adjust: exact !important;
}
</style>
</head>
<body>
<h1>${b||"Untitled Document"}</h1>
${ie}
<script>
  window.onload = function() {
    window.print();
    // Close window after printing (or canceling)
    setTimeout(function() {
      window.close();
    }, 100);
  };
<\/script>
</body>
</html>`.trim();Q.document.write(me),Q.document.close();return}if(t==="copy-text"){try{const Q=`${b?b+`

`:""}${M.text}`;await navigator.clipboard.writeText(Q),qe(!0),setTimeout(()=>qe(!1),1500)}catch(Q){console.error("Copy text failed",Q),alert("Copy failed. Please try again.")}return}},as=t=>{if(!$e.current)return;t.preventDefault();const{clientX:o,clientY:l}=t;Ae.current={dragging:!0,startX:o,startY:l,origTop:Te.top,origLeft:Te.left};const g=b=>{if(!Ae.current.dragging)return;const S=b.clientX-Ae.current.startX,j=b.clientY-Ae.current.startY;let A=Ae.current.origTop+j,M=Ae.current.origLeft+S;const ee=12,E=Q=>Math.round(Q/ee)*ee;A=E(A),M=E(M);const B=16,k=window.innerWidth-(Te.width||600),q=window.innerHeight-(Te.height||400);Math.abs(M-0)<=B&&(M=0),Math.abs(A-0)<=B&&(A=0),Math.abs(M-k)<=B&&(M=Math.max(0,k)),Math.abs(A-q)<=B&&(A=Math.max(0,q)),A=Math.max(0,Math.min(q,A)),M=Math.max(0,Math.min(k,M)),Ve(Q=>({...Q,top:A,left:M}))},h=()=>{Ae.current.dragging=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",h)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",h)},[is,rr]=a.useState(!1),ls=()=>{rr(!0)},cs=()=>{var g,h;if(!c||!(n!=null&&n.variables)){rr(!1);return}const t=Vt(c,n,u);T.current=t,$(t);const o=((g=c.subject)==null?void 0:g[u])||"",l=((h=c.body)==null?void 0:h[u])||"";Y.current=o,X.current=l,be(o),he(l),gt.current={subject:!1,body:!1},Ke(null),rr(!1)},Qr=a.useCallback(()=>{var fe,ge,_e;console.log("📧 composePlainTextEmailDraft called");const t=T.current||_||{},o=Y.current??oe,l=X.current??J,g=Nt(o,t)||"",h=((ge=(fe=p.current)==null?void 0:fe.getHtml)==null?void 0:ge.call(fe))??l,b=Nt(l,t)||"",j=(Pt(h,t,b).text||b||"").replace(/\r?\n/g,`\r
`),A=encodeURIComponent(g),M=encodeURIComponent(j),ee=1800;let E=M,B=`mailto:?subject=${A}&body=${E}`;const k=B.length;let q=null;if(k>ee){q=v==="fr"?"Le corps complet a été copié dans le presse-papiers. Ouvrez Outlook puis faites simplement Coller.":"The full email body was copied to your clipboard. Open Outlook and just paste it in.";const Re=()=>{let Se;try{Se=document.createElement("textarea"),Se.value=j,Se.style.position="fixed",Se.style.opacity="0",document.body.appendChild(Se),Se.focus({preventScroll:!0}),Se.select();const Ue=document.execCommand("copy");if(console.log("📧 Copied plain body via execCommand",Ue),!Ue){const Ye=v==="fr"?"Impossible de copier automatiquement le texte. Utilisez le brouillon .eml si nécessaire.":"Could not copy the text automatically. Use the .eml draft if needed.";r.error(Ye,6e3)}}catch(Ue){console.warn("📧 execCommand copy failed:",Ue)}finally{Se&&Se.parentNode&&Se.parentNode.removeChild(Se)}};(_e=navigator.clipboard)!=null&&_e.writeText?navigator.clipboard.writeText(j).then(()=>console.log("📧 Copied plain body via navigator.clipboard")).catch(Se=>{console.warn("📧 navigator.clipboard copy failed:",Se),Re()}):Re(),E=encodeURIComponent(v==="fr"?"Le texte complet est copié dans votre presse-papiers. Collez-le dans Outlook.":"The full text is copied to your clipboard. Paste it in Outlook."),B=`mailto:?subject=${A}&body=${E}`,console.log("📧 mailto length exceeded limit, using clipboard assist. Original length:",k),q&&r.info(q,5e3)}const Q=Re=>{console.log("📧 Fallback .eml download:",Re);const Le=`Subject: ${g}\r
Content-Type: text/plain; charset=UTF-8\r
\r
${j}`,Se=new Blob([Le],{type:"message/rfc822"}),Ue=URL.createObjectURL(Se),Ye=document.createElement("a");Ye.href=Ue,Ye.download=`email-draft-${Date.now()}.eml`,document.body.appendChild(Ye),Ye.click(),document.body.removeChild(Ye),URL.revokeObjectURL(Ue);const Er=v==="fr"?"Aucun client courriel détecté. Brouillon .eml téléchargé.":"No email client detected. Downloaded a .eml draft instead.";r.info(Er)},ie=()=>{if(typeof navigator<"u"&&typeof navigator.msLaunchUri=="function")return navigator.msLaunchUri(B,()=>console.log("📧 msLaunchUri success"),Le=>{console.warn("📧 msLaunchUri failed:",Le),Q("msLaunchUri fail")}),!0;const Re=[()=>{const Le=document.createElement("a");Le.href=B,Le.style.display="none",document.body.appendChild(Le),console.log("📧 anchor click attempt, href length:",Le.href.length),Le.click(),document.body.removeChild(Le)},()=>{window.location.assign(B)},()=>{window.location.href=B},()=>{window.open(B,"_self")},()=>{window.open(B,"_blank","noopener,noreferrer")}];for(const[Le,Se]of Re.entries())try{return Se(),console.log("📧 mailto launch attempt succeeded (index):",Le),!0}catch(Ue){console.warn("📧 mailto launch attempt failed:",Ue)}return!1};if(console.log("📧 mailtoUrl:",B),console.log("📧 mailto length check: original",k,"final",B.length),!ie()){Q("all launch attempts failed");return}if(!q){const Re=v==="fr"?"Ouverture de votre client courriel...":"Opening your email client...";r.info(Re,2500)}setTimeout(()=>{if(!document.hidden&&document.hasFocus()){const Re=v==="fr"?"Outlook ne semble pas s'ouvrir. Voulez-vous télécharger un brouillon .eml à la place?":"Outlook did not appear to open. Would you like to download an .eml draft instead?";window.confirm(Re)?(console.log("📧 user confirmed fallback; downloading .eml"),Q("user requested fallback after failed launch perception")):console.log("📧 user chose not to download fallback; leaving as-is")}},1800)},[v,r,_,oe,J,Nt,Pt]);return e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(to bottom right, #f8fafc, #fefbe8, #e0f2fe)"},children:[i&&e.jsxs("div",{style:{position:"fixed",bottom:8,left:8,background:"#1e293b",color:"#fff",padding:"8px 12px",borderRadius:8,fontSize:12,zIndex:9999,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{fontWeight:600},children:"Debug"}),e.jsxs("div",{children:["loading: ",String(w)]}),e.jsxs("div",{children:["templates: ",((Jr=n==null?void 0:n.templates)==null?void 0:Jr.length)||0]}),e.jsxs("div",{children:["selected: ",(c==null?void 0:c.id)||"none"]}),e.jsxs("div",{children:["vars: ",Object.keys(_||{}).length]})]}),w?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4",style:{borderColor:"rgba(44, 61, 80, 0.9)"}}),e.jsx("p",{className:"text-gray-600",children:"Chargement des modèles..."})]})}):!He&&e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"w-full mx-auto max-w-none page-wrap relative z-50 sticky top-0 border-b",style:{backgroundColor:"#ffffff",borderColor:"var(--tb-sage)",maxHeight:"120px",overflow:"hidden",paddingTop:"0.125in",paddingBottom:"0px"},children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden","aria-hidden":"true",children:[e.jsx("div",{className:"banner-pill",style:{top:"-48px",left:"-220px",width:"420px",height:"140px",background:"#2c3d50",opacity:.82,borderRadius:"160px"}}),e.jsx("div",{className:"banner-pill",style:{top:"-23px",left:"720px",width:"340px",height:"115px",background:"#aca868",opacity:.4,borderRadius:"150px"}}),e.jsx("div",{className:"banner-pill",style:{top:"-83px",left:"1140px",width:"680px",height:"125px",background:"#426388",opacity:.3,borderRadius:"160px"}}),e.jsx("div",{className:"banner-pill",style:{top:"58px",left:"-200px",width:"380px",height:"110px",background:"#aca868",opacity:.3,borderRadius:"140px"}}),e.jsx("div",{className:"banner-pill",style:{top:"65px",left:"780px",width:"720px",height:"185px",background:"#aca868",opacity:.15,borderRadius:"200px"}}),e.jsx("div",{className:"banner-pill",style:{top:"85px",left:"1636px",width:"520px",height:"75px",background:"#2c3d50",opacity:.82,borderRadius:"130px"}}),e.jsx("div",{className:"hpill-line",style:{left:"472px",top:"40px",height:"3px",width:"528px",background:"#2c3d50",opacity:.7},children:e.jsx("span",{className:"hpill-dot",style:{top:"50%",left:"30%",transform:"translate(-50%, -50%)",width:"18px",height:"18px",background:"#ffffff",borderRadius:"9999px",boxShadow:"0 0 0 4px #aca868",position:"absolute"}})}),e.jsx("div",{className:"hpill-line",style:{left:"1530px",top:"-54px",height:"176px",width:"2px",background:"#2c3d50",opacity:.5},children:e.jsx("span",{className:"hpill-dot",style:{top:"52%",left:"50%",transform:"translate(-50%, -50%)",width:"36px",height:"36px",background:"#ffffff",borderRadius:"9999px",boxShadow:"0 0 0 4px #8a7530",position:"absolute"}})})]}),e.jsxs("div",{className:"flex items-start justify-between relative",children:[e.jsxs("div",{className:"flex items-center space-x-6",style:{marginLeft:"3in"},children:[e.jsx("div",{className:"relative",style:{width:"270px",height:"135px",marginTop:"-0.185in",marginBottom:"2px",marginLeft:"-100px"},children:e.jsx("img",{src:po,alt:"ECHO",style:{width:"100%",height:"100%",objectFit:"contain"}})}),e.jsx("div",{className:"flex flex-col justify-center",style:{marginLeft:"-60px",marginTop:"19px"},children:e.jsx("p",{className:"font-semibold",style:{color:"rgba(44, 61, 80, 0.9)",fontSize:"100%",maxWidth:"22rem"},children:Ne.subtitle})})]}),e.jsx("div",{className:"flex flex-col items-end",style:{marginTop:"8px"},children:e.jsx("div",{className:"flex w-full max-w-sm flex-col gap-3 px-4 py-4 shadow-xl",style:{backgroundColor:"var(--primary)",borderRadius:"calc(var(--radius) + 8px)"},children:e.jsxs("div",{className:"flex items-center justify-between gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Sr,{className:"h-8 w-8 text-white"}),e.jsx("span",{className:"font-bold text-base text-white mr-[5px]",children:Ne.interfaceLanguage})]}),e.jsxs("div",{className:"flex bg-white p-1 shadow-lg",style:{borderRadius:"14px"},children:[e.jsx("button",{onClick:()=>O("fr"),className:`px-3 py-1.5 text-sm font-bold transition-all duration-300 transform ${v==="fr"?"shadow-xl scale-105":""}`,style:v==="fr"?{backgroundColor:"#2c3d50",color:"white",borderRadius:"calc(var(--radius) + 4px)"}:{backgroundColor:"transparent",borderRadius:"calc(var(--radius) + 4px)",color:"#6b7280"},children:"FR"}),e.jsx("button",{onClick:()=>O("en"),className:`px-3 py-1.5 text-sm font-bold transition-all duration-300 transform ${v==="en"?"shadow-xl scale-105":"hover:scale-105"}`,style:v==="en"?{backgroundColor:"#2c3d50",color:"white",borderRadius:"calc(var(--radius) + 4px)"}:{backgroundColor:"transparent",borderRadius:"calc(var(--radius) + 4px)",color:"#6b7280"},children:"EN"})]})]})})})]})]}),e.jsxs(Ce,{onClick:()=>{var t,o,l,g;try{const h=new URL(window.location.href);h.searchParams.set("helpOnly","1"),h.searchParams.set("lang",v),h.searchParams.set("category","template"),h.searchParams.set("support",G);const b=Math.min(900,(((t=window.screen)==null?void 0:t.availWidth)||window.innerWidth)-80),S=Math.min(700,(((o=window.screen)==null?void 0:o.availHeight)||window.innerHeight)-120),j=Math.max(0,Math.floor(((((l=window.screen)==null?void 0:l.availWidth)||window.innerWidth)-b)/2)),A=Math.max(0,Math.floor(((((g=window.screen)==null?void 0:g.availHeight)||window.innerHeight)-S)/3)),M=`popup=yes,width=${Math.round(b)},height=${Math.round(S)},left=${j},top=${A},toolbar=0,location=0,menubar=0,status=0,scrollbars=1,resizable=1,noopener=1`,ee=window.open(h.toString(),"_blank",M);ee&&ee.focus&&ee.focus()}catch{}},variant:"outline",className:"fixed bottom-4 right-[120px] z-40 inline-flex items-center gap-2 rounded-lg border-2 bg-white px-4 py-3 text-sm font-semibold tracking-wide shadow-lg transition-all",style:{borderColor:"rgba(44, 61, 80, 0.5)",color:"#2c3d50"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(44, 61, 80, 0.9)",t.currentTarget.style.color="white"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="white",t.currentTarget.style.color="#2c3d50"},title:v==="fr"?"Soumettre un modèle":"Submit a template",children:[e.jsx(Rt,{className:"h-5 w-5"}),e.jsx("span",{children:v==="fr"?"Soumettre un modèle":"Submit a template"})]}),e.jsxs(Ce,{onClick:()=>{var t,o,l,g;try{const h=new URL(window.location.href);h.searchParams.set("helpOnly","1"),h.searchParams.set("lang",v),h.searchParams.set("support",G);const b=560,S=620,j=(((t=window.screen)==null?void 0:t.availWidth)||window.innerWidth)-40,A=(((o=window.screen)==null?void 0:o.availHeight)||window.innerHeight)-40,M=Math.min(b,j),ee=Math.min(S,A),E=Math.max(0,Math.floor(((((l=window.screen)==null?void 0:l.availWidth)||window.innerWidth)-M)/2)),B=Math.max(0,Math.floor(((((g=window.screen)==null?void 0:g.availHeight)||window.innerHeight)-ee)/3)),k=`popup=yes,width=${Math.round(M)},height=${Math.round(ee)},left=${E},top=${B},toolbar=0,location=0,menubar=0,status=0,scrollbars=1,resizable=1,noopener=1`,q=window.open(h.toString(),"_blank",k);q&&q.focus&&q.focus()}catch{}},variant:"outline",className:"fixed bottom-4 right-4 z-40 inline-flex items-center gap-2 rounded-lg border-2 bg-white px-4 py-3 text-sm font-semibold tracking-wide shadow-lg transition-all",style:{borderColor:"rgba(44, 61, 80, 0.5)",color:"#2c3d50"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="rgba(44, 61, 80, 0.9)",t.currentTarget.style.color="white"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="white",t.currentTarget.style.color="#2c3d50"},title:v==="fr"?"Ouvrir le centre d'aide":"Open help centre",children:[e.jsxs("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("text",{x:"12",y:"16",fontSize:"12",fill:"currentColor",stroke:"none",textAnchor:"middle",fontWeight:"bold",children:"?"})]}),e.jsx("span",{children:v==="fr"?"Aide":"Help"})]}),e.jsxs("main",{className:"w-full max-w-none px-3 sm:px-4 lg:px-6 py-5 pb-24",children:[!w&&(!n||!Array.isArray(n.templates)||n.templates.length===0)&&e.jsxs("div",{className:"mb-6 p-4 rounded-lg border-2 border-amber-300 bg-amber-50 text-amber-900 shadow-sm",children:[e.jsx("div",{className:"font-semibold mb-1",children:v==="fr"?"Aucun modèle chargé":"No templates loaded"}),e.jsxs("div",{className:"text-sm",children:[v==="fr"?"Le fichier complete_email_templates.json n'a pas été trouvé ou n'a pas pu être chargé. Le bouton d'envoi s'affiche uniquement quand un modèle est sélectionné.":"The complete_email_templates.json file was not found or could not be loaded. The Send button only shows when a template is selected.",e.jsx("div",{className:"mt-2",children:e.jsx("a",{className:"underline text-amber-800",href:"./complete_email_templates.json",target:"_blank",rel:"noreferrer",children:"complete_email_templates.json"})}),e.jsx("div",{className:"mt-1 text-xs text-amber-800/80",children:v==="fr"?"Astuce: ajoutez ?debug=1 à l’URL pour voir les compteurs. Vérifiez la console réseau (F12) pour les erreurs 404/CORS.":"Tip: add ?debug=1 to the URL to see counters. Check the Network console (F12) for 404/CORS errors."})]})]}),e.jsxs("div",{className:"flex gap-4 items-stretch w-full",children:[e.jsx("div",{className:"md:hidden mb-3 w-full flex justify-start",children:e.jsxs(Ce,{variant:"outline",className:"font-semibold border-2",style:{borderColor:"#2c3d50",borderRadius:12},onClick:()=>{Gt(!0),setTimeout(()=>{var t;return(t=St.current)==null?void 0:t.focus()},0)},children:[e.jsx(Rt,{className:"h-4 w-4 mr-2 text-[#2c3d50]"}),"Templates"]})}),e.jsx("div",{className:"hidden md:block shrink-0",style:{width:je},children:e.jsx(ht,{className:"h-fit card-soft border-0 overflow-hidden rounded-[14px]",style:{background:"#ffffff",height:"100vh",display:"flex",flexDirection:"column"},children:e.jsxs(vt,{className:"p-0 flex flex-col h-full",style:{padding:0},children:[e.jsxs("div",{className:"flex-shrink-0 px-0 pt-0 pb-2 bg-white",children:[e.jsx("div",{className:"w-full px-4 flex items-center justify-center mb-3",style:{background:"var(--primary)",paddingTop:10,paddingBottom:10,minHeight:48,borderTopLeftRadius:14,borderTopRightRadius:14,borderBottomLeftRadius:0,borderBottomRightRadius:0},children:e.jsxs("div",{className:"text-2xl font-bold text-white inline-flex items-center gap-2 leading-none whitespace-nowrap",children:[e.jsx(Rt,{className:"h-6 w-6 text-white","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:v==="fr"?"Modèles":"Templates"})]})}),e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[st.length," ",Ne.templatesCount]}),e.jsxs("button",{onClick:()=>{we(t=>{const o=!t;return Jn(o?`${Ne.favorites} (${z.length||0})`:Ne.favorites),o})},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.currentTarget.click())},className:`px-3 py-1 text-sm font-bold rounded-md transition-all duration-200 border ${pe?"bg-[#aca868]/20 text-[#2c3d50] border-[#aca868]":"bg-white text-[#2c3d50] border-[#2c3d50]"} flex items-center gap-2`,title:Ne.showFavoritesOnly,"aria-pressed":pe,"aria-live":"polite",children:[e.jsx("span",{className:`text-xl transition-all duration-150 ${pe?"text-[#8a8535] scale-110":"text-gray-200 scale-100"}`,children:"★"}),pe?`${Ne.favorites} (${z.length||0})`:Ne.favorites,e.jsx("span",{style:{position:"absolute",left:"-9999px",height:0,width:0,overflow:"hidden"},"aria-live":"polite",children:Qn})]})]}),e.jsx("div",{className:"mt-2 px-4",children:e.jsxs(wn,{value:D,onValueChange:P,children:[e.jsxs(Fr,{className:"w-full h-12 border rounded-md !bg-[#b5af70] !border-[#2c3d50] text-white font-semibold tracking-wide shadow-sm",style:{color:"white",fontSize:D==="all"?"1rem":"0.875rem"},children:[e.jsx(cn,{className:"h-4 w-4 mr-2 text-white"}),e.jsx("span",{children:D==="all"?Ne.allCategories:pt(D)})]}),e.jsxs(Mr,{className:"bg-white border border-[#2c3d50] rounded-[14px] shadow-xl text-[#2c3d50]",children:[e.jsx($t,{value:"all",className:"font-semibold",style:{fontSize:"1rem"},children:Ne.allCategories}),Gr.filter(t=>typeof t=="string"&&t.trim().length>0).map(t=>e.jsx($t,{value:t,children:pt(t)},t))]})]})}),e.jsxs("div",{className:"relative group mt-2 px-4",children:[e.jsx(un,{className:"absolute top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground pointer-events-none",style:{left:34}}),e.jsx(Ge,{ref:St,id:"template-search-main",name:"template-search-main",type:"text",autoComplete:"off",placeholder:Ne.searchPlaceholder,value:re,onChange:t=>ce(t.target.value),className:"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex w-full min-w-0 rounded-[14px] bg-white px-3 py-1 text-base shadow-xs outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm h-12 pl-12 pr-12 border",style:{borderColor:"#2c3d50",backgroundColor:"#ffffff"}}),re&&e.jsx("button",{onClick:()=>ce(""),className:"absolute top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground hover:text-foreground transition-colors flex items-center justify-center",style:{right:"31px"},title:"Clear search",children:e.jsx("svg",{className:"h-3.5 w-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"w-full mt-3 px-4 flex items-center justify-between gap-0.5",style:{background:"var(--primary)",paddingTop:10,paddingBottom:10,minHeight:48,borderRadius:"4px"},children:[e.jsxs("div",{className:"text-base font-bold text-white inline-flex items-center gap-2 leading-none whitespace-nowrap",children:[e.jsx(Hs,{className:"h-5 w-5 text-white"}),e.jsx("span",{className:"truncate mr-[5px]",children:Ne.templateLanguage})]}),e.jsxs("div",{className:"flex bg-white rounded-lg p-1 shadow-sm",children:[e.jsx("button",{onClick:()=>I("fr"),className:`px-3 py-1 text-sm font-bold rounded-md transition-all duration-300 button-ripple teal-focus ${u==="fr"?"text-white":"text-gray-600"}`,style:u==="fr"?{background:"#2c3d50"}:{},children:"FR"}),e.jsx("button",{onClick:()=>I("en"),className:`px-3 py-1 text-sm font-bold rounded-md transition-all duration-300 button-ripple teal-focus ${u==="en"?"text-white":"text-gray-600"}`,style:u==="en"?{background:"#2c3d50"}:{},children:"EN"})]})]})]}),e.jsxs(Br,{className:"flex-1 rounded-b-[14px] overflow-y-auto bg-white",style:{"--scrollbar-width":"20px",overscrollBehavior:"contain",touchAction:"pan-y"},viewportRef:Wr,onViewportScroll:()=>{const t=Wr.current;t&&(t._scrollTimeout||(t._scrollTimeout=setTimeout(()=>{es(t.scrollTop),rs(t.clientHeight),t._scrollTimeout=null},16)))},children:[(()=>{const o=st.length,l=Math.max(0,Math.floor(Zn/104)-3),g=Math.ceil((ts||600)/104)+6,h=Math.min(o,l+g),b=l*104,S=(o-h)*104;return e.jsxs("div",{className:"p-3 bg-white",style:{minHeight:(o+1)*104},children:[e.jsx("div",{style:{height:b}}),e.jsx("div",{className:"space-y-3",children:st.slice(l,h).map(j=>{var ee;const A=mn(j.category,((ee=n==null?void 0:n.metadata)==null?void 0:ee.categoryColors)||{}),M=pt(j.category);return e.jsx("div",{ref:E=>{E&&(wr.current[j.id]=E)},onClick:()=>{W(j),se(j.id)},onMouseDown:()=>yr(j.id),onMouseUp:()=>yr(null),onMouseLeave:()=>yr(null),className:`w-full p-4 border cursor-pointer transition-all duration-150 ${(c==null?void 0:c.id)===j.id?"shadow-lg transform scale-[1.02]":"border-[#e1eaf2] bg-white hover:border-[#2c3d50] hover:shadow-md hover:-translate-y-[1px]"}`,style:(c==null?void 0:c.id)===j.id?{borderColor:"#2c3d50",background:"#e6f0ff",borderRadius:"14px",scrollMarginTop:220}:{borderRadius:"14px",transform:Hr===j.id?"scale(0.995)":void 0,boxShadow:Hr===j.id?"inset 0 0 0 1px rgba(0,0,0,0.05)":void 0,scrollMarginTop:220},children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h3",{className:"font-bold text-gray-900 text-[13px]",title:j.title[u],children:Jt(j.title[u],Qt(j.id,`title.${u}`))})}),e.jsx("p",{className:"text-[12px] text-gray-600 mb-2 leading-relaxed line-clamp-2",title:j.description[u],children:Jt(j.description[u],Qt(j.id,`description.${u}`))}),e.jsx(yn,{variant:"outline",className:"text-[11px] font-semibold px-3 py-1 border rounded-full shadow-sm",style:{background:A.bg,color:A.text,borderColor:A.border},children:M})]}),e.jsx("button",{onClick:E=>{E.stopPropagation(),Cr(j.id)},className:`ml-3 text-xl transition-colors ${er(j.id)?"text-[#8a8535]":"text-gray-200 hover:text-[#8a8535]"}`,title:er(j.id)?"Unfavorite":"Favorite","aria-label":"Toggle favorite",children:"★"})]})},j.id)})}),e.jsx("div",{style:{height:S}})]})})(),e.jsx("div",{className:"sr-only",tabIndex:0,onKeyDown:t=>{var g,h,b,S;if(!st.length)return;if(t.key==="/"){t.preventDefault(),(g=St.current)==null||g.focus();return}if(t.key==="Escape"){re&&ce("");return}const o=st.length-1;let l=Gn;if(l<0&&(l=c?Math.max(0,st.findIndex(j=>j.id===c.id)):0),t.key==="ArrowDown"){t.preventDefault(),l=Math.min(o,l+1),Ur(l),(h=wr.current[st[l].id])==null||h.scrollIntoView({block:"nearest"});return}if(t.key==="ArrowUp"){t.preventDefault(),l=Math.max(0,l-1),Ur(l),(b=wr.current[st[l].id])==null||b.scrollIntoView({block:"nearest"});return}if(t.key.toLowerCase()==="f"){t.preventDefault();const j=(S=st[l])==null?void 0:S.id;j&&Cr(j);return}if(t.key==="Enter"){t.preventDefault();const j=st[l];j&&W(j);return}}})]})]})})}),ns&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>Gt(!1)}),e.jsxs("div",{className:"absolute left-0 top-0 h-full w-[88vw] bg-white shadow-2xl border-r border-gray-200 p-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-2",children:[e.jsxs("div",{className:"font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(Rt,{className:"h-5 w-5"}),"Templates"]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700",onClick:()=>Gt(!1),children:"✕"})]}),e.jsx("div",{className:"h-[80vh] overflow-y-auto pr-1",children:e.jsxs("div",{className:"pr-2",children:[e.jsx("div",{className:"h-[48px] w-full rounded-[14px] px-4 flex items-center justify-center mb-2",style:{background:"var(--primary)"},children:e.jsxs("div",{className:"text-base font-bold text-white inline-flex items-center gap-2 leading-none whitespace-nowrap",children:[e.jsx(Rt,{className:"h-5 w-5 text-white","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:v==="fr"?"Modèles":"Templates"})]})}),e.jsx("div",{className:"mt-2",children:e.jsxs(wn,{value:D,onValueChange:P,children:[e.jsxs(Fr,{className:`w-full h-12 border transition-all duration-200 rounded-md ${D==="all"?"font-semibold":""}`,style:{background:"#b5af70",borderColor:"#b5af70",color:"white",fontSize:D==="all"?"1rem":"0.875rem"},children:[e.jsx(cn,{className:"h-4 w-4 mr-2 text-white"}),e.jsx("span",{children:D==="all"?Ne.allCategories:pt(D)})]}),e.jsxs(Mr,{children:[e.jsx($t,{value:"all",className:"font-semibold",style:{fontSize:"1rem"},children:Ne.allCategories}),Gr.filter(t=>typeof t=="string"&&t.trim().length>0).map(t=>e.jsx($t,{value:t,children:pt(t)},t))]})]})}),e.jsxs("div",{className:"relative group mt-2",children:[e.jsx(un,{className:"absolute top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground pointer-events-none",style:{left:14}}),e.jsx(Ge,{ref:St,id:"template-search-mobile",name:"template-search-mobile",type:"text",placeholder:Ne.searchPlaceholder,value:re,onChange:t=>ce(t.target.value),className:"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex w-full min-w-0 rounded-[14px] bg-transparent px-3 py-1 text-base shadow-xs outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm h-12 pl-12 pr-10 border",style:{borderColor:"#aca868"}})]}),e.jsx("div",{className:"mt-3 space-y-3",children:st.slice(0,80).map(t=>{var g;const o=mn(t.category,((g=n==null?void 0:n.metadata)==null?void 0:g.categoryColors)||{}),l=pt(t.category);return e.jsx("div",{onClick:()=>{W(t),Gt(!1)},className:"w-full p-4 border border-[#e1eaf2] bg-white rounded-[14px]",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-[13px] mb-1",title:t.title[u],children:Jt(t.title[u],Qt(t.id,`title.${u}`))}),e.jsx("p",{className:"text-[12px] text-gray-600 mb-2 leading-relaxed line-clamp-2",title:t.description[u],children:Jt(t.description[u],Qt(t.id,`description.${u}`))}),e.jsx(yn,{variant:"outline",className:"text-[11px] font-semibold px-3 py-1 border rounded-full shadow-sm",style:{background:o.bg,color:o.text,borderColor:o.border},children:l})]}),e.jsx("button",{onClick:h=>{h.stopPropagation(),Cr(t.id)},className:`ml-3 text-xl ${er(t.id)?"text-[#8a8535]":"text-gray-200 hover:text-[#8a8535]"}`,title:er(t.id)?"Unfavorite":"Favorite","aria-label":"Toggle favorite",children:"★"})]})},t.id)})})]})})]})]}),e.jsx("div",{className:"flex-1 min-w-[600px] space-y-5",children:c?e.jsxs(e.Fragment,{children:[e.jsxs(ht,{className:"card-soft border-0 overflow-hidden rounded-[14px]",style:{background:"#ffffff"},children:[e.jsx(fr,{style:{background:"var(--primary)",paddingTop:10,paddingBottom:10,minHeight:48,boxShadow:"none",borderBottom:"none",borderTopLeftRadius:14,borderTopRightRadius:14,borderBottomLeftRadius:0,borderBottomRightRadius:0},children:e.jsxs(hr,{className:"text-2xl font-bold text-white flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(kr,{className:"h-6 w-6 mr-3 text-white"}),Ne.editEmail]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[c&&c.variables&&c.variables.length>0&&e.jsx(e.Fragment,{children:e.jsxs(Ce,{onClick:()=>{var me,fe,ge,_e,Re;let t=null;try{const Le=L.current;if(typeof Le=="function"){const Se=Le();Se!=null&&Se.variables&&(t={...Se.variables})}}catch(Le){console.error("Failed to extract variables before opening popout:",Le)}t||(t={...T.current}),Kt.current=t;try{localStorage.setItem("ea_pending_popout_snapshot",JSON.stringify({variables:t,templateId:(c==null?void 0:c.id)||null,templateLanguage:u,timestamp:Date.now()}))}catch(Le){console.warn("Unable to persist pending popout snapshot:",Le)}const o=new URL(window.location.href);o.searchParams.set("varsOnly","1"),c!=null&&c.id&&o.searchParams.set("id",c.id),u&&o.searchParams.set("lang",u);const l=((me=c==null?void 0:c.variables)==null?void 0:me.length)||0,g=Math.max(1,Math.min(3,l>=3?3:l)),h=360,b=8,S=80,j=120,A=Math.max(1,Math.ceil(l/g));let M=g*h+(g-1)*b+48,ee=Math.min(700,S+A*j+48);const E=(((fe=window.screen)==null?void 0:fe.availWidth)||window.innerWidth)-40,B=(((ge=window.screen)==null?void 0:ge.availHeight)||window.innerHeight)-80;M=Math.min(M,E),ee=Math.min(ee,B);const k=Math.max(0,Math.floor(((((_e=window.screen)==null?void 0:_e.availWidth)||window.innerWidth)-M)/2)),q=Math.max(0,Math.floor(((((Re=window.screen)==null?void 0:Re.availHeight)||window.innerHeight)-ee)/3)),Q=`popup=yes,width=${Math.round(M)},height=${Math.round(ee)},left=${k},top=${q},toolbar=0,location=0,menubar=0,status=0,scrollbars=1,resizable=1,noopener=1`,ie=window.open(o.toString(),"_blank",Q);ie&&ie.focus&&ie.focus(),ie&&(yt(!1),Ze(!1),ye(!1))},size:"sm",className:"shadow-soft",variant:"outline",style:{background:"#fff",color:"#2c3d50",borderColor:"rgba(44, 61, 80, 0.35)"},children:[e.jsx(Us,{className:"h-4 w-4 mr-2"}),Ne.variables]})}),e.jsxs(Ce,{onClick:()=>x(!0),size:"sm",variant:"outline",className:"shadow-soft",style:{background:"#fff",color:"#2c3d50",borderColor:"rgba(44, 61, 80, 0.35)"},title:"Ouvrir l'assistant Copilot",children:[e.jsx(ft,{className:"h-4 w-4 mr-1.5"}),"Copilot"]})]})]})}),e.jsxs(vt,{className:"p-5 space-y-5 mt-1",style:{background:"#f6fbfb",borderRadius:14},children:[e.jsxs("div",{className:"space-y-3 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800 font-semibold",children:[e.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-[#2c3d50]"}),e.jsx("span",{children:Ne.subject})]}),e.jsx(go,{ref:y,value:oe,onChange:t=>{const o=t.target.value;Y.current=o,be(o),gt.current.subject=!0},variables:_,templateLanguage:u,placeholder:Yr(),onVariablesChange:$r,focusedVarName:Ie,onFocusedVarChange:t=>{if(Ke(t||null),ct(t||null),Xe.current)try{Xe.current.postMessage({type:"focusedVar",varName:t||null,normalizedVar:De(t)||null,sender:rt.current})}catch(o){console.warn("Focus broadcast failed:",o)}},variant:"compact"},`subject-${(c==null?void 0:c.id)||"none"}-${u}`)]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800 font-semibold",children:[e.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-[#2c3d50]"}),e.jsx("span",{children:Ne.body})]}),e.jsx(To,{value:J,onChange:t=>{const o=t.target.value;X.current=o,he(o),gt.current.body=!0},ref:p,variables:_,templateLanguage:u,placeholder:Yr(),onVariablesChange:$r,focusedVarName:Ie,onFocusedVarChange:t=>{if(Ke(t||null),ct(t||null),Xe.current)try{Xe.current.postMessage({type:"focusedVar",varName:t||null,normalizedVar:De(t)||null,sender:rt.current})}catch(o){console.warn("Focus broadcast failed:",o)}},minHeight:"150px",showRichTextToolbar:!0},`body-${(c==null?void 0:c.id)||"none"}-${u}`)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center actions-row",children:[e.jsxs("div",{className:"flex items-center gap-2 relative",ref:vr,children:[e.jsx(Ce,{size:"sm",variant:"outline",className:"font-medium border text-[#2c3d50]",style:{borderRadius:12,borderColor:"#2c3d50"},onClick:()=>ut(t=>!t),"aria-expanded":Xt,"aria-haspopup":"menu",children:"+"}),Xt&&e.jsxs("div",{className:"absolute left-0 z-20 mt-2 w-52 bg-white border border-[#e6eef5] rounded-[12px] shadow-soft py-1",role:"menu",children:[e.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[#f5fbff] text-sm",onClick:()=>{Ct("pdf"),ut(!1)},children:"📄 Exporter en PDF"}),e.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[#f5fbff] text-sm",onClick:()=>{Ct("word"),ut(!1)},children:"📗 Ouvrir dans Word"}),e.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[#f5fbff] text-sm",onClick:()=>{Ct("docx"),ut(!1)},children:"📘 Télécharger Word (.doc)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[#f5fbff] text-sm",onClick:()=>{Ct("html"),ut(!1)},children:"🌐 Exporter en HTML"}),e.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[#f5fbff] text-sm",onClick:()=>{Ct("eml"),ut(!1)},children:"✉️ Exporter en .eml"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[#f5fbff] text-sm",onClick:()=>{Ct("copy-html"),ut(!1)},children:"📋 Copier en HTML"}),e.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[#f5fbff] text-sm",onClick:()=>{Ct("copy-text"),ut(!1)},children:"📝 Copier en texte"})]}),e.jsxs(Ce,{variant:"ghost",onClick:()=>os(),className:"text-gray-500 hover:text-[#aca868] hover:bg-[#fefbe8] transition-all duration-300 font-medium text-sm",title:Ne.copyLinkTitle,children:[e.jsx(Ws,{className:"h-4 w-4 mr-2"}),de==="link"?Ne.copied:Ne.copyLink]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(Ce,{onClick:ls,size:"sm",variant:"outline",className:"font-semibold shadow-soft hover:shadow-md border-2 text-black hover:bg-[#fee2e2]",style:{borderColor:"#7f1d1d",borderRadius:12},title:Ne.resetWarningTitle,children:[e.jsx(Rr,{className:"h-4 w-4 mr-2"}),Ne.reset]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(Ce,{onClick:()=>Dt("subject"),variant:"outline",size:"sm",className:"font-medium border-2 transition-all duration-300 group shadow-soft",style:{borderColor:"#2c3d50",borderRadius:"12px",backgroundColor:"rgba(44, 61, 80, 0.08)"},onMouseEnter:t=>{t.currentTarget.style.borderColor="#2c3d50",t.currentTarget.style.backgroundColor="rgba(44, 61, 80, 0.15)"},onMouseLeave:t=>{t.currentTarget.style.borderColor="#2c3d50",t.currentTarget.style.backgroundColor="rgba(44, 61, 80, 0.08)"},title:"Copy subject only (Ctrl+J)",children:[e.jsx(kr,{className:"h-4 w-4 mr-2 text-[#2c3d50]"}),e.jsx("span",{className:"text-[#2c3d50]",children:de==="subject"?Ne.copied:Ne.copySubject||"Subject"})]}),e.jsxs(Ce,{onClick:()=>Dt("body"),variant:"outline",size:"sm",className:"font-medium border-2 transition-all duration-300 group shadow-soft",style:{borderColor:"#aca868",borderRadius:"12px",backgroundColor:"rgba(172, 168, 104, 0.12)"},onMouseEnter:t=>{t.currentTarget.style.borderColor="#aca868",t.currentTarget.style.backgroundColor="rgba(172, 168, 104, 0.22)"},onMouseLeave:t=>{t.currentTarget.style.borderColor="#aca868",t.currentTarget.style.backgroundColor="rgba(172, 168, 104, 0.12)"},title:"Copy body only (Ctrl+B)",children:[e.jsx(lr,{className:"h-4 w-4 mr-2 text-[#2c3d50]"}),e.jsx("span",{className:"text-[#2c3d50]",children:de==="body"?Ne.copied:Ne.copyBody||"Body"})]}),e.jsxs(Ce,{onClick:()=>Dt("all"),className:`font-bold transition-all duration-200 shadow-soft btn-pill text-white ${de==="all"?"transform scale-[1.02]":"hover:scale-[1.02]"}`,style:{background:"#5a88b5"},title:"Copy entire template (Ctrl+Enter)",children:[e.jsx(mr,{className:"h-5 w-5 mr-2"}),de==="all"?Ne.copied:Ne.copyAll||"All"]}),e.jsxs(Ce,{onClick:()=>Qr(),className:"font-bold transition-all duration-200 shadow-soft text-white btn-pill flex items-center py-3",style:{background:"#2c3d50",borderRadius:"12px"},onMouseEnter:t=>{t.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:t=>{t.currentTarget.style.transform="translateY(0)"},title:v==="fr"?"Ouvrir un brouillon en texte brut dans votre client de courriel":"Open a plain-text draft in your email client",children:[e.jsx(Ks,{className:"h-5 w-5 mr-2"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:v==="fr"?"Ouvrir dans un courriel":"Open in an email"}),e.jsx("span",{className:"text-xs font-normal opacity-80",children:v==="fr"?"(texte brut)":"(plain text)"})]})]})]})]})]})]}):e.jsx(ht,{className:"card-soft border-0 bg-gradient-to-br from-white to-emerald-50 rounded-[18px]",children:e.jsx(vt,{className:"flex items-center justify-center h-80",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Rt,{className:"h-16 w-16 text-gray-300 mx-auto animate-bounce"}),e.jsx(ft,{className:"h-6 w-6 text-[#2c3d50] absolute -top-2 -right-2 animate-pulse"})]}),e.jsx("p",{className:"text-gray-500 text-lg font-medium",children:Ne.noTemplate})]})})})})]})]})]}),is&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-gray-200 max-w-md w-full p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-yellow-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:Ne.resetWarningTitle}),e.jsx("p",{className:"text-gray-600",children:Ne.resetWarningMessage})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(Ce,{onClick:()=>rr(!1),variant:"outline",className:"flex-1",children:Ne.cancel}),e.jsx(Ce,{onClick:cs,variant:"outline",className:"flex-1 border-2 text-[#7f1d1d] hover:bg-[#fee2e2]",style:{borderColor:"#7f1d1d"},children:Ne.confirm})]})]})}),xe&&tt&&!He&&ln.createPortal(e.jsx("div",{className:"fixed z-[9999] select-none",style:{right:Wt.right,bottom:Wt.bottom},children:e.jsxs("button",{className:"px-3 py-2 rounded-full shadow-lg border bg-white text-[#aca868] font-semibold",style:{borderColor:"#aca868"},onMouseDown:t=>{t.preventDefault();const o=t.clientX,l=t.clientY,g=Wt.right,h=Wt.bottom,b=j=>{const A=j.clientX-o,M=j.clientY-l,ee=12,E=q=>Math.round(q/ee)*ee,B=E(Math.max(8,g-A)),k=E(Math.max(8,h-M));Kn({right:B,bottom:k})},S=()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",S)};document.addEventListener("mousemove",b),document.addEventListener("mouseup",S)},onClick:()=>yt(!1),title:"Variables",children:[e.jsx(lr,{className:"inline h-4 w-4 mr-1"})," ",Ne.variables]})}),document.body),xe&&!tt&&c&&n&&n.variables&&c.variables&&c.variables.length>0&&ln.createPortal(e.jsx("div",{className:"fixed inset-0 z-[9999] pointer-events-none",style:He?{background:"#ffffff"}:void 0,children:e.jsxs("div",{ref:$e,className:`bg-white ${He?"":"rounded-[14px] shadow-2xl border border-[#e6eef5]"} min-w-[420px] ${He?"max-w-[100vw] max-h-[100vh]":"max-w-[92vw] max-h-[88vh]"} resizable-popup pointer-events-auto flex flex-col`,style:{position:"fixed",top:Te.top,left:Te.left,width:Te.width,height:Te.height,cursor:Ae.current.dragging?"grabbing":"default"},onMouseDown:t=>t.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"vars-title",children:[e.jsx("div",{className:"px-3 py-2 select-none flex-shrink-0 ",style:{background:"var(--primary)",color:"#fff",cursor:"grab"},onMouseDown:t=>{const o=t.target&&t.target.tagName?String(t.target.tagName).toUpperCase():"";o==="INPUT"||o==="BUTTON"||o==="SVG"||o==="PATH"||as(t)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(lr,{className:"h-5 w-5 mr-2 text-white"}),e.jsx("h2",{id:"vars-title",className:"text-base font-bold text-white",children:Ne.variables})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!He&&e.jsx(Ce,{onClick:t=>{var fe,ge,_e,Re,Le;if(t.shiftKey){K(Se=>!Se);return}const o=new URL(window.location.href);o.searchParams.set("varsOnly","1"),c!=null&&c.id&&o.searchParams.set("id",c.id),u&&o.searchParams.set("lang",u);const l=460,g=700,h=((fe=c==null?void 0:c.variables)==null?void 0:fe.length)||0,b=360,S=48,j=80,A=120,M=Math.max(1,h);let ee=Math.max(l,b+S),E=Math.max(g,j+Math.min(M,8)*A+S);const B=(((ge=window.screen)==null?void 0:ge.availWidth)||window.innerWidth)-40,k=(((_e=window.screen)==null?void 0:_e.availHeight)||window.innerHeight)-80;ee=Math.min(ee,B),E=Math.min(E,k);const q=Math.max(0,Math.floor(((((Re=window.screen)==null?void 0:Re.availWidth)||window.innerWidth)-ee)/2)),Q=Math.max(0,Math.floor(((((Le=window.screen)==null?void 0:Le.availHeight)||window.innerHeight)-E)/3)),ie=`popup=yes,width=${Math.round(ee)},height=${Math.round(E)},left=${q},top=${Q},toolbar=0,location=0,menubar=0,status=0,scrollbars=1,resizable=1,noopener=1`,me=window.open(o.toString(),"_blank",ie);me&&me.focus&&me.focus(),me&&(yt(!1),Ze(!1),ye(!1))},variant:"outline",size:"sm",className:"border-2 text-white",style:{borderColor:F?"rgba(139, 195, 74, 0.8)":"rgba(255,255,255,0.5)",borderRadius:10,background:F?"rgba(139, 195, 74, 0.1)":"transparent"},title:v==="fr"?`Détacher dans une nouvelle fenêtre${F?" (préféré)":""}
• Déplacer sur un autre écran
• Redimensionner librement
• Ferme automatiquement cette popup

Shift+clic pour basculer la préférence`:`Detach to new window${F?" (preferred)":""}
• Move to another screen
• Resize freely
• Auto-closes this popup

Shift+click to toggle preference`,onMouseDown:t=>t.stopPropagation(),children:e.jsx(Pr,{className:"h-4 w-4"})}),He&&e.jsx(Ce,{onClick:t=>{t.stopPropagation(),ss()},variant:"outline",size:"sm",className:"border-2 text-white",style:{borderColor:"rgba(255,255,255,0.5)",borderRadius:10,background:"transparent"},title:v==="fr"?gr?"Quitter le plein écran":"Plein écran":gr?"Exit full screen":"Full screen",onMouseDown:t=>t.stopPropagation(),children:gr?e.jsx(Ys,{className:"h-4 w-4"}):e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(Ce,{onClick:()=>Ze(t=>!t),variant:"outline",size:"sm",className:"border-2 text-white",style:{borderColor:"rgba(255,255,255,0.5)",borderRadius:10,background:"transparent"},title:v==="fr"?mt?"Épinglé (cliquer pour libérer)":"Libre (cliquer pour épingler)":mt?"Pinned (click to unpin)":"Unpinned (click to pin)",onMouseDown:t=>t.stopPropagation(),children:mt?e.jsx(Gs,{className:"h-4 w-4"}):e.jsx(Qs,{className:"h-4 w-4"})}),e.jsxs(Ce,{onClick:()=>{if(!c||!n)return;const t=Vt(c,n,u);$(o=>it(o,t))},variant:"outline",size:"sm",className:"border-2 text-[#aca868]",style:{borderColor:"rgba(20,90,100,0.35)",borderRadius:10,background:"#fff"},title:Ne.reset,onMouseDown:t=>t.stopPropagation(),children:[e.jsx(Rr,{className:"h-4 w-4 mr-1"})," ",Ne.reset]}),e.jsxs(Ce,{onClick:()=>{c&&$(t=>{const o={},l=(C.current||"fr").toUpperCase();return c.variables.forEach(g=>{Object.assign(o,et(g,"",{preferredLanguage:l,variables:t}))}),it(t,o)})},variant:"outline",size:"sm",className:"border-2 text-[#7f1d1d] hover:bg-[#fee2e2]",style:{borderColor:"#7f1d1d",borderRadius:10,background:"#fff"},title:v==="fr"?"Tout effacer":"Clear all",onMouseDown:t=>t.stopPropagation(),children:[e.jsx(Js,{className:"h-4 w-4 mr-1"})," ",v==="fr"?"Effacer":"Clear"]}),e.jsx(Ce,{onClick:()=>yt(!0),variant:"outline",size:"sm",className:"border-2 text-white",style:{borderColor:"rgba(255,255,255,0.5)",borderRadius:10,background:"transparent"},title:v==="fr"?`Minimiser

Raccourcis clavier:
• Tab/Entrée: Champ suivant
• Échap: Minimiser
• Ctrl+Entrée: Fermer
• Ctrl+R: Réinitialiser
• Ctrl+Shift+V: Coller intelligent`:`Minimize

Keyboard shortcuts:
• Tab/Enter: Next field
• Escape: Minimize
• Ctrl+Enter: Close
• Ctrl+R: Reset all
• Ctrl+Shift+V: Smart paste`,onMouseDown:t=>t.stopPropagation(),children:e.jsx(Zs,{className:"h-4 w-4"})}),e.jsx(Ce,{onClick:()=>{if(He)window.close();else if(ye(!1),nt)try{const t=new BroadcastChannel("email-assistant-sync");t.postMessage({type:"variablesPopupClosed",timestamp:Date.now()}),t.close()}catch{console.log("BroadcastChannel not available for popup close sync")}},variant:"ghost",size:"sm",className:"hover:bg-red-100 hover:text-red-600",onMouseDown:t=>t.stopPropagation(),children:e.jsx(Or,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",style:{padding:He?"12px":"16px"},children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:(()=>{var j,A;const t=((j=c.subject)==null?void 0:j[u])||"",o=((A=c.body)==null?void 0:A[u])||"",l=t+`
`+o,g=new Set,h=[],b=/<<([^>]+)>>/g;let S;for(;(S=b.exec(l))!==null;){const ee=S[1].replace(/_(FR|EN)$/i,"");!g.has(ee)&&c.variables.includes(ee)&&(g.add(ee),h.push(ee))}return c.variables.forEach(M=>{g.has(M)||h.push(M)}),h})().map(t=>{var j,A,M,ee;const o=(j=n==null?void 0:n.variables)==null?void 0:j[t];if(!o)return null;const l=(E="")=>qt(_,E,u),g=l(t),h=`var-${t.replace(/[^a-z0-9_-]/gi,"-")}`,b=(u||v||"fr").toLowerCase(),S=E=>/_(FR|EN)$/i.test(E)?E:`${E}_${(u||"fr").toUpperCase()}`;return e.jsx("div",{className:"rounded-[10px] p-3 transition-all duration-200",style:{background:Ie===t?"rgba(59, 130, 246, 0.15)":"rgba(200, 215, 150, 0.4)",border:Ie===t?"2px solid rgba(59, 130, 246, 0.4)":"1px solid rgba(190, 210, 140, 0.6)",boxShadow:Ie===t?"0 0 0 3px rgba(59, 130, 246, 0.1)":"none"},children:e.jsxs("div",{className:"bg-white rounded-[8px] p-4 border",style:{border:"1px solid rgba(190, 210, 140, 0.4)"},children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between gap-3",children:[e.jsx("label",{htmlFor:h,className:"text-[14px] font-semibold text-gray-900 flex-1 leading-tight",children:((A=o==null?void 0:o.description)==null?void 0:A[b])||((M=o==null?void 0:o.description)==null?void 0:M.fr)||((ee=o==null?void 0:o.description)==null?void 0:ee.en)||t}),e.jsxs("div",{className:"shrink-0 flex items-center gap-1 opacity-0 hover:opacity-100 focus-within:opacity-100 transition-opacity",children:[e.jsx("button",{className:"text-[11px] px-2 py-0.5 rounded border border-[#e6eef5] text-[#aca868] hover:bg-[#f0fbfb]",title:v==="fr"?"Remettre l’exemple":"Reset to example",onClick:()=>{const E=Hn(n,S(t)),B=(u||C.current||"fr").toUpperCase();$(k=>{const q=et(t,E,{preferredLanguage:B,variables:k});return it(k,q)})},children:"Ex."}),e.jsx("button",{className:"text-[11px] px-2 py-0.5 rounded border border-[#e6eef5] text-[#7f1d1d] hover:bg-[#fee2e2]",title:v==="fr"?"Effacer ce champ":"Clear this field",onClick:()=>{const E=(u||C.current||"fr").toUpperCase();$(B=>{const k=et(t,"",{preferredLanguage:E,variables:B});return it(B,k)})},children:"X"})]})]}),e.jsx("textarea",{autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,"data-lpignore":"true","data-1p-ignore":"true","data-bwignore":"true","data-gramm":"false","data-enable-grammarly":"false","data-ms-editor":"false",ref:E=>{E&&(dt.current[t]=E)},id:h,name:h,value:g,onChange:E=>{const B=E.target.value;if(B!==g){const q=(u||C.current||"fr").toUpperCase();$(Q=>{const ie=et(t,B,{preferredLanguage:q,variables:Q});return it(Q,ie)})}const k=(B.match(/\n/g)||[]).length+1;E.target.style.height=k<=2&&k===1?"32px":"52px"},onInput:E=>{const B=E.target.value,k=(u||C.current||"fr").toUpperCase();$(q=>{const Q=et(t,B,{preferredLanguage:k,variables:q});return it(q,Q)})},onFocus:()=>Ke(t),onKeyDown:E=>{var k;if(!(c!=null&&c.variables))return;const B=c.variables;if(E.key==="Tab"||E.key==="Enter"&&!E.shiftKey){E.preventDefault();const q=B.indexOf(t);let Q;if(E.shiftKey&&E.key==="Tab")Q=(q-1+B.length)%B.length;else{const fe=B.filter(ge=>!l(ge).trim());if(fe.length>0){const ge=fe.findIndex(_e=>B.indexOf(_e)>q);Q=ge>=0?B.indexOf(fe[ge]):B.indexOf(fe[0])}else Q=(q+1)%B.length}const ie=B[Q],me=dt.current[ie];me&&me.focus&&(me.focus(),(k=me.select)==null||k.call(me))}},onBlur:()=>Ke(E=>E===t?null:E),placeholder:(()=>{if(o.examples&&o.examples[b])return o.examples[b];const E=o==null?void 0:o.example;return E&&typeof E=="object"?b==="en"?E.en||E.fr||"":E.fr||E.en||"":E||""})(),className:"w-full min-h-[32px] border-2 input-rounded border-[#e6eef5] resize-none transition-all duration-200 text-sm px-2 py-1 leading-5 flex items-center",style:{height:(()=>{const E=(g.match(/\n/g)||[]).length+1;return E<=2&&E===1?"32px":"52px"})(),maxHeight:"52px",overflow:"hidden",borderColor:g.trim()?"rgba(34, 197, 94, 0.4)":Ie===t?"rgba(59, 130, 246, 0.6)":"rgba(239, 68, 68, 0.2)",backgroundColor:!g.trim()&&Ie!==t?"rgba(254, 242, 242, 0.5)":Ie===t?"rgba(219, 234, 254, 0.3)":"white",boxShadow:Ie===t?"0 0 0 3px rgba(59, 130, 246, 0.1)":"none"}}),(g||Ie===t)&&(()=>{const E=(g||"").trim(),B=((o==null?void 0:o.format)||"").toLowerCase();let k="",q=!0;if(B==="email"||!B&&/@/.test(E))k="email",q=/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(E);else if(B==="url"||!B&&/^(https?:\/\/|www\.)/i.test(E)){k="url";try{new URL(E.startsWith("http")?E:"https://"+E),q=!0}catch{q=!1}}else B==="date"||!B&&/\d{4}-\d{2}-\d{2}/.test(E)?(k="date",q=/^\d{4}-\d{2}-\d{2}$/.test(E)):(B==="amount"||!B&&/[\d][\d,.]*\s?(€|\$|usd|cad|eur|$)/i.test(E))&&(k="amount",q=/^[-+]?\d{1,3}(?:[\s,]\d{3})*(?:[.,]\d+)?(?:\s?(€|\$|usd|cad|eur))?$/i.test(E));return k?e.jsxs("div",{className:"mt-1 text-[11px] flex items-center gap-1",style:{color:q?"#166534":"#7f1d1d"},children:[e.jsx("span",{"aria-hidden":"true",style:{display:"inline-block",width:8,height:8,borderRadius:9999,background:q?"#16a34a":"#dc2626"}}),e.jsxs("span",{children:[k==="email"&&(q?v==="fr"?"Courriel valide":"Looks like an email":v==="fr"?"Vérifiez le courriel":"Check email format"),k==="url"&&(q?v==="fr"?"URL":"Looks like a URL":v==="fr"?"Vérifiez l’URL":"Check URL"),k==="date"&&(q?v==="fr"?"Date AAAA-MM-JJ":"Date YYYY-MM-DD":v==="fr"?"Format: AAAA-MM-JJ":"Format: YYYY-MM-DD"),k==="amount"&&(q?v==="fr"?"Montant":"Amount":v==="fr"?"Ex: 100,50 €":"Ex: $1,600.50")]})]}):null})()]})},t)})}),!He&&e.jsx("div",{onMouseDown:t=>{t.preventDefault(),t.stopPropagation();const o=t.clientX,l=t.clientY,g=Te.width,h=Te.height,b=j=>{const A=j.clientX-o,M=j.clientY-l;Ve(ee=>({...ee,width:Math.max(420,Math.min(window.innerWidth*.92,g+A)),height:Math.max(380,Math.min(window.innerHeight*.88,h+M))}))},S=()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",S)};document.addEventListener("mousemove",b),document.addEventListener("mouseup",S)},title:"Resize",className:"custom-resize-handle",style:{position:"absolute",right:8,bottom:8,width:16,height:16,cursor:"nwse-resize",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsx(eo,{className:"h-4 w-4 text-gray-400 transform rotate-45 hover:text-gray-600 transition-colors"})})]})]})}),document.body),m&&e.jsxs("div",{className:"fixed inset-0 z-50","aria-modal":"true",role:"dialog",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>x(!1)}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-[420px] bg-gradient-to-br from-gray-50 to-blue-50 shadow-2xl border-l border-gray-200 p-4 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 pb-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 animate-pulse"}),e.jsx("span",{className:"font-semibold text-gray-800",children:"Assistant de rédaction Copilot M365"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600 hover:bg-gray-200 w-8 h-8 rounded-full flex items-center justify-center transition-all",onClick:()=>x(!1),"aria-label":"Fermer",children:"✕"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Ao,{emailText:J,onResult:he,variables:_,interfaceLanguage:v,templateLanguage:u})})]})]})]})}const Go=(r,i="")=>{if(!(r!=null&&r.variables)||!i)return null;if(r.variables[i])return r.variables[i];const s=i.replace(/_(FR|EN)$/i,"");return r.variables[s]||null},Qo=(r,i="")=>{var w,U,v,O;const s=Go(r,i),d=(U=(w=(i||"").match(/_(FR|EN)$/i))==null?void 0:w[1])==null?void 0:U.toLowerCase();if(d==="en"&&((v=s==null?void 0:s.examples)!=null&&v.en))return s.examples.en;if(d==="fr"&&((O=s==null?void 0:s.examples)!=null&&O.fr))return s.examples.fr;if(s!=null&&s.example&&typeof s.example=="object")return d==="en"?s.example.en??s.example.fr??"":s.example.fr??s.example.en??"";if(s!=null&&s.example)return s.example;const n=(i||"").toLowerCase();switch((s==null?void 0:s.format)||(/date|jour|day/.test(n)?"date":/heure|time/.test(n)?"time":/montant|total|nombre|count|amount|num|quant/.test(n)?"number":"text")){case"date":return new Date().toISOString().slice(0,10);case"time":return"09:00";case"number":return"0";default:return"…"}};function Jo({selectedTemplate:r,templatesData:i,initialVariables:s,interfaceLanguage:d,templateLanguage:n="fr"}){console.log("🔍 VariablesPopout props:",{selectedTemplate:r==null?void 0:r.id,templatesData:!!i,initialVariables:s,interfaceLanguage:d,templateLanguage:n});const[f,w]=a.useState(s||{}),U=a.useRef({}),v=a.useCallback(p=>{if(p)try{p.style.height="auto";const y=Math.max(32,p.scrollHeight);p.style.height=`${y}px`}catch{}},[]),O=a.useRef(s);a.useEffect(()=>{O.current!==s&&(O.current=s,w(s&&typeof s=="object"?{...s}:{}))},[s]),a.useEffect(()=>{try{const p=U.current||{};Object.values(p).forEach(y=>v(y))}catch{}},[f,v]);const u=a.useMemo(()=>(n||"fr").toUpperCase(),[n]),I=a.useCallback((p="")=>/_(FR|EN)$/i.test(p)?p:`${p}_${u}`,[u]),c=a.useCallback((p="")=>{const y=qt(f,p,n);return y==="__DELETED__"?"":y},[f,n]),[W,R]=a.useState(2);a.useEffect(()=>{const p=()=>{const N=window.innerWidth;return N<500?1:N<800?2:3},y=()=>{R(p())};return y(),window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]),console.log("🔍 VariablesPopout initialized with variables:",f);const[se,re]=a.useState(null),ce=a.useRef(null),D=a.useRef(Math.random().toString(36).slice(2)),P=a.useRef(null),oe=a.useRef(se),be=a.useRef(null),J=a.useRef(0),he=a.useRef(null);a.useEffect(()=>{oe.current=se},[se]);const _=(p,y=!0)=>{const N=p??null,C=oe.current??null,L=De(N);if(De(C)!==L||C!==N)oe.current=N,re(N),he.current=L;else if(!y)return;if(y){if(ce.current)try{ce.current.postMessage({type:"focusedVar",varName:N,normalizedVar:L||null,sender:D.current})}catch(z){console.error("Failed to send focus update:",z)}try{localStorage.setItem("ea_focused_var",JSON.stringify({focusedVar:N,normalizedVar:L||null,timestamp:Date.now(),sender:D.current}))}catch(z){console.warn("Unable to persist focus sync payload:",z)}}},$=p=>{if(ce.current)try{ce.current.postMessage({type:"variableHovered",varName:p??null,sender:D.current})}catch(y){console.error("Failed to send hover update:",y)}};a.useEffect(()=>{try{const p=new BroadcastChannel("email-assistant-sync");return ce.current=p,console.log("🔍 BroadcastChannel created successfully"),p.onmessage=y=>{try{const N=y.data;if(!N||N.sender===D.current)return;if(console.log("🔍 Received message:",N.type,N),N.type==="focusedVar"){const C=N.varName??null,L=N.normalizedVar||De(C);_(C,!1),document.querySelectorAll(".ea-popout-card").forEach(H=>{const z=H.getAttribute("data-var"),Z=L&&De(z)===L;if(Z){if(H.classList.add("ea-popout-focused"),he.current!==L)try{H.scrollIntoView({block:"center",behavior:"smooth"}),he.current=L}catch{}}else H.classList.remove("ea-popout-focused");const pe=H.querySelector("textarea");pe&&(Z?pe.classList.add("ea-popout-input-focused"):pe.classList.remove("ea-popout-input-focused"))}),L||(he.current=null);return}if(N.type==="variableHovered"){const C=N.varName??null,L=De(C);document.querySelectorAll(".ea-popout-card").forEach(H=>{const z=H.getAttribute("data-var"),Z=L&&De(z)===L;H.classList.toggle("ea-popout-hovered",!!Z)});return}if(N.type==="variablesUpdated"){console.log("🔍 Updating variables from variablesUpdated:",N.variables),w(N.variables||{});return}if(N.type==="syncComplete"){console.log("🔄 Received sync completion:",N);const C=N.variables||{};console.log("🔄 Applying sync result variables:",C),w(C);return}}catch(N){console.error("Error processing BroadcastChannel message:",N)}},()=>{try{p.close()}catch(y){console.error("Error closing BroadcastChannel:",y)}}}catch(p){console.error("BroadcastChannel not available:",p)}},[]),a.useEffect(()=>{if(ce.current)return console.log("🔄 Popout ready - waiting for initial variables from main window"),()=>{P.current&&(clearInterval(P.current),P.current=null)}},[]);const ue=(p,y,N)=>{if(ce.current)try{ce.current.postMessage({type:"variableChanged",varName:p,value:y,allVariables:N,sender:D.current}),J.current=Date.now()}catch(C){console.error("Failed to send variable update:",C)}},ne=(p,y)=>{const N=et(p,y,{preferredLanguage:u,variables:f}),C=applyAssignments(f||{},N);w(C),ue(p,y,C)},T=p=>{const y=et(p,"__DELETED__",{preferredLanguage:u,variables:f}),N=applyAssignments(f||{},y);if(w(N),ue(p,"__DELETED__",N),!!ce.current)try{ce.current.postMessage({type:"variableDeleted",varName:p,allVariables:N,sender:D.current})}catch(C){console.error("Failed to send variable deletion:",C)}},Y=p=>{const y=I(p),N=Qo(i,y),C=et(p,N,{preferredLanguage:u,variables:f}),L=applyAssignments(f||{},C);if(w(L),ue(p,N,L),!!ce.current)try{ce.current.postMessage({type:"variableRestored",varName:p,value:N,allVariables:L,sender:D.current})}catch(H){console.error("Failed to send variable restoration:",H)}};if(a.useEffect(()=>()=>{clearTimeout(be.current)},[]),a.useEffect(()=>{var p;if(!(!(r!=null&&r.variables)||r.variables.length===0))try{const y=r.variables.find(C=>!c(C).trim())||r.variables[0],N=(p=U.current)==null?void 0:p[y];N&&typeof N.focus=="function"&&setTimeout(()=>{try{N.focus(),typeof N.select=="function"&&N.select()}catch(C){console.warn("Focus error:",C)}},100)}catch(y){console.error("Auto-focus error:",y)}},[]),!r||!i)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("p",{className:"text-gray-500",children:"Loading..."})});const X=d==="fr"?{title:"Modifier les variables",reinitialize:"Réinitialiser",clear:"Supprimer",close:"Fermer"}:{title:"Edit Variables",reinitialize:"Reinitialize",clear:"Delete",close:"Close"};return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"sticky top-0 z-10 px-5 py-2 flex items-center justify-between",style:{background:"#2c3d50",borderBottom:"3px solid rgba(163, 179, 84, 0.3)"},children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(lr,{className:"h-5 w-5 mr-2 text-white"}),e.jsx("h1",{className:"text-lg font-bold text-white",children:X.title})]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>window.close(),className:"text-white hover:bg-white/20 rounded-lg p-2 transition-colors",title:X.close,children:e.jsx(Or,{className:"h-5 w-5"})})})]}),e.jsx("div",{className:"py-2 px-5",children:e.jsx("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${W}, minmax(0, 1fr))`,width:"100%",minWidth:0},children:(()=>{var Z,pe;const p=((Z=r==null?void 0:r.subject)==null?void 0:Z[n])||"",y=((pe=r==null?void 0:r.body)==null?void 0:pe[n])||"",N=p+`
`+y,C=new Set,L=[],H=/<<([^>]+)>>/g;let z;for(;(z=H.exec(N))!==null;){const de=z[1].replace(/_(FR|EN)$/i,"");!C.has(de)&&((r==null?void 0:r.variables)||[]).includes(de)&&(C.add(de),L.push(de))}return((r==null?void 0:r.variables)||[]).forEach(we=>{C.has(we)||L.push(we)}),L})().map(p=>{var z,Z,pe,we;const y=(z=i==null?void 0:i.variables)==null?void 0:z[p];if(!y)return console.warn("🔍 Variable info not found for:",p),null;const N=c(p);if(N==="__DELETED__")return null;const C=Ir(se,p),L=`popout-var-${p.replace(/[^a-z0-9_-]/gi,"-")}`,H=(n||d||"fr").toLowerCase();return e.jsx("div",{"data-var":p,className:`ea-popout-card rounded-lg transition-all duration-200 ${C?"ea-popout-focused":""}`,style:C?{background:"rgba(219, 234, 254, 0.35)",border:"2px solid rgba(29, 78, 216, 0.6)",boxShadow:"0 0 0 3px rgba(29, 78, 216, 0.25), 0 8px 24px rgba(30, 64, 175, 0.25)",transform:"scale(1.02)"}:void 0,onMouseEnter:()=>$(p),onMouseLeave:()=>$(null),children:e.jsxs("div",{className:"ea-popout-card-inner rounded-lg p-2",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between gap-3",children:[e.jsx("label",{htmlFor:L,className:"text-sm font-semibold text-gray-900 flex-1 leading-snug",children:((Z=y.description)==null?void 0:Z[H])||((pe=y.description)==null?void 0:pe.fr)||((we=y.description)==null?void 0:we.en)||p}),e.jsxs("div",{className:"shrink-0 flex items-center gap-1 opacity-0 hover:opacity-100 focus-within:opacity-100 transition-opacity",children:[e.jsxs("button",{className:"text-xs px-2 py-0.5 rounded border border-gray-300 text-teal-700 hover:bg-teal-50 flex items-center gap-1",title:X.reinitialize,onClick:()=>Y(p),children:[e.jsx(Rr,{className:"h-3.5 w-3.5"}),X.reinitialize]}),e.jsx("button",{className:"text-xs px-2 py-0.5 rounded border border-gray-300 text-red-700 hover:bg-red-50",title:X.clear,onClick:()=>T(p),children:"X"})]})]}),e.jsx("textarea",{ref:de=>{de&&(U.current[p]=de)},id:L,name:L,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,"data-lpignore":"true","data-1p-ignore":"true","data-bwignore":"true","data-gramm":"false","data-enable-grammarly":"false","data-ms-editor":"false",value:N,onChange:de=>{ne(p,de.target.value),v(de.target)},onInput:de=>{ne(p,de.target.value)},onFocus:de=>{_(p),requestAnimationFrame(()=>{try{de.target.select()}catch{}v(de.target)})},onBlur:()=>_(null),onKeyDown:de=>{var qe;if(de.key==="Tab"||de.key==="Enter"&&!de.shiftKey){de.preventDefault();const xe=r.variables,ye=xe.indexOf(p);let We;de.shiftKey&&de.key==="Tab"?We=(ye-1+xe.length)%xe.length:We=(ye+1)%xe.length;const V=xe[We],m=U.current[V];m&&m.focus&&(m.focus(),(qe=m.select)==null||qe.call(m))}},placeholder:(()=>{if(y.examples&&y.examples[H])return y.examples[H];const de=y.example;return de&&typeof de=="object"?H==="en"?de.en||de.fr||"":de.fr||de.en||"":de||""})(),className:`w-full min-h-[32px] border-2 border-gray-200 rounded-md resize-none overflow-hidden transition-all duration-200 text-sm px-2 py-1 leading-5 focus:border-blue-600 focus:ring-2 focus:ring-blue-200 ${C?"ea-popout-input-focused":""}`})]})},p)})})})]})}function Zo(){const r=a.useRef(null);r.current||(r.current=new URLSearchParams(window.location.search));const i=r.current.get("id"),s=r.current.get("lang")||"fr",[d,n]=a.useState(null),[f,w]=a.useState(null),[U,v]=a.useState({}),[O,u]=a.useState(s),[I,c]=a.useState(i||null),[W,R]=a.useState(s),[se,re]=a.useState(!0),ce=a.useRef(null),D=(...J)=>{try{console.log("[Popout]",...J)}catch{}},P=a.useCallback(J=>{try{return String(J||"").trim().toLowerCase().replace(/[-_ ](?:copy|dup|duplicate)\d*$/i,"").replace(/_(\d+)$/i,"")}catch{return String(J||"").trim().toLowerCase()}},[]),oe=a.useCallback((J,he)=>{var _;try{if(!((_=J==null?void 0:J.templates)!=null&&_.length)||!he)return null;const $=new Set(Object.keys(he).map(T=>String(T).replace(/_(FR|EN)$/i,"")));let ue=null,ne=0;for(const T of J.templates){const X=(Array.isArray(T.variables)?T.variables:[]).reduce((p,y)=>p+($.has(y)?1:0),0);X>ne&&(ne=X,ue=T.id)}return ne>0?ue:null}catch($){return D("inferTemplateFromVariables error",$),null}},[]),be=a.useCallback((J,he,_={})=>{if(!(J!=null&&J.templates)||!he)return!1;let $=J.templates.find(ue=>ue.id===he);if(!$){const ue=P(he);for(const ne of J.templates)if(P(ne.id)===ue){$=ne;break}}if(!$)return!1;if(D("applyTemplateSelection",{templateId:he,resolvedId:$.id}),w($),_.preferLanguage&&u(_.preferLanguage),_.hydrateVariables&&(_.forceHydration||ce.current!==he)){const ne={},T=new Set,Y=J.variables||{},X=["FR","EN"];Array.isArray($.variables)&&$.variables.forEach(p=>{const y=Y[p],N=(()=>{const C=y==null?void 0:y.example;return C&&typeof C=="object"?C.fr||C.en||"":C||""})();ne[p]=N,T.add(p),X.forEach(C=>{const L=`${p}_${C}`,H=y==null?void 0:y.example;H&&typeof H=="object"?/_(FR)$/i.test(L)?ne[L]=H.fr||H.en||"":/_(EN)$/i.test(L)?ne[L]=H.en||H.fr||"":ne[L]=H.fr||H.en||"":ne[L]=N,T.add(L)})}),ce.current=he,v(p=>{const y=p||{};if(_.mergeWithExisting===!1)return ne;const N={...ne};return Object.keys(y).forEach(C=>{T.has(C)&&(N[C]=y[C])}),N})}return!0},[u,v]);if(a.useEffect(()=>{let J=!1;const he=()=>{try{const T=localStorage.getItem("ea_pending_popout_snapshot");if(!T)return;const Y=JSON.parse(T),X=!(Y!=null&&Y.templateId)||Y.templateId===(I||null),p=!(Y!=null&&Y.templateLanguage)||Y.templateLanguage===(W||null);X&&p&&Y!=null&&Y.variables&&typeof Y.variables=="object"&&v({...Y.variables}),!I&&(Y!=null&&Y.templateId)&&c(Y.templateId),Y!=null&&Y.templateLanguage&&(R(Y.templateLanguage),u(Y.templateLanguage))}catch(T){console.warn("📋 Unable to hydrate pending popout snapshot:",T)}finally{try{localStorage.removeItem("ea_pending_popout_snapshot")}catch{}}},_=async()=>{var T,Y;try{const X="https://raw.githubusercontent.com/snarky1980/echo-bt-ctd-gestion/main/complete_email_templates.json",p="https://raw.githubusercontent.com/snarky1980/echo-bt-ctd-gestion/gh-pages/complete_email_templates.json",y=((Y=(T=import.meta)==null?void 0:T.env)==null?void 0:Y.BASE_URL)||"/",N=y.endsWith("/")?y:`${y}/`,C=new URL(N,window.location.origin),L=`?t=${Date.now()}`,H=[X+L,p+L,new URL("complete_email_templates.json",C).href+L,new URL("complete_email_templates.json",window.location.href).href+L,new URL("complete_email_templates.json",window.location.origin).href+L];let z=null,Z=null;D("attempting template fetch",{base:y,candidates:H});for(const pe of H)try{const we=await fetch(pe,{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!we.ok){Z=new Error(`HTTP ${we.status} for ${pe}`);continue}z=await we.json(),D("loaded templates",{count:Array.isArray(z==null?void 0:z.templates)?z.templates.length:0,source:pe});break}catch(we){Z=we}if(!z)throw Z||new Error("Template catalog fetch failed");if(J)return;n(z)}catch(X){J||console.error("Failed to load templates:",X)}finally{J||re(!1)}};he(),_();try{if(!I){const T=localStorage.getItem("ea_last_template_id"),Y=localStorage.getItem("ea_last_template_lang");T&&(c(T),Y&&(R(Y),u(Y)))}}catch{}let $;const ne=setTimeout(()=>{try{$=new BroadcastChannel("email-assistant-sync"),D("BroadcastChannel connected"),$.onmessage=Y=>{const X=Y.data||{};if(X.type==="variablesUpdated"){if(D("received variablesUpdated",{templateId:X.templateId,templateLanguage:X.templateLanguage,vars:Object.keys(X.variables||{}).length}),X.templateId&&c(X.templateId),X.templateLanguage&&(R(X.templateLanguage),u(X.templateLanguage)),X.variables&&typeof X.variables=="object")v({...X.variables});else if(!X.templateId&&d){const p=oe(d,X.variables||{});p&&c(p)}d&&X.templateId&&be(d,X.templateId,{preferLanguage:X.templateLanguage,hydrateVariables:!0});return}X.type==="syncComplete"&&X.success&&(D("received syncComplete",{vars:Object.keys(X.variables||{}).length}),X.variables&&typeof X.variables=="object"&&v({...X.variables}),X.templateId&&c(X.templateId),X.templateLanguage&&(R(X.templateLanguage),u(X.templateLanguage)))};const T=()=>{if($)try{$.postMessage({type:"popoutReady",timestamp:Date.now()}),D("sent popoutReady")}catch(Y){console.error("Failed to send ready signal:",Y)}};setTimeout(T,50),setTimeout(T,300),setTimeout(T,600)}catch(T){console.error("BroadcastChannel not available:",T)}},100);return()=>{J=!0,clearTimeout(ne),$&&$.close()}},[]),a.useEffect(()=>{if(!d||!I)return;be(d,I,{preferLanguage:W,hydrateVariables:!0})||(console.warn("📋 Unable to locate template for popout:",I,"available templates:",((d==null?void 0:d.templates)||[]).map(_=>_.id).join(", ")),((d==null?void 0:d.templates)||[]).map(_=>_.id).includes(I)||(console.log("📋 Template not in current catalog, attempting fresh reload..."),(async()=>{var $,ue;try{const ne=((ue=($=import.meta)==null?void 0:$.env)==null?void 0:ue.BASE_URL)||"/",T=ne.endsWith("/")?ne:`${ne}/`,Y=new URL(T,window.location.origin),X=new URL("complete_email_templates.json",Y).href+"?t="+Date.now(),p=await fetch(X,{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(p.ok){const y=await p.json();console.log("📋 Fresh data loaded, checking for template:",I),n(y)}else console.error("❌ Fresh fetch failed with status:",p.status),ce.current=null,w(null),c(null)}catch(ne){console.error("❌ Exception during fresh fetch:",ne),ce.current=null,w(null),c(null)}})()))},[d,I,W,be,P]),a.useEffect(()=>{if(!d||f||se)return;const J=setTimeout(()=>{if(!f&&!I&&Array.isArray(d==null?void 0:d.templates)&&d.templates.length){const he=d.templates[0].id;D("fallback selecting first template",he),c(he)}},800);return()=>clearTimeout(J)},[d,f,I,se]),se)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:O==="fr"?"Chargement...":"Loading..."})]})});if(!f||!d){const he=!!I&&!!d&&!f?O==="fr"?"Recherche du modèle...":"Searching for template...":d?O==="fr"?"Modèle introuvable. Fermez et rouvrez le panneau.":"Template not found. Close and reopen panel.":O==="fr"?"Chargement des données...":"Loading data...";return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:he}),d&&I&&e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:O==="fr"?`Modèle : ${I}`:`Template: ${I}`})]})})}return console.log("🔍 VariablesPage rendering with:",{selectedTemplate:f==null?void 0:f.id,variables:U,interfaceLanguage:O}),e.jsx(Jo,{selectedTemplate:f,templatesData:d,initialVariables:U,interfaceLanguage:O,templateLanguage:W||O})}function ea(){const r=new URLSearchParams(window.location.search),s=r.get("lang")==="en"?"en":"fr",d=r.get("support")||"echo-support@jskennedy.net",n=a.useMemo(()=>()=>{try{window.close()}catch{}},[]);return e.jsx("div",{className:"w-full h-full overflow-auto",children:e.jsx(Fo,{language:s,onClose:n,supportEmail:d})})}class ta extends zr.Component{constructor(i){super(i),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(i){return{hasError:!0}}componentDidCatch(i,s){this.setState({error:i,errorInfo:s}),console.error("=== ERROR BOUNDARY CAUGHT ERROR ==="),console.error("Error:",i),console.error("Error message:",i==null?void 0:i.message),console.error("Error stack:",i==null?void 0:i.stack),console.error("Component stack:",s==null?void 0:s.componentStack),console.error("==================================="),typeof window<"u"&&setTimeout(()=>{alert(`ERROR: ${i==null?void 0:i.message}

Check console for details`)},100)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-red-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-lg w-full",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Something went wrong!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"An error occurred while loading the application. Please try refreshing the page."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Reload Page"})]}),!1]})}):this.props.children}}const Wn=new URLSearchParams(window.location.search),ra=Wn.get("varsOnly")==="1",na=Wn.get("helpOnly")==="1";to.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(ta,{children:e.jsx(Io,{children:ra?e.jsx(Zo,{}):na?e.jsx(ea,{}):e.jsx(Xo,{})})})}));
